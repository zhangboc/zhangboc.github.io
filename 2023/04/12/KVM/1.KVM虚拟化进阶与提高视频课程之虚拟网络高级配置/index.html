<!DOCTYPE html>

<html lang="en">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>KVM虚拟化进阶之虚拟网络高级配置 - Hexo</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />

  <link rel="shortcut icon" href="/images/head/head.jpg" type="image/png" />
  <meta property="og:type" content="article">
<meta property="og:title" content="KVM虚拟化进阶之虚拟网络高级配置">
<meta property="og:url" content="https://zhangboc.github.io/2023/04/12/KVM/1.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8B%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/1.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/2.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/3.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/4.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/5.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/6.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/7.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/8.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/9.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/10.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/11.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/12.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/13.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/14.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/15.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/16.jpg">
<meta property="article:published_time" content="2023-04-11T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-16T11:30:09.579Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="KVM">
<meta property="article:tag" content="KVM虚拟网络高级配置">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangboc.github.io/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/1.jpg">
  <link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/9.15.8/styles/atom-one-dark.min.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://lib.baomitu.com/justifiedGallery/3.8.1/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1681876082779">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiaomai.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/lihui.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="John Doe" class="mdui-btn mdui-btn-icon"><img src="/images/head/head.jpg" alt="John Doe"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="John Doe">
            <img src="/images/head/head.jpg" alt="John Doe" alt="John Doe">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>16 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>13<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>3<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/index.html" title="关于我">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend/index.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/download/index.html" title="下载中心">
            <i class="mdui-list-item-icon nexmoefont icon-tangguo"></i>
            <div class="mdui-list-item-content">
                下载中心
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=1605643129&Site=%E5%8C%97%E4%BA%ACSEO&Menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(64, 196, 255);background-color: rgba(64, 196, 255, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="mailto:1605643129@qq.com" target="_blank" mdui-tooltip="{content: 'mail'}" style="color: rgb(249,8,8);background-color: rgba(249,8,8,.1);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a><a class="mdui-ripple" href="https://blog.csdn.net/qq_40855827?type=blog" target="_blank" mdui-tooltip="{content: 'CSDN'}" style="color: rgb(199,29,35);background-color: rgba(199,29,35,.1);">
            <i class="nexmoefont icon-csdn"></i>
        </a><a class="mdui-ripple" href="https://home.cnblogs.com/u/1882665" target="_blank" mdui-tooltip="{content: '博客园'}" style="color: rgb(66, 214, 29);background-color: rgba(66, 214, 29, .1);">
            <i class="nexmoefont icon-bokeyuan"></i>
        </a><a class="mdui-ripple" href="https://github.com/zhangboc" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://gitee.com/with-the-wind-yue" target="_blank" mdui-tooltip="{content: 'gitee'}" style="color: rgb(255, 255, 255);background-color: rgb(199,29,35);">
            <i class="nexmoefont icon-mayun"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/">Ceph</a>
          <span class="category-list-count">9</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/KVM/">KVM</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/hexo/">hexo</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Ceph/" style="font-size: 20px;">Ceph</a> <a href="/tags/CephFS/" style="font-size: 10px;">CephFS</a> <a href="/tags/Ceph%E7%AE%80%E4%BB%8B/" style="font-size: 10px;">Ceph简介</a> <a href="/tags/KVM/" style="font-size: 16.67px;">KVM</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB/" style="font-size: 10px;">KVM虚拟机迁移</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">KVM虚拟网络高级配置</a> <a href="/tags/Linux-HA/" style="font-size: 13.33px;">Linux HA</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/RBD/" style="font-size: 13.33px;">RBD</a> <a href="/tags/RGW/" style="font-size: 10px;">RGW</a> <a href="/tags/chatjs/" style="font-size: 10px;">chatjs</a> <a href="/tags/%E5%9F%BA%E4%BA%8EiSCSI%E7%9A%84KVM%E7%BE%A4%E9%9B%86%E6%9E%84%E5%BB%BA/" style="font-size: 10px;">基于iSCSI的KVM群集构建</a> <a href="/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" style="font-size: 10px;">故障排查</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 John Doe
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/zhangboc/hexo.github.io/" target="_blank">ZhangboCheng</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">辽ICP备2021002341号</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
        <script>
            var now = new Date(); 
            function createtime() { 
                var grt= new Date("08/10/2018 17:38:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
                now.setTime(now.getTime()+250); 
                days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>


        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    
        <div class="nexmoe-post-cover" style="padding-bottom: 26.666666666666668%;">
            <img data-src="https://img1.baidu.com/it/u=413643897,2296924942&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" data-sizes="auto" alt="KVM虚拟化进阶之虚拟网络高级配置" class="lazyload">
            <h1>KVM虚拟化进阶之虚拟网络高级配置</h1>
        </div>
    

        <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年04月12日</a>
    <a><i class="nexmoefont icon-areachart"></i>6.2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 35 分钟</a>
</div>

        <div class="nexmoe-post-right">
            
        </div>

        <article>
            <h1><span id></span></h1><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#1-%E9%85%8D%E7%BD%AE%E7%BD%91%E5%8D%A1%E7%BB%91%E5%AE%9Abond">1、配置网卡绑定（bond）</a><ul>
<li><a href="#1-%E7%BB%91%E5%AE%9A%E7%BD%91%E5%8D%A1">1、绑定网卡</a><ul>
<li><a href="#1-bond%E7%9A%84%E6%A8%A1%E5%BC%8F">1、Bond的模式</a></li>
</ul>
</li>
<li><a href="#2-%E9%85%8D%E7%BD%AE%E7%BD%91%E6%A1%A5">2、配置网桥</a></li>
</ul>
</li>
<li><a href="#2-%E9%85%8D%E7%BD%AEvlan">2、配置Vlan</a><ul>
<li><a href="#1-nmcli%E6%96%B9%E6%B3%95">1、nmcli方法</a></li>
<li><a href="#2-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%9B%E5%BB%BA">2、通过命令行创建</a></li>
<li><a href="#3-%E9%80%9A%E8%BF%87virt-manager%E5%88%9B%E5%BB%BA">3、通过virt-manager创建</a></li>
<li><a href="#4-%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BD%BF%E7%94%A8vlan">4、虚拟机使用vlan</a></li>
</ul>
</li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E8%BF%87%E6%BB%A4">3、配置网络过滤</a></li>
</ul>
<!-- tocstop -->

<h1><span id="1-配置网卡绑定bond">1、配置网卡绑定（bond）</span></h1><p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/1.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/2.jpg"></p>
<h2><span id="1-绑定网卡">1、绑定网卡</span></h2><pre><code>[root@kvm ~]# ip a  #查看需要绑定的网卡，ens33和ens36
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet 192.168.187.134/24 brd 192.168.187.255 scope global noprefixroute dynamic ens33
       valid_lft 1066sec preferred_lft 1066sec
    inet6 fe80::1fc1:66d:29af:eabe/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
5: ens36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:e6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.187.135/24 brd 192.168.187.255 scope global noprefixroute dynamic ens36
       valid_lft 1783sec preferred_lft 1783sec
    inet6 fe80::84be:5ac8:542c:705f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
[root@kvm ~]# virsh net-list #查看当前kvm网络情况
 名称               状态     自动开始  持久
----------------------------------------------------------
 default              活动     是           是

[root@kvm ~]# brctl show #查看当前宿主机网桥情况
bridge name    bridge id        STP enabled    interfaces
virbr0        8000.525400ccc5d5    yes        virbr0-nic
[root@kvm ~]# virsh net-dumpxml --network default  #查看default的xml文件
&lt;network&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;8e682a63-b77a-4aad-bc25-5d4d63a2a66e&lt;/uuid&gt;
  &lt;forward mode=&#39;nat&#39;&gt;
    &lt;nat&gt;
      &lt;port start=&#39;1024&#39; end=&#39;65535&#39;/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name=&#39;virbr0&#39; stp=&#39;on&#39; delay=&#39;0&#39;/&gt;
  &lt;mac address=&#39;52:54:00:cc:c5:d5&#39;/&gt;
  &lt;ip address=&#39;192.168.122.1&#39; netmask=&#39;255.255.255.0&#39;&gt;
    &lt;dhcp&gt;
      &lt;range start=&#39;192.168.122.2&#39; end=&#39;192.168.122.254&#39;/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
[root@kvm ~]# virsh iface-list #查看宿主机网卡情况，没有认到新增加的网卡（ens36），需要增加ifcfg-ens36的配置文件，可以通过virt-manager进行添加
 名称               状态     MAC 地址
---------------------------------------------------
 ens33                活动     00:0c:29:0b:57:dc
 lo                   活动     00:00:00:00:00:00
</code></pre>
<p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/3.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/4.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/5.jpg"></p>
<pre><code>[root@kvm ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens36  #查看通过virt-nanager自动生成的配置文件
DEVICE=&quot;ens36&quot;
HWADDR=&quot;00:0c:29:0b:57:e6&quot;
ONBOOT=&quot;no&quot;
BOOTPROTO=&quot;dhcp&quot;
[root@kvm ~]# virsh iface-list --all #可以识别到ens36网卡了
 名称               状态     MAC 地址
---------------------------------------------------
 ens33                活动     00:0c:29:0b:57:dc
 ens36                活动     00:0c:29:0b:57:e6
 lo                   活动     00:00:00:00:00:00
 [root@kvm ~]# modprobe --first-time bonding #查看系统是否安装了网桥的模块，如果没有就自动加载，这里没有报错，意思是当前系统没有加载，但是已经通过--first-time进行加载了
[root@kvm ~]# lsmod | grep bonding #查看已经正常加载
bonding               157075  0 
[root@kvm network-scripts]# pwd
/etc/sysconfig/network-scripts
[root@kvm network-scripts]# ls -lha ifcfg-ens* #查看当前网卡的配置文件
-rw-r--r--. 1 root root 280 4月   2 15:41 ifcfg-ens33
-rw-r--r--. 1 root root  71 4月   2 19:37 ifcfg-ens36
[root@kvm network-scripts]# cp ifcfg-ens33 ifcfg-ens33-bak #备份文件
[root@kvm network-scripts]# cp ifcfg-ens36 ifcfg-ens36-bak 
[root@kvm network-scripts]# vim ifcfg-ens33 #编辑网卡文件
TYPE=Ethernet
BOOTPROTO=none
NAME=ens33
DEVICE=ens33
ONBOOT=yes
MASTER=bond0
SLAVE=yes
NM_CONTROLLERD=no #非必须
USERCTL=no #非必须
[root@kvm network-scripts]# vim ifcfg-ens36 #编辑网卡文件
TYPE=Ethernet
BOOTPROTO=none
NAME=ens36
DEVICE=ens36
ONBOOT=yes
MASTER=bond0
SLAVE=yes
NM_CONTROLLERD=no
USERCTL=no 
[root@kvm network-scripts]# vim ifcfg-bond0 #新建bond0文件
DEVICE=bond0
ONBOOT=yes
NM_CONTROLLERD=no
USERCTL=no
BONDING_OPTS=&quot;mode=1 miimon=100 fail_over_mac=1&quot;
BOOTPROTO=static
IPADDR=192.168.187.134
NETMASK=255.255.255.0
GATEWAY=192.168.187.1
DNS1=223.5.5.5
[root@kvm network-scripts]# systemctl restart network #重启网络服务，远程时谨慎！
连接已成功激活（master waiting for slaves）（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/5）
[root@kvm network-scripts]# ip a 
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master bond0 state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
5: ens36: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master bond0 state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
6: bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet 192.168.187.134/24 brd 192.168.187.255 scope global noprefixroute bond0
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe0b:57dc/64 scope link 
       valid_lft forever preferred_lft forever
[root@kvm network-scripts]# dmesg |grep bond0 #查看日志
[ 2586.969003] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2586.969152] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2586.971585] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2586.979903] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2587.011775] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2635.311460] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2635.457459] IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready
[ 2635.590868] bond0: making interface ens33 the new active one
[ 2635.596124] bond0: Enslaving ens33 as an active interface with an up link
[ 2635.596466] IPv6: ADDRCONF(NETDEV_CHANGE): bond0: link becomes ready
[ 2635.700504] bond0: Releasing backup interface ens33
[ 2637.395032] bond0: Enslaving ens33 as a backup interface with a down link
[ 2637.483876] bond0: link status definitely up for interface ens33, 1000 Mbps full duplex
[ 2637.483882] bond0: making interface ens33 the new active one
[ 2637.491125] bond0: first active interface up!
[ 2637.764573] bond0: Enslaving ens36 as a backup interface with a down link
[ 2637.793398] bond0: link status definitely up for interface ens36, 1000 Mbps full duplex
[root@kvm network-scripts]# cat /proc/net/bonding/bond0  #查看内存中的文件
Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)

Bonding Mode: fault-tolerance (active-backup) #bond模式
Primary Slave: None
Currently Active Slave: ens33 #当前的主设备是ens33
MII Status: up #主设备的当前状态
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

Slave Interface: ens33
MII Status: up
Speed: 1000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:0c:29:0b:57:dc
Slave queue ID: 0

Slave Interface: ens36
MII Status: up
Speed: 1000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:0c:29:0b:57:e6
Slave queue ID: 0
</code></pre>
<blockquote>
<p>与真机环境有所不同，vmware虚拟机下给linux系统做bond0网卡配置，照这样做完后，测试发现down掉eth0后，bond0网卡ping不通，无法起到网卡备份效果。BONDING_OPTS&#x3D;“fail_over_mac&#x3D;1”配置解释: 默认fail_over_mac&#x3D;0，当发生错误时，只改slave的mac不改bond；fail_over_mac&#x3D;1时，只改blave。</p>
</blockquote>
<h3><span id="1-bond的模式">1、Bond的模式</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.likecs.com/show-308299629.html">网卡的7种bond模式</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45548465/article/details/122625777">Linux网卡bond的七种模式详解，⽹卡绑定(bond)怎么实现？有哪些绑定⽅式</a>：</p>
</blockquote>
<table>
<thead>
<tr>
<th>模式</th>
<th>名称</th>
<th>特点</th>
<th>负载均衡</th>
<th>交换机配置</th>
<th>条件</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>(balance-rr) Round-robin policy（平衡抡循环策略）</td>
<td>输数据包顺序是依次传输（即：第1个包走eth0，下一个包就走eth1….一直循环下去，直到最后一个传 输完毕），此模式提供负载平衡和容错能力。</td>
<td>是</td>
<td>静态聚合</td>
<td></td>
</tr>
<tr>
<td>1</td>
<td>(active-backup) Active-backup policy（主-备份策略）</td>
<td>只有一个设备处于活动状态，当一个宕掉另一个马上由备份转换为主设备。mac地址是外部可见得，从外面看来，bond的MAC地址是唯一的，以避免switch(交换机)发生混乱。此模式只提供了容错能力；由此可见此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1&#x2F;N。</td>
<td>否</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>(balance-xor) XOR policy（平衡策略）</td>
<td>基于指定的传输HASH策略传输数据包。缺省的策略是：(源MAC地址 XOR 目标MAC地址) % slave数量。</td>
<td>是</td>
<td>静态聚合</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>broadcast（广播策略</td>
<td>每个slave接口上传输每个数据包，此模式提供了容错能力。</td>
<td>否</td>
<td>静态聚合</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>(802.3ad) IEEE 802.3adDynamic link aggregation（IEEE 802.3ad 动态链接聚合）</td>
<td>创建一个聚合组，它们共享同样的速率和双工设定。根据802.3ad规范将多个slave工作在同一个激活的聚合体下。</td>
<td>是</td>
<td>支持IEEE 802.3ad动态聚合</td>
<td>条件1：ethtool支持获取每个slave的速率和双工设定。<br>条件2：switch(交换机)支持IEEE 802.3ad Dynamic link aggregation。<br>条件3：大多数switch(交换机)需要经过特定配置才能支持802.3ad模式。<br></td>
</tr>
<tr>
<td>5</td>
<td>(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）</td>
<td>不需要任何特别的switch(交换机)支持的通道bonding。在每个slave上根据当前的负载（根据速度计算）分配外出流量。如果正在接受数据的slave出故障了，另一个slave接管失败的slave的MAC地址。</td>
<td>是</td>
<td>否</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>(balance-alb) Adaptive load balancing（适配器适应性负载均衡）</td>
<td>该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡(receive load balance,rlb)，而且不需要任何switch(交换机)的支持。</td>
<td>是</td>
<td>否</td>
<td></td>
</tr>
</tbody></table>
<h2><span id="2-配置网桥">2、配置网桥</span></h2><pre><code>[root@kvm ~]# vim /etc/sysconfig/network-scripts/ifcfg-virbr1 #新建网桥virbr1的配置文件
DEVICE=virbr1
ONBOOT=yes
TYPE=Bridge
NM_CONTROLLER=no
USERCTL=no
BOOTPROTO=static
IPADDR=192.168.187.134
NETMASK=255.255.255.0
GATEWAY=192.168.187.1
[root@kvm ~]# vim /etc/sysconfig/network-scripts/ifcfg-bond0  #修改bond0的配置文件
DEVICE=bond0
ONBOOT=yes
NM_CONTROLLERD=no
USERCTL=no
BONDING_OPTS=&quot;mode=1 miimon=100 fail_over_mac=1&quot;
BOOTPROTO=none
BRIDGE=virbr1
[root@kvm ~]# systemctl restart network #重启网络服务
[root@kvm ~]# brctl show  #查看当前系统网桥
bridge name    bridge id        STP enabled    interfaces
virbr0        8000.525400ccc5d5    yes        virbr0-nic
virbr1        8000.000c290b57dc    no        bond0
[root@kvm ~]# ip addr show virbr1 #查看IP已经到网桥1中了
18: virbr1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet 192.168.187.134/24 brd 192.168.187.255 scope global noprefixroute virbr1
       valid_lft forever preferred_lft forever
    inet6 fe80::5c15:77ff:fece:bc31/64 scope link 
       valid_lft forever preferred_lft forever
[root@kvm qemu]# cat /etc/libvirt/qemu/generic.xml #查看连接的虚拟机接口配置
    &lt;interface type=&#39;bridge&#39;&gt;
      &lt;mac address=&#39;52:54:00:8e:67:0a&#39;/&gt;
      &lt;source bridge=&#39;virbr1&#39;/&gt;
      &lt;model type=&#39;rtl8139&#39;/&gt;
      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;
    &lt;/interface&gt;
[root@kvm qemu]# brctl show #查看多了个net0
bridge name    bridge id        STP enabled    interfaces
virbr0        8000.525400ccc5d5    yes        virbr0-nic
virbr1        8000.000c290b57dc    no        bond0
                            vnet0
[root@kvm qemu]# virsh domiflist --domain generic  #查看接口信息，模式是8139，可以修改成virto优化性能
Interface  Type       Source     Model       MAC
-------------------------------------------------------
vnet0      bridge     virbr1     rtl8139     52:54:00:8e:67:0a
</code></pre>
<h1><span id="2-配置vlan">2、配置Vlan</span></h1><p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/6.jpg"></p>
<p><strong>不建议使用nmcli创建</strong></p>
<table>
<thead>
<tr>
<th>网络</th>
<th>地址段</th>
<th>Vlan-id</th>
</tr>
</thead>
<tbody><tr>
<td>管理网络</td>
<td>192.168.200.0&#x2F;24</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>生产网络</td>
<td>172.16.11.0&#x2F;24 172.16.11.11</td>
<td>11</td>
</tr>
<tr>
<td>生产网络</td>
<td>172.16.12.0&#x2F;24 172.16.12.12</td>
<td>12</td>
</tr>
</tbody></table>
<p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/7.jpg"></p>
<h2><span id="1-nmcli方法">1、nmcli方法</span></h2><pre><code>[root@kvm ~]# nmcli --help #查看帮助文档
Usage: nmcli [OPTIONS] OBJECT &#123; COMMAND | help &#125;

OPTIONS
  -a, --ask                                ask for missing parameters
  -c, --colors auto|yes|no                 whether to use colors in output
  -e, --escape yes|no                      escape columns separators in values
  -f, --fields &lt;field,...&gt;|all|common      specify fields to output
  -g, --get-values &lt;field,...&gt;|all|common  shortcut for -m tabular -t -f
  -h, --help                               print this help
  -m, --mode tabular|multiline             output mode
  -o, --overview                           overview mode
  -p, --pretty                             pretty output
  -s, --show-secrets                       allow displaying passwords
  -t, --terse                              terse output
  -v, --version                            show program version
  -w, --wait &lt;seconds&gt;                     set timeout waiting for finishing operations

OBJECT
  g[eneral]       NetworkManager&#39;s general status and operations
  n[etworking]    overall networking control
  r[adio]         NetworkManager radio switches
  c[onnection]    NetworkManager&#39;s connections
  d[evice]        devices managed by NetworkManager
  a[gent]         NetworkManager secret agent or polkit agent
  m[onitor]       monitor NetworkManager changes
[root@kvm network-scripts]# nmcli connection show  #查看当前网络信息
NAME          UUID                                  TYPE      DEVICE 
System ens33  c96bc909-188e-ec64-3a96-6a90982b08ad  ethernet  ens33  
System ens36  418da202-9a8c-b73c-e8a1-397e00f3c6b2  ethernet  ens36  
virbr0        41366568-f66f-4c8b-a2f6-cb4df1714e06  bridge    virbr0 
有线连接 1    52522e57-4b72-3d75-a602-ce47588f745d  ethernet  --     
[root@kvm network-scripts]# nmcli connection add type vlan ifname VLAN11 dev ens33 id 11 #基于ens33创建vlan11
Connection &#39;vlan-VLAN11&#39; (193348c2-73b4-4962-981c-4fdd7a966926) successfully added.
[root@kvm network-scripts]# nmcli connection add type vlan ifname VLAN12 dev ens33 id 12 #基于ens33创建vlan12    
Connection &#39;vlan-VLAN12&#39; (60496196-b1ee-4ff6-93fc-e167f25e63c7) successfully added.
[root@kvm network-scripts]# pwd 
/etc/sysconfig/network-scripts
[root@kvm network-scripts]# ls -lha | grep vlan  #查看自动创建的文件
-rw-r--r--. 1 root root  357 Apr  8 05:08 ifcfg-vlan-VLAN11
-rw-r--r--. 1 root root  357 Apr  8 05:08 ifcfg-vlan-VLAN12
[root@kvm network-scripts]# cat ifcfg-vlan-VLAN11 #查看具体信息
VLAN=yes
TYPE=Vlan
PHYSDEV=ens33
VLAN_ID=11
REORDER_HDR=yes
GVRP=no
MVRP=no
HWADDR=
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=vlan-VLAN11
UUID=193348c2-73b4-4962-981c-4fdd7a966926
DEVICE=VLAN11
ONBOOT=yes
[root@kvm network-scripts]# nmcli connection show  #查看创建的链接
NAME          UUID                                  TYPE      DEVICE 
System ens33  c96bc909-188e-ec64-3a96-6a90982b08ad  ethernet  ens33  
System ens36  418da202-9a8c-b73c-e8a1-397e00f3c6b2  ethernet  ens36  
virbr0        41366568-f66f-4c8b-a2f6-cb4df1714e06  bridge    virbr0 
vlan-VLAN11   193348c2-73b4-4962-981c-4fdd7a966926  vlan      --     
vlan-VLAN12   60496196-b1ee-4ff6-93fc-e167f25e63c7  vlan      --     
有线连接 1    52522e57-4b72-3d75-a602-ce47588f745d  ethernet  --  
[root@kvm network-scripts]# ip a #查看创建结果
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet 192.168.200.128/24 brd 192.168.200.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe0b:57dc/64 scope link 
       valid_lft forever preferred_lft forever
3: ens36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:e6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.200.135/24 brd 192.168.200.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
6: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
7: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
13: vnet0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether fe:54:00:8e:67:0a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::fc54:ff:fe8e:670a/64 scope link 
       valid_lft forever preferred_lft forever
25: VLAN12@ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet6 fe80::eb51:86e8:ea1f:f322/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
26: VLAN11@ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet6 fe80::a47d:f2c7:75fc:7e54/64 scope link tentative noprefixroute 
       valid_lft forever preferred_lft forever
[root@kvm network-scripts]# tail -n 20 /var/log/messages #查看日志
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5135] dhcp4 (VLAN12): canceled DHCP transaction, DHCP client pid 15817
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5136] dhcp4 (VLAN12): state changed timeout -&gt; done
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5141] device (VLAN12): state change: ip-config -&gt; failed (reason &#39;ip-config-unavailable&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;warn&gt;  [1680902267.5150] device (VLAN12): Activation: failed for connection &#39;vlan-VLAN12&#39;
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5152] device (VLAN12): state change: failed -&gt; disconnected (reason &#39;none&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5602] device (VLAN12): state change: disconnected -&gt; unmanaged (reason &#39;user-requested&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5609] policy: auto-activating connection &#39;vlan-VLAN12&#39; (60496196-b1ee-4ff6-93fc-e167f25e63c7)
Apr  8 05:17:47 kvm kernel: IPv6: ADDRCONF(NETDEV_UP): VLAN12: link is not ready
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5637] device (VLAN12): state change: unmanaged -&gt; unavailable (reason &#39;managed&#39;, sys-iface-state: &#39;external&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5862] device (VLAN12): carrier: link connected
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.5881] device (VLAN12): state change: unavailable -&gt; disconnected (reason &#39;user-requested&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6013] device (VLAN12): Activation: starting connection &#39;vlan-VLAN12&#39; (60496196-b1ee-4ff6-93fc-e167f25e63c7)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6023] device (VLAN12): state change: disconnected -&gt; prepare (reason &#39;none&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6033] device (VLAN12): state change: prepare -&gt; config (reason &#39;none&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6366] device (VLAN12): state change: config -&gt; ip-config (reason &#39;none&#39;, sys-iface-state: &#39;managed&#39;)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6373] dhcp4 (VLAN12): activation: beginning transaction (timeout in 45 seconds)
Apr  8 05:17:47 kvm NetworkManager[786]: &lt;info&gt;  [1680902267.6465] dhcp4 (VLAN12): dhclient started with pid 15847
Apr  8 05:17:47 kvm dhclient[15847]: DHCPDISCOVER on VLAN12 to 255.255.255.255 port 67 interval 7 (xid=0x1a408bc7)
Apr  8 05:17:52 kvm dhclient[15834]: DHCPDISCOVER on VLAN11 to 255.255.255.255 port 67 interval 6 (xid=0x6c741821)
Apr  8 05:17:54 kvm dhclient[15847]: DHCPDISCOVER on VLAN12 to 255.255.255.255 port 67 interval 20 (xid=0x1a408bc7)
[root@kvm network-scripts]# virsh iface-list #在kvm上看
 Name                 State      MAC Address
---------------------------------------------------
 ens33                active     00:0c:29:0b:57:dc
 ens36                active     00:0c:29:0b:57:e6
 lo                   active     00:00:00:00:00:00
 VLAN11               active     00:0c:29:0b:57:dc
 VLAN12               active     00:0c:29:0b:57:dc
[root@kvm network-scripts]# rm -rf ifcfg-vlan-VLAN1* #恢复设置
[root@kvm network-scripts]# systemctl restart network #重启
[root@kvm network-scripts]# nmtui #图形化界面，不好用
</code></pre>
<p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/8.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/9.jpg"></p>
<h2><span id="2-通过命令行创建">2、通过命令行创建</span></h2><pre><code>[root@kvm network-scripts]# vim ifcfg-ens36.11 #创建vlan11配置文件
DEVICE=&quot;ens36.11&quot;
VLAN=&quot;yes&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=&quot;none&quot;
IPADDR=&quot;172.16.11.11&quot;
NETMASK=&quot;255.255.255.0&quot;
[root@kvm network-scripts]# cp ifcfg-ens36.11 ifcfg-ens36.12 #创建vlan11配置文件并修改
[root@kvm network-scripts]# vim ifcfg-ens36.12 #配置
DEVICE=&quot;ens36.12&quot;
VLAN=&quot;yes&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=&quot;none&quot;
IPADDR=&quot;172.16.12.12&quot;
NETMASK=&quot;255.255.255.0&quot;
[root@kvm network-scripts]# systemctl restart network #重启网络配置
[root@kvm network-scripts]# nmcli connection show  #查看配置是否生效
NAME           UUID                                  TYPE      DEVICE   
System ens33   c96bc909-188e-ec64-3a96-6a90982b08ad  ethernet  ens33    
Vlan ens36.11  5aaffcd1-84a5-3046-15e7-adb62160402b  vlan      ens36.11 
Vlan ens36.12  d100f2b5-85f7-4961-2105-8874b119178a  vlan      ens36.12 
System ens36   418da202-9a8c-b73c-e8a1-397e00f3c6b2  ethernet  ens36    
virbr0         41366568-f66f-4c8b-a2f6-cb4df1714e06  bridge    virbr0   
有线连接 1     52522e57-4b72-3d75-a602-ce47588f745d  ethernet  --      
[root@kvm network-scripts]# ip addr #查看IP
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:dc brd ff:ff:ff:ff:ff:ff
    inet 192.168.200.128/24 brd 192.168.200.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe0b:57dc/64 scope link 
       valid_lft forever preferred_lft forever
3: ens36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:e6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.200.135/24 brd 192.168.200.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
6: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
7: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:cc:c5:d5 brd ff:ff:ff:ff:ff:ff
13: vnet0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether fe:54:00:8e:67:0a brd ff:ff:ff:ff:ff:ff
    inet6 fe80::fc54:ff:fe8e:670a/64 scope link 
       valid_lft forever preferred_lft forever
32: ens36.12@ens36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:e6 brd ff:ff:ff:ff:ff:ff
    inet 172.16.12.12/24 brd 172.16.12.255 scope global noprefixroute ens36.12
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe0b:57e6/64 scope link 
       valid_lft forever preferred_lft forever
33: ens36.11@ens36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:0b:57:e6 brd ff:ff:ff:ff:ff:ff
    inet 172.16.11.11/24 brd 172.16.11.255 scope global noprefixroute ens36.11
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe0b:57e6/64 scope link 
       valid_lft forever preferred_lft forever
[root@kvm network-scripts]# virsh iface-list --all  #查看
 Name                 State      MAC Address
---------------------------------------------------
 ens33                active     00:0c:29:0b:57:dc
 ens36                active     00:0c:29:0b:57:e6
 ens36.11             active     00:0c:29:0b:57:e6
 ens36.12             active     00:0c:29:0b:57:e6
 lo                   active     00:00:00:00:00:00
</code></pre>
<p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/10.jpg"></p>
<h2><span id="3-通过virt-manager创建">3、通过virt-manager创建</span></h2><p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/11.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/12.jpg"><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/13.jpg"></p>
<pre><code>[root@kvm network-scripts]# cat ifcfg-ens36.11 
DEVICE=&quot;ens36.11&quot;
VLAN=&quot;yes&quot;
ONBOOT=&quot;yes&quot;
BOOTPROTO=&quot;none&quot;
IPADDR=&quot;192.168.200.135&quot;
NETMASK=&quot;255.255.255.0&quot;
GATEWAY=&quot;192.168.200.2&quot;
</code></pre>
<h2><span id="4-虚拟机使用vlan">4、虚拟机使用vlan</span></h2><p><strong>一个vlan使用一个网桥，调用即可</strong><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/14.jpg"></p>
<h1><span id="3-配置网络过滤">3、配置网络过滤</span></h1><p><strong>通过libvirtd使用ebtailes创建的规则</strong><br><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/15.jpg"></p>
<pre><code>[root@kvm network-scripts]# virsh --help
  Network Filter (help keyword &#39;filter&#39;)
    nwfilter-define                define or update a network filter from an XML file
    nwfilter-dumpxml               network filter information in XML
    nwfilter-edit                  edit XML configuration for a network filter
    nwfilter-list                  list network filters
    nwfilter-undefine              undefine a network filter
    
    nwfilter-binding-create        create a network filter binding from an XML file
    nwfilter-binding-delete        delete a network filter binding
    nwfilter-binding-dumpxml       network filter information in XML
    nwfilter-binding-list          list network filter bindings
[root@kvm network-scripts]#  virsh nwfilter-list  #查看网络过滤列表
 UUID                                  Name                 
------------------------------------------------------------------
 3ce9cf03-2589-4b6a-8c1b-6e8b24e38f8e  allow-arp           
 a803defa-b342-47b4-af29-613250ff5281  allow-dhcp          
 5deae120-0ca4-4451-b8d4-92b6cd165962  allow-dhcp-server   
 49bdc080-9c7a-4278-9d83-59371bc9b981  allow-incoming-ipv4 
 64495a87-4efc-44f3-9aa2-1ef8e0a08600  allow-ipv4          
 cbd5d978-e475-4859-863d-1395d03da480  clean-traffic        #干净的流量
 14ed106c-6baa-4ffd-8f28-d5038fea01ef  clean-traffic-gateway
 f88bd332-81af-480f-af36-57a7cd35104e  no-arp-ip-spoofing  
 a7611c9f-2a3a-4f62-9039-4e5be77881b3  no-arp-mac-spoofing 
 92dfc42c-0ed9-4482-a8f4-eee46f168cb8  no-arp-spoofing     
 20951a13-4570-4a87-9aa5-587d128c899e  no-ip-multicast     
 be8c0f6f-c811-451d-ae18-7cef13c56380  no-ip-spoofing      
 d85ecc2e-5573-43a7-85c1-e88b4daa6fdd  no-mac-broadcast    
 108c0c1a-8471-48b5-998a-6d92226f084e  no-mac-spoofing     
 7101e610-2e76-495f-976a-e4a37dd3f6ef  no-other-l2-traffic 
 60911d33-fb36-46bf-8eec-eeacc2f0fe62  no-other-rarp-traffic
 40be9024-b924-4df0-b4c4-839e1026873f  qemu-announce-self  
 8bea3031-76ab-4077-9712-04d5b850e5fa  qemu-announce-self-rarp
[root@kvm network-scripts]# virsh nwfilter-dumpxml clean-traffic #查看详细信息
&lt;filter name=&#39;clean-traffic&#39; chain=&#39;root&#39;&gt; #默认规则及规则名称
  &lt;uuid&gt;cbd5d978-e475-4859-863d-1395d03da480&lt;/uuid&gt; #规则UUID
  &lt;filterref filter=&#39;no-mac-spoofing&#39;/&gt; #禁止MAC地址七篇
  &lt;filterref filter=&#39;no-ip-spoofing&#39;/&gt; #禁止IP地址欺骗
  &lt;rule action=&#39;accept&#39; direction=&#39;out&#39; priority=&#39;-650&#39;&gt; #accept代表动作，direction代表方向，in，out，inout，prioiy优先级，优先级值越低，优先级越高
    &lt;mac protocolid=&#39;ipv4&#39;/&gt; #ipv4的mac地址
  &lt;/rule&gt;
  &lt;filterref filter=&#39;allow-incoming-ipv4&#39;/&gt; #调用其他规则
  &lt;filterref filter=&#39;no-arp-spoofing&#39;/&gt;
  &lt;rule action=&#39;accept&#39; direction=&#39;inout&#39; priority=&#39;-500&#39;&gt;
    &lt;mac protocolid=&#39;arp&#39;/&gt;
  &lt;/rule&gt;
  &lt;filterref filter=&#39;no-other-l2-traffic&#39;/&gt; #调用其他规则
  &lt;filterref filter=&#39;qemu-announce-self&#39;/&gt;
&lt;/filter&gt;
[root@kvm network-scripts]# ebtables -t nat -L #查看ebtables的NAT表规则
Bridge table: nat

Bridge chain: PREROUTING, entries: 1, policy: ACCEPT
-j PREROUTING_direct

Bridge chain: OUTPUT, entries: 1, policy: ACCEPT
-j OUTPUT_direct

Bridge chain: POSTROUTING, entries: 1, policy: ACCEPT
-j POSTROUTING_direct

Bridge chain: PREROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: POSTROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: OUTPUT_direct, entries: 1, policy: ACCEPT
-j RETURN 
[root@kvm network-scripts]# virsh list --all  #查看虚拟机，准备于过滤规则绑定
 Id    Name                           State
----------------------------------------------------
 5     generic                        running
 -     centos7.0                      shut off
[root@kvm network-scripts]# virsh dumpxml --domain generic
    &lt;interface type=&#39;bridge&#39;&gt;
      &lt;mac address=&#39;52:54:00:8e:67:0a&#39;/&gt;
      &lt;source bridge=&#39;virbr1&#39;/&gt;
      &lt;target dev=&#39;vnet0&#39;/&gt;
      &lt;model type=&#39;rtl8139&#39;/&gt;
      &lt;alias name=&#39;net0&#39;/&gt;
      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;
    &lt;/interface&gt;
[root@kvm ~]# vim nwtest.xml
    &lt;interface type=&#39;bridge&#39;&gt;
      &lt;mac address=&#39;52:54:00:8e:67:0a&#39;/&gt;
      &lt;source bridge=&#39;virbr1&#39;/&gt;
      &lt;target dev=&#39;vnet0&#39;/&gt;
      &lt;model type=&#39;rtl8139&#39;/&gt;
      &lt;alias name=&#39;net0&#39;/&gt;
      &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x03&#39; function=&#39;0x0&#39;/&gt;
      &lt;filterref filter=&#39;clean-traffic&#39;/&gt; #增加过滤规则，调用clean-traffic
    &lt;/interface&gt;
[root@kvm ~]# virsh update-device --domain generic --file /root/nwtest.xml --persistent --live #更新generic主机，--file选择创建的文件，--persistent 代表永久生效，--live代表当前主机正在运行
Device updated successfully
[root@kvm ~]#  ebtables -t nat -L  #查看规则生效情况
Bridge table: nat

Bridge chain: PREROUTING, entries: 2, policy: ACCEPT
-j PREROUTING_direct
-i vnet0 -j libvirt-I-vnet0

Bridge chain: OUTPUT, entries: 1, policy: ACCEPT
-j OUTPUT_direct

Bridge chain: POSTROUTING, entries: 1, policy: ACCEPT
-j POSTROUTING_direct

Bridge chain: PREROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: POSTROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: OUTPUT_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: libvirt-I-vnet0, entries: 4, policy: ACCEPT
-s ! 52:54:0:8e:67:a -j DROP 
-p IPv4 -j ACCEPT 
-p ARP -j ACCEPT 
-j DROP 
[root@kvm ~]# virsh shutdown --domain generic  #关闭虚拟机
Domain generic is being shutdown

[root@kvm ~]# virsh list --all  #查看主机是否正常关闭
 Id    Name                           State
----------------------------------------------------
 -     centos7.0                      shut off
 -     generic                        shut off

[root@kvm ~]#  ebtables -t nat -L  #查看规则清空
Bridge table: nat

Bridge chain: PREROUTING, entries: 1, policy: ACCEPT
-j PREROUTING_direct

Bridge chain: OUTPUT, entries: 1, policy: ACCEPT
-j OUTPUT_direct

Bridge chain: POSTROUTING, entries: 1, policy: ACCEPT
-j POSTROUTING_direct

Bridge chain: PREROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: POSTROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: OUTPUT_direct, entries: 1, policy: ACCEPT
-j RETURN 
[root@kvm ~]# virsh start --domain generic  #重新启动主机



Domain generic started
[root@kvm ~]#  ebtables -t nat -L  #再次查看规则
Bridge table: nat

Bridge chain: PREROUTING, entries: 2, policy: ACCEPT
-j PREROUTING_direct
-i vnet0 -j libvirt-I-vnet0

Bridge chain: OUTPUT, entries: 1, policy: ACCEPT
-j OUTPUT_direct

Bridge chain: POSTROUTING, entries: 1, policy: ACCEPT
-j POSTROUTING_direct

Bridge chain: PREROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: POSTROUTING_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: OUTPUT_direct, entries: 1, policy: ACCEPT
-j RETURN 

Bridge chain: libvirt-I-vnet0, entries: 4, policy: ACCEPT
-s ! 52:54:0:8e:67:a -j DROP 
-p IPv4 -j ACCEPT 
-p ARP -j ACCEPT 
-j DROP 
</code></pre>
<p><img src="/images/KVM/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/16.jpg"></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
        </article>

        
            
  <div class="nexmoe-post-copyright">
    <strong>Author：</strong>张博丞<br>
    
      <strong>From：</strong><a href="/%E5%8E%9F%E5%88%9B" title="原创" target="_blank" rel="noopener">原创</a><br>
    
    <strong>Link：</strong><a href="https://zhangboc.github.io/2023/04/12/KVM/1.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8B%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" title="https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;12&#x2F;KVM&#x2F;1.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8B%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;12&#x2F;KVM&#x2F;1.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8B%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE&#x2F;</a><br>

    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


        

        <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/KVM/">KVM</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/KVM/" rel="tag">KVM</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/KVM%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" rel="tag">KVM虚拟网络高级配置</a>
    
</div>

    <div class="nexmoe-post-footer">
        <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://lib.baomitu.com/valine/1.3.9/Valine.min.js'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'r5zxC0st0DDjPA9auXzMV7HY-gzGzoHsz',
        appKey: '3bqCsovpyfTPHUzTHovd3V3V'
    })
</script>
</section>
    </div>
</div>
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
            <div class="nexmoe-pd-item">
                <div class="qweather" >
    <div id="he-plugin-standard"></div>
    <div class="qweather-logo">

    </div>

</div>
<style>
    .qweather{
        position: relative;
    }
    .qweather-logo{
        position: absolute;
        right: 0;
        top: -15px;
        width: 40px;
        height: 40px;
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
</style>
<script>
  WIDGET = {
    "CONFIG": {
      "layout": "2",
      "width": "260",
      "height": "220",
      "background": "5",
      "dataColor": "e67249",
      "borderRadius": "15",
      "key": "f74d1e1690e6432d801e97fa2f05a162"
    }
  }
</script>
<script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://lib.baomitu.com/lazysizes/5.1.0/lazysizes.min.js"></script>
<script src="https://lib.baomitu.com/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://lib.baomitu.com/mdui/0.4.3/js/mdui.min.js"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://lib.baomitu.com/jquery/3.5.1/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1681876082784"></script>

<script src="https://lib.baomitu.com/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://lib.baomitu.com/clipboard.js/2.0.8/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --><script src="/live2D/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2D/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"model":{"jsonPath":"/live2D/assets/xiaomai.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/5e784416.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "5e784416"
  });
  daovoice('update');
</script>

