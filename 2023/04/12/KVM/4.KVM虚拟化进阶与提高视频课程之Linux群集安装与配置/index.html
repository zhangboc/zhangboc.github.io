<!DOCTYPE html>

<html lang="en">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>KVM虚拟化进阶之Linux群集安装与配置 - Hexo</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />

  <link rel="shortcut icon" href="/images/head/head.jpg" type="image/png" />
  <meta property="og:type" content="article">
<meta property="og:title" content="KVM虚拟化进阶之Linux群集安装与配置">
<meta property="og:url" content="https://zhangboc.github.io/2023/04/12/KVM/4.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8BLinux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/60.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/61.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/62.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/63.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/64.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/65.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/65.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/66.png">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/67.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/67.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/68.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/69.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/70.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/71.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/72.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/73.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/74.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/75.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/76.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/77.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/78.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/79.png">
<meta property="article:published_time" content="2023-04-11T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-16T11:14:00.623Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="KVM">
<meta property="article:tag" content="Linux HA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangboc.github.io/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/60.jpg">
  <link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/9.15.8/styles/atom-one-dark.min.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://lib.baomitu.com/justifiedGallery/3.8.1/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1681647440575">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiaomai.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/lihui.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="John Doe" class="mdui-btn mdui-btn-icon"><img src="/images/head/head.jpg" alt="John Doe"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="John Doe">
            <img src="/images/head/head.jpg" alt="John Doe" alt="John Doe">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>15 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>12<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>3<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/index.html" title="关于我">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend/index.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/download/index.html" title="下载中心">
            <i class="mdui-list-item-icon nexmoefont icon-tangguo"></i>
            <div class="mdui-list-item-content">
                下载中心
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=1605643129&Site=%E5%8C%97%E4%BA%ACSEO&Menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(64, 196, 255);background-color: rgba(64, 196, 255, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="mailto:1605643129@qq.com" target="_blank" mdui-tooltip="{content: 'mail'}" style="color: rgb(249,8,8);background-color: rgba(249,8,8,.1);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a><a class="mdui-ripple" href="https://blog.csdn.net/qq_40855827?type=blog" target="_blank" mdui-tooltip="{content: 'CSDN'}" style="color: rgb(199,29,35);background-color: rgba(199,29,35,.1);">
            <i class="nexmoefont icon-csdn"></i>
        </a><a class="mdui-ripple" href="https://home.cnblogs.com/u/1882665" target="_blank" mdui-tooltip="{content: '博客园'}" style="color: rgb(66, 214, 29);background-color: rgba(66, 214, 29, .1);">
            <i class="nexmoefont icon-bokeyuan"></i>
        </a><a class="mdui-ripple" href="https://github.com/zhangboc" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://gitee.com/with-the-wind-yue" target="_blank" mdui-tooltip="{content: 'gitee'}" style="color: rgb(255, 255, 255);background-color: rgb(199,29,35);">
            <i class="nexmoefont icon-mayun"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/">Ceph</a>
          <span class="category-list-count">9</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/KVM/">KVM</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/hexo/">hexo</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Ceph/" style="font-size: 20px;">Ceph</a> <a href="/tags/CephFS/" style="font-size: 10px;">CephFS</a> <a href="/tags/Ceph%E7%AE%80%E4%BB%8B/" style="font-size: 10px;">Ceph简介</a> <a href="/tags/KVM/" style="font-size: 16.67px;">KVM</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB/" style="font-size: 10px;">KVM虚拟机迁移</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">KVM虚拟网络高级配置</a> <a href="/tags/Linux-HA/" style="font-size: 13.33px;">Linux HA</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/RBD/" style="font-size: 13.33px;">RBD</a> <a href="/tags/RGW/" style="font-size: 10px;">RGW</a> <a href="/tags/chatjs/" style="font-size: 10px;">chatjs</a> <a href="/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" style="font-size: 10px;">故障排查</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">15</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 John Doe
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/zhangboc/hexo.github.io/" target="_blank">ZhangboCheng</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">辽ICP备2021002341号</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
        <script>
            var now = new Date(); 
            function createtime() { 
                var grt= new Date("08/10/2018 17:38:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
                now.setTime(now.getTime()+250); 
                days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>


        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    
        <div class="nexmoe-post-cover" style="padding-bottom: 26.666666666666668%;">
            <img data-src="https://img1.baidu.com/it/u=413643897,2296924942&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" data-sizes="auto" alt="KVM虚拟化进阶之Linux群集安装与配置" class="lazyload">
            <h1>KVM虚拟化进阶之Linux群集安装与配置</h1>
        </div>
    

        <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年04月12日</a>
    <a><i class="nexmoefont icon-areachart"></i>5.5k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 32 分钟</a>
</div>

        <div class="nexmoe-post-right">
            
        </div>

        <article>
            <h1><span id></span></h1><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#1-%E8%A7%84%E5%88%92%E8%AE%BE%E8%AE%A1">1、规划设计</a></li>
<li><a href="#2-%E7%BE%A4%E9%9B%86%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85">2、群集组件安装</a></li>
<li><a href="#3-%E7%BE%A4%E9%9B%86%E8%8A%82%E7%82%B9%E5%87%86%E5%A4%87">3、群集节点准备</a><ul>
<li><a href="#1-%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E5%8F%8A%E8%A7%A3%E6%9E%90">1、配置主机名及解析</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AEssh-key%E4%BA%92%E4%BF%A1%E5%8F%AF%E9%80%89">2、配置SSH Key互信（可选）</a></li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E6%97%B6%E9%92%9F">3、配置时钟</a></li>
<li><a href="#4-%E9%85%8D%E7%BD%AEiptables%E9%98%B2%E7%81%AB%E5%A2%99%E5%85%81%E8%AE%B8%E9%9B%86%E7%BE%A4%E7%BB%84%E4%BB%B6%E8%BF%90%E8%A1%8C">4、配置iptables防火墙允许集群组件运行</a></li>
<li><a href="#5-%E9%85%8D%E7%BD%AEpcs%E5%AE%88%E6%8A%A4%E7%A8%8B%E5%BA%8F">5、配置pcs守护程序</a></li>
<li><a href="#6-%E9%85%8D%E7%BD%AEhacluster%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81">6、配置hacluster账户密码</a></li>
<li><a href="#7-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">7、编辑配置文件</a></li>
</ul>
</li>
<li><a href="#4-%E7%BE%A4%E9%9B%86%E7%9A%84%E5%88%9B%E5%BB%BA">4、群集的创建</a></li>
</ul>
<!-- tocstop -->

<h1><span id="1-规划设计">1、规划设计</span></h1><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/60.jpg"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/61.jpg"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/62.png"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/63.png"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/64.png"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/65.png"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/65.png"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/66.png"></p>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>管理地址</th>
<th>心跳地址</th>
<th>存储地址</th>
</tr>
</thead>
<tbody><tr>
<td>KVM</td>
<td>192.168.200.200</td>
<td>192.168.0.200</td>
<td>192.168.1.200</td>
</tr>
<tr>
<td>KVM2</td>
<td>192.168.200.201</td>
<td>192.168.0.201</td>
<td>192.168.1.201</td>
</tr>
</tbody></table>
<h1><span id="2-群集组件安装">2、群集组件安装</span></h1><p><strong>1、查看需要安装的软件包</strong></p>
<p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/67.jpg"></p>
<pre><code>[root@kvm ~]# yum list  | grep pacemaker
drbd-pacemaker.x86_64                    9.17.0-1.el7                  epel   
pacemaker.x86_64                         1.1.23-1.el7_9.1              updates
pacemaker-cli.x86_64                     1.1.23-1.el7_9.1              updates
pacemaker-cluster-libs.i686              1.1.23-1.el7_9.1              updates
pacemaker-cluster-libs.x86_64            1.1.23-1.el7_9.1              updates
pacemaker-cts.x86_64                     1.1.23-1.el7_9.1              updates
pacemaker-doc.x86_64                     1.1.23-1.el7_9.1              updates
pacemaker-libs.i686                      1.1.23-1.el7_9.1              updates
pacemaker-libs.x86_64                    1.1.23-1.el7_9.1              updates
pacemaker-libs-devel.i686                1.1.23-1.el7_9.1              updates
pacemaker-libs-devel.x86_64              1.1.23-1.el7_9.1              updates
pacemaker-nagios-plugins-metadata.x86_64 1.1.23-1.el7_9.1              updates
pacemaker-remote.x86_64                  1.1.23-1.el7_9.1              updates
</code></pre>
<p><strong>2、安装相关软件</strong></p>
<pre><code>[root@kvm ~]# yum install -y pacemaker corosync pcs psmisc policycoreutils-python fence-agents-all #所有集群节点都需要安装
Installed:
  corosync.x86_64 0:2.4.5-7.el7_9.2                         fence-agents-all.x86_64 0:4.2.1-41.el7_9.6                         pacemaker.x86_64 0:1.1.23-1.el7_9.1                         pcs.x86_64 0:0.9.169-3.el7.centos.3                         policycoreutils-python.x86_64 0:2.5-34.el7                        

Dependency Installed:
  OpenIPMI.x86_64 0:2.0.27-1.el7                      OpenIPMI-libs.x86_64 0:2.0.27-1.el7                  OpenIPMI-modalias.x86_64 0:2.0.27-1.el7            audit-libs-python.x86_64 0:2.8.5-4.el7               checkpolicy.x86_64 0:2.5-8.el7                    cifs-utils.x86_64 0:6.2-10.el7                         
  clufter-bin.x86_64 0:0.77.1-1.el7                   clufter-common.noarch 0:0.77.1-1.el7                 corosynclib.x86_64 0:2.4.5-7.el7_9.2               device-mapper-multipath.x86_64 0:0.4.9-136.el7_9     fence-agents-amt-ws.x86_64 0:4.2.1-41.el7_9.6     fence-agents-apc.x86_64 0:4.2.1-41.el7_9.6             
  fence-agents-apc-snmp.x86_64 0:4.2.1-41.el7_9.6     fence-agents-bladecenter.x86_64 0:4.2.1-41.el7_9.6   fence-agents-brocade.x86_64 0:4.2.1-41.el7_9.6     fence-agents-cisco-mds.x86_64 0:4.2.1-41.el7_9.6     fence-agents-cisco-ucs.x86_64 0:4.2.1-41.el7_9.6  fence-agents-common.x86_64 0:4.2.1-41.el7_9.6          
  fence-agents-compute.x86_64 0:4.2.1-41.el7_9.6      fence-agents-drac5.x86_64 0:4.2.1-41.el7_9.6         fence-agents-eaton-snmp.x86_64 0:4.2.1-41.el7_9.6  fence-agents-emerson.x86_64 0:4.2.1-41.el7_9.6       fence-agents-eps.x86_64 0:4.2.1-41.el7_9.6        fence-agents-heuristics-ping.x86_64 0:4.2.1-41.el7_9.6 
  fence-agents-hpblade.x86_64 0:4.2.1-41.el7_9.6      fence-agents-ibmblade.x86_64 0:4.2.1-41.el7_9.6      fence-agents-ifmib.x86_64 0:4.2.1-41.el7_9.6       fence-agents-ilo-moonshot.x86_64 0:4.2.1-41.el7_9.6  fence-agents-ilo-mp.x86_64 0:4.2.1-41.el7_9.6     fence-agents-ilo-ssh.x86_64 0:4.2.1-41.el7_9.6         
  fence-agents-ilo2.x86_64 0:4.2.1-41.el7_9.6         fence-agents-intelmodular.x86_64 0:4.2.1-41.el7_9.6  fence-agents-ipdu.x86_64 0:4.2.1-41.el7_9.6        fence-agents-ipmilan.x86_64 0:4.2.1-41.el7_9.6       fence-agents-kdump.x86_64 0:4.2.1-41.el7_9.6      fence-agents-mpath.x86_64 0:4.2.1-41.el7_9.6           
  fence-agents-redfish.x86_64 0:4.2.1-41.el7_9.6      fence-agents-rhevm.x86_64 0:4.2.1-41.el7_9.6         fence-agents-rsa.x86_64 0:4.2.1-41.el7_9.6         fence-agents-rsb.x86_64 0:4.2.1-41.el7_9.6           fence-agents-sbd.x86_64 0:4.2.1-41.el7_9.6        fence-agents-scsi.x86_64 0:4.2.1-41.el7_9.6            
  fence-agents-vmware-rest.x86_64 0:4.2.1-41.el7_9.6  fence-agents-vmware-soap.x86_64 0:4.2.1-41.el7_9.6   fence-agents-wti.x86_64 0:4.2.1-41.el7_9.6         fence-virt.x86_64 0:0.3.2-16.el7                     ipmitool.x86_64 0:1.8.18-10.el7_9                 liberation-fonts-common.noarch 1:1.07.2-16.el7         
  liberation-sans-fonts.noarch 1:1.07.2-16.el7        libldb.x86_64 0:1.5.4-2.el7                          libqb.x86_64 0:1.0.1-9.el7                         libsemanage-python.x86_64 0:2.5-14.el7               libtalloc.x86_64 0:2.1.16-1.el7                   libtdb.x86_64 0:1.3.18-1.el7                           
  libtevent.x86_64 0:0.9.39-1.el7                     libwbclient.x86_64 0:4.10.16-24.el7_9                libwsman1.x86_64 0:2.6.3-7.git4391e5c.el7          net-snmp-libs.x86_64 1:5.7.2-49.el7_9.2              net-snmp-utils.x86_64 1:5.7.2-49.el7_9.2          openwsman-python.x86_64 0:2.6.3-7.git4391e5c.el7       
  overpass-fonts.noarch 0:2.1-1.el7                   pacemaker-cli.x86_64 0:1.1.23-1.el7_9.1              pacemaker-cluster-libs.x86_64 0:1.1.23-1.el7_9.1   pacemaker-libs.x86_64 0:1.1.23-1.el7_9.1             perl-TimeDate.noarch 1:2.30-2.el7                 pexpect.noarch 0:2.3-11.el7                            
  python-IPy.noarch 0:0.75-6.el7                      python-clufter.noarch 0:0.77.1-1.el7                 python-lxml.x86_64 0:3.2.1-4.el7                   python2-subprocess32.x86_64 0:3.2.6-14.el7           resource-agents.x86_64 0:4.1.1-61.el7_9.18        ruby.x86_64 0:2.0.0.648-39.el7_9                       
  ruby-irb.noarch 0:2.0.0.648-39.el7_9                ruby-libs.x86_64 0:2.0.0.648-39.el7_9                rubygem-bigdecimal.x86_64 0:1.2.0-39.el7_9         rubygem-io-console.x86_64 0:0.4.2-39.el7_9           rubygem-json.x86_64 0:1.7.7-39.el7_9              rubygem-psych.x86_64 0:2.0.0-39.el7_9                  
  rubygem-rdoc.noarch 0:4.0.0-39.el7_9                rubygems.noarch 0:2.0.14.1-39.el7_9                  samba-client-libs.x86_64 0:4.10.16-24.el7_9        samba-common.noarch 0:4.10.16-24.el7_9               samba-common-libs.x86_64 0:4.10.16-24.el7_9       setools-libs.x86_64 0:3.3.8-4.el7                      
  telnet.x86_64 1:0.17-66.el7                        

[root@kvm ~]# yum update -y
</code></pre>
<p><strong>3、查看相关软件描述</strong></p>
<p><strong>pacemaker</strong></p>
<pre><code>[root@kvm ~]# rpm -qi pacemaker
Name        : pacemaker
Version     : 1.1.23
Release     : 1.el7_9.1
Architecture: x86_64
Install Date: Thu 13 Apr 2023 03:21:10 PM CST
Group       : System Environment/Daemons
Size        : 1285198
License     : GPLv2+ and LGPLv2+
Signature   : RSA/SHA256, Fri 18 Dec 2020 04:35:18 AM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : pacemaker-1.1.23-1.el7_9.1.src.rpm
Build Date  : Wed 16 Dec 2020 12:40:01 AM CST
Build Host  : x86-02.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : http://www.clusterlabs.org
Summary     : Scalable High-Availability cluster resource manager
Description :Pacemaker是一种先进的、可扩展的高可用性集群资源Corosync、CMAN和/或Linux HA的管理器。它支持超过16个具有重要功能的节点群集用于管理资源和依赖关系。它将在初始化时运行脚本，当机器上升或下降时，当相关资源出现故障时，可以配置为定期检查资源健康。
可用的重建重建选项：
-with(out) :cman覆盖范围文档stonithd硬化预释放分析
</code></pre>
<p><strong>corosync</strong></p>
<pre><code>[root@kvm ~]# rpm -qi corosync
Name        : corosync
Version     : 2.4.5
Release     : 7.el7_9.2
Architecture: x86_64
Install Date: Thu 13 Apr 2023 03:21:06 PM CST
Group       : System Environment/Base
Size        : 485644
License     : BSD
Signature   : RSA/SHA256, Wed 01 Dec 2021 10:14:09 PM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : corosync-2.4.5-7.el7_9.2.src.rpm
Build Date  : Thu 25 Nov 2021 12:33:10 AM CST
Build Host  : x86-02.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : http://corosync.github.io/corosync/
Summary     : The Corosync Cluster Engine and Application Programming Interfaces
Description :
此软件包包含Corosync Cluster Engine Executive，几个默认配置API和库、默认配置文件以及init脚本。
</code></pre>
<p><strong>pcs</strong></p>
<pre><code>[root@kvm ~]# rpm -qi pcs
Name        : pcs
Version     : 0.9.169
Release     : 3.el7.centos.3
Architecture: x86_64
Install Date: Thu 13 Apr 2023 03:21:17 PM CST
Group       : System Environment/Base
Size        : 11483086
License     : GPLv2
Signature   : RSA/SHA256, Sat 12 Nov 2022 12:15:48 AM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : pcs-0.9.169-3.el7.centos.3.src.rpm
Build Date  : Thu 10 Nov 2022 09:56:56 PM CST
Build Host  : x86-02.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : https://github.com/ClusterLabs/pcs
Summary     : Pacemaker Configuration System
Description :
pcs是一种同步器和起搏器配置工具。它允许用户轻松查看、修改和创建基于起搏器的集群。
</code></pre>
<p><strong>psmisc</strong></p>
<pre><code>[root@kvm ~]# rpm -qi psmisc
Name        : psmisc
Version     : 22.20
Release     : 17.el7
Architecture: x86_64
Install Date: Sun 02 Apr 2023 03:58:57 PM CST
Group       : Applications/System
Size        : 486607
License     : GPLv2+
Signature   : RSA/SHA256, Thu 15 Oct 2020 02:59:05 AM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : psmisc-22.20-17.el7.src.rpm
Build Date  : Thu 01 Oct 2020 01:20:29 AM CST
Build Host  : x86-01.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : http://sourceforge.net/projects/psmisc
Summary     : Utilities for managing processes on your system
Description :
psmisc包包含用于管理
系统：pstree、killall和fuser。pstree命令显示一个树
系统上所有正在运行的进程的结构。杀手
命令将指定的信号（如果未指定任何内容，则为SIGTERM）发送到
通过名称标识的进程。热熔器命令识别PID
使用指定文件或文件系统的进程。
</code></pre>
<p><strong>policycoreutils-python</strong></p>
<pre><code>[root@kvm ~]# rpm -qi policycoreutils-python 
Name        : policycoreutils-python
Version     : 2.5
Release     : 34.el7
Architecture: x86_64
Install Date: Thu 13 Apr 2023 03:21:11 PM CST
Group       : System Environment/Base
Size        : 1304826
License     : GPLv2
Signature   : RSA/SHA256, Sat 04 Apr 2020 05:05:35 AM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : policycoreutils-2.5-34.el7.src.rpm
Build Date  : Wed 01 Apr 2020 12:04:58 PM CST
Build Host  : x86-02.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : http://www.selinuxproject.org
Summary     : SELinux policy core python utilities
Description :
policycoreutils-python包包含用于管理的管理工具SELinux环境。
</code></pre>
<p><strong>fence-agents-all</strong></p>
<pre><code>[root@kvm ~]# rpm -qi fence-agents-all 
Name        : fence-agents-all
Version     : 4.2.1
Release     : 41.el7_9.6
Architecture: x86_64
Install Date: Thu 13 Apr 2023 03:21:15 PM CST
Group       : System Environment/Base
Size        : 0
License     : GPLv2+ and LGPLv2+ and ASL 2.0
Signature   : RSA/SHA256, Thu 07 Apr 2022 01:04:19 AM CST, Key ID 24c6a8a7f4a80eb5
Source RPM  : fence-agents-4.2.1-41.el7_9.6.src.rpm
Build Date  : Wed 06 Apr 2022 12:26:21 AM CST
Build Host  : x86-01.bsys.centos.org
Relocations : (not relocatable)
Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;
Vendor      : CentOS
URL         : https://github.com/ClusterLabs/fence-agents
Summary     : Fence agents
Description :
Red Hat围栏代理是所有受支持的围栏代理的集合。
</code></pre>
<h1><span id="3-群集节点准备">3、群集节点准备</span></h1><h2><span id="1-配置主机名及解析">1、配置主机名及解析</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/67.jpg"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/68.jpg"><br>node1:</p>
<pre><code>[root@kvm ~]# hostnamectl set-hostname node1
[root@kvm ~]# bash
[root@node1 ~]# vim /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.200.200 node1-manage
192.168.200.201 node2-manage
192.168.0.200 node1-heartbeat
192.168.0.201 node2-heartbeat
192.168.1.200 node1-storage
192.168.1.201 node2-storage

[root@node1 ~]# ping node2-manage 
PING node2-manage (192.168.200.201) 56(84) bytes of data.
64 bytes from node2-manage (192.168.200.201): icmp_seq=1 ttl=64 time=1.26 ms
--- node2-manage ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 1.268/1.268/1.268/0.000 ms

[root@node1 ~]# ping node2-heartbeat 
PING node2-heartbeat (192.168.0.201) 56(84) bytes of data.
64 bytes from node2-heartbeat (192.168.0.201): icmp_seq=1 ttl=64 time=9.27 ms
--- node2-heartbeat ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 9.276/9.276/9.276/0.000 ms

[root@node1 ~]# ping node2-storage 
PING node2-storage (192.168.1.201) 56(84) bytes of data.
64 bytes from node2-storage (192.168.1.201): icmp_seq=1 ttl=64 time=0.700 ms
--- node2-storage ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.700/0.700/0.700/0.000 ms
</code></pre>
<p>node2:</p>
<pre><code>[root@kvm2 ~]# hostnamectl set-hostname node2
[root@kvm2 ~]# bash
[root@node2 ~]# vim /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.200.200 node1-manage
192.168.200.201 node2-manage
192.168.0.200 node1-heartbeat
192.168.0.201 node2-heartbeat
192.168.1.200 node1-storage
192.168.1.201 node2-storage
[root@node2 ~]# ping node1-manage 
PING node1-manage (192.168.200.200) 56(84) bytes of data.
64 bytes from node1-manage (192.168.200.200): icmp_seq=1 ttl=64 time=1.06 ms
--- node1-manage ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 1.063/1.063/1.063/0.000 ms

[root@node2 ~]# ping node1-heartbeat 
PING node1-heartbeat (192.168.0.200) 56(84) bytes of data.
64 bytes from node1-heartbeat (192.168.0.200): icmp_seq=1 ttl=64 time=10.6 ms
--- node1-heartbeat ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 10.616/10.616/10.616/0.000 ms

[root@node2 ~]# ping node1-storage 
PING node1-storage (192.168.1.200) 56(84) bytes of data.
64 bytes from node1-storage (192.168.1.200): icmp_seq=1 ttl=64 time=0.269 ms
--- node1-storage ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.269/0.269/0.269/0.000 ms
</code></pre>
<h2><span id="2-配置ssh-key互信可选">2、配置SSH Key互信（可选）</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/69.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# ssh-keygen -t rsa -P &#39;&#39;
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:OGWrktFMBJXAHiwVbzg5pX9ZTg5Do99QQyCJWxjlUaI root@node1
The key&#39;s randomart image is:
+---[RSA 2048]----+
|   +*XO+=o+      |
|  . *X+* o .     |
|   oE+* * o      |
|    oO = %       |
|    . * S +      |
|     o +         |
|    o .          |
|     .           |
|                 |
+----[SHA256]-----+

[root@node1 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@node2
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed

/usr/bin/ssh-copy-id: ERROR: ssh: Could not resolve hostname node2: Name or service not known

[root@node1 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@node2-manage
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
The authenticity of host &#39;node2-manage (192.168.200.201)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:s2qiffBOYjuMJQOHEI9r87NTNjd0XyoEf81myM78kbQ.
ECDSA key fingerprint is MD5:a5:8f:de:d4:07:9f:b7:b3:6f:7c:b0:c3:55:eb:bb:b0.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@node2-manage&#39;s password: 

Number of key(s) added: 1

Now try logging into the machine, with:   &quot;ssh &#39;root@node2-manage&#39;&quot;
and check to make sure that only the key(s) you wanted were added.
[root@node1 ~]# ssh root@node2-manage
Last login: Thu Apr 13 15:16:28 2023 from 192.168.200.1
[root@node2 ~]# exit 
logout
Connection to node2-manage closed.
</code></pre>
<p>node2:</p>
<pre><code>[root@node2 ~]# ssh-keygen -t rsa -P &#39;&#39;
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:E9njGHnhnwZtQGy5CmomfuxGQENWeVNRWHe9W0q9QRw root@node2
The key&#39;s randomart image is:
+---[RSA 2048]----+
| .o... .oB*.. oE.|
| .o . o .=+= . o.|
| . . . .=.*.o ...|
|  .   .  *.= ..oo|
|   . . .S.. +. .=|
|  . =   .. .  .o |
| . *             |
|  . +            |
|   +.            |
+----[SHA256]-----+
[root@node2 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@node1-manage
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
The authenticity of host &#39;node1-manage (192.168.200.200)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:s2qiffBOYjuMJQOHEI9r87NTNjd0XyoEf81myM78kbQ.
ECDSA key fingerprint is MD5:a5:8f:de:d4:07:9f:b7:b3:6f:7c:b0:c3:55:eb:bb:b0.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@node1-manage&#39;s password: 

Number of key(s) added: 1

Now try logging into the machine, with:   &quot;ssh &#39;root@node1-manage&#39;&quot;
and check to make sure that only the key(s) you wanted were added.

[root@node2 ~]# ssh root@node1-manage
Last login: Thu Apr 13 15:16:27 2023 from 192.168.200.1
[root@node1 ~]# exit 
logout
Connection to node1-manage closed.
</code></pre>
<h2><span id="3-配置时钟">3、配置时钟</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/70.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# ntpdate time.windows.com
13 Apr 16:20:11 ntpdate[6059]: adjust time server 52.231.114.183 offset 0.021235 sec
[root@node1 ~]# crontab -e
no crontab for root - using an empty one
crontab: installing new crontab
[root@node1 ~]# crontab -l
*/30 * * * * /sbin/ntpdate ntp1.aliyun.com &amp;&gt; /dev/null
</code></pre>
<p>node2:</p>
<pre><code>[root@node1 ~]# ntpdate time.windows.com
13 Apr 16:20:11 ntpdate[6059]: adjust time server 52.231.114.183 offset 0.021235 sec
[root@node1 ~]# crontab -e
no crontab for root - using an empty one
crontab: installing new crontab
[root@node1 ~]# crontab -l
*/30 * * * * /sbin/ntpdate ntp1.aliyun.com &amp;&gt; /dev/null
</code></pre>
<h2><span id="4-配置iptables防火墙允许集群组件运行">4、配置iptables防火墙允许集群组件运行</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/71.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# firewall-cmd --permanent --add-service=high-availability
success
[root@node1 ~]# firewall-cmd --add-service=high-availability
success
[root@node1 ~]# firewall-cmd --reload
success

[root@node1 ~]# firewall-cmd --get-service
RH-Satellite-6 RH-Satellite-6-capsule amanda-client amanda-k5-client amqp amqps apcupsd audit bacula bacula-client bgp bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph ceph-mon cfengine condor-collector ctdb dhcp dhcpv6 dhcpv6-client distcc dns docker-registry docker-swarm dropbox-lansync elasticsearch etcd-client etcd-server finger freeipa-ldap freeipa-ldaps freeipa-replication freeipa-trust ftp ganglia-client ganglia-master git gre high-availability http https imap imaps ipp ipp-client ipsec irc ircs iscsi-target isns jenkins kadmin kerberos kibana klogin kpasswd kprop kshell ldap ldaps libvirt libvirt-tls lightning-network llmnr managesieve matrix mdns minidlna mongodb mosh mountd mqtt mqtt-tls ms-wbt mssql murmur mysql nfs nfs3 nmea-0183 nrpe ntp nut openvpn ovirt-imageio ovirt-storageconsole ovirt-vmconsole plex pmcd pmproxy pmwebapi pmwebapis pop3 pop3s postgresql privoxy proxy-dhcp ptp pulseaudio puppetmaster quassel radius redis rpc-bind rsh rsyncd rtsp salt-master samba samba-client samba-dc sane sip sips slp smtp smtp-submission smtps snmp snmptrap spideroak-lansync squid ssh steam-streaming svdrp svn syncthing syncthing-gui synergy syslog syslog-tls telnet tftp tftp-client tinc tor-socks transmission-client upnp-client vdsm vnc-server wbem-http wbem-https wsman wsmans xdmcp xmpp-bosh xmpp-client xmpp-local xmpp-server zabbix-agent zabbix-server
</code></pre>
<p>node2:</p>
<pre><code>[root@node1 ~]# firewall-cmd --permanent --add-service=high-availability
success
[root@node1 ~]# firewall-cmd --add-service=high-availability
success
[root@node1 ~]# firewall-cmd --reload
success
</code></pre>
<h2><span id="5-配置pcs守护程序">5、配置pcs守护程序</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/72.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# systemctl start pcsd
[root@node1 ~]# systemctl enable pcsd
Created symlink from /etc/systemd/system/multi-user.target.wants/pcsd.service to /usr/lib/systemd/system/pcsd.service.
[root@node1 ~]# systemctl status pcsd
● pcsd.service - PCS GUI and remote configuration interface
   Loaded: loaded (/usr/lib/systemd/system/pcsd.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-04-13 16:36:13 CST; 8s ago
     Docs: man:pcsd(8)
           man:pcs(8)
 Main PID: 6161 (pcsd)
   CGroup: /system.slice/pcsd.service
           └─6161 /usr/bin/ruby /usr/lib/pcsd/pcsd

Apr 13 16:36:13 node1 systemd[1]: Starting PCS GUI and remote configuration interface...
Apr 13 16:36:13 node1 systemd[1]: Started PCS GUI and remote configuration interface.
</code></pre>
<p>node2:</p>
<pre><code>[root@node2 ~]# systemctl start pcsd
[root@node2 ~]# systemctl enable pcsd
Created symlink from /etc/systemd/system/multi-user.target.wants/pcsd.service to /usr/lib/systemd/system/pcsd.service.
[root@node2 ~]# systemctl status pcsd
● pcsd.service - PCS GUI and remote configuration interface
   Loaded: loaded (/usr/lib/systemd/system/pcsd.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-04-13 16:35:20 CST; 19s ago
     Docs: man:pcsd(8)
           man:pcs(8)
 Main PID: 6483 (pcsd)
   CGroup: /system.slice/pcsd.service
           └─6483 /usr/bin/ruby /usr/lib/pcsd/pcsd

Apr 13 16:35:20 node2 systemd[1]: Starting PCS GUI and remote configuration interface...
Apr 13 16:35:20 node2 systemd[1]: Started PCS GUI and remote configuration interface.
</code></pre>
<p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/73.jpg"></p>
<h2><span id="6-配置hacluster账户密码">6、配置hacluster账户密码</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/74.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# echo &quot;password&quot; | passwd --stdin hacluster 
Changing password for user hacluster.
passwd: all authentication tokens updated successfully.
</code></pre>
<p>node2:</p>
<pre><code>[root@node2 ~]# echo &quot;password&quot; | passwd --stdin hacluster 
Changing password for user hacluster.
passwd: all authentication tokens updated successfully.
</code></pre>
<h2><span id="7-编辑配置文件">7、编辑配置文件</span></h2><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/75.jpg"></p>
<h1><span id="4-群集的创建">4、群集的创建</span></h1><p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/76.jpg"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/77.jpg"></p>
<p>node1:</p>
<pre><code>[root@node1 ~]# pcs cluster auth node1-heartbeat node2-heartbeat
Username: hacluster
Password: password
node1-heartbeat: Authorized
node2-heartbeat: Authorized
[root@node1 corosync]# pcs cluster setup --name cluster1 node1-heartbeat node2-heartbeat
[root@node1 corosync]# pwd
/etc/corosync
[root@node1 corosync]# ls -lh
total 16K
-rw-r--r--. 1 root root  397 Apr 13 16:56 corosync.conf
-rw-r--r--. 1 root root 2.9K Nov 25  2021 corosync.conf.example
-rw-r--r--. 1 root root  767 Nov 25  2021 corosync.conf.example.udpu
-rw-r--r--. 1 root root 3.3K Nov 25  2021 corosync.xml.example
drwxr-xr-x. 2 root root    6 Nov 25  2021 uidgid.d
[root@node1 corosync]# pcs cluster status 
Error: cluster is not currently running on this node
[root@node1 corosync]# cat corosync.conf
totem &#123;
    version: 2 #集群版本
    cluster_name: cluster1 #集群名称
    secauth: off #安全身份验证协议
    transport: udpu #节点之间的传输协议
&#125;

nodelist &#123; #节点的列表，可以使用Ip或者定义的主机名称
    node &#123;
        ring0_addr: node1-heartbeat #心跳网络
        nodeid: 1
    &#125;

    node &#123;
        ring0_addr: node1-heartbeat #心跳网络
        nodeid: 2
    &#125;
&#125;

quorum &#123; 
    provider: corosync_votequorum 
    two_node: 1  #告诉集群当前是双节点的，只剩一个节点时不要将集群停止
&#125;

logging &#123; #日志相关
    to_logfile: yes
    logfile: /var/log/cluster/corosync.log
    to_syslog: yes
&#125;
[root@node1 corosync]# pcs cluster start --help  #查看启动帮助

Usage: pcs cluster start...
    start [--all | &lt;node&gt;... ] [--wait[=&lt;n&gt;]] [--request-timeout=&lt;seconds&gt;]
        Start a cluster on specified node(s). If no nodes are specified then
        start a cluster on the local node. If --all is specified then start
        a cluster on all nodes. If the cluster has many nodes then the start
        request may time out. In that case you should consider setting
        --request-timeout to a suitable value. If --wait is specified, pcs
        waits up to &#39;n&#39; seconds for the cluster to get ready to provide
        services after the cluster has successfully started.
[root@node1 corosync]# pcs cluster start  --all  #启动所有节点，不使用--all的时候默认启动当前节点，此时可以在其他主机的syslog中查看相关日志信息
node1-heartbeat: Starting Cluster (corosync)...
node2-heartbeat: Starting Cluster (corosync)...
node1-heartbeat: Starting Cluster (pacemaker)...
node2-heartbeat: Starting Cluster (pacemaker)...
[root@node1 corosync]# pcs status #查看pcs状态
Cluster name: cluster1 #集群的名称

WARNINGS:
No stonith devices and stonith-enabled is not false #目前是正常现象，还没有配置stonith

Stack: corosync #使用corosync作为心跳
Current DC: node1-heartbeat (version 1.1.23-1.el7_9.1-9acf116022) - partition WITHOUT quorum
Last updated: Fri Apr 14 09:25:54 2023 #获取信息时间
Last change: Fri Apr 14 09:24:26 2023 by hacluster via crmd on node1-heartbeat #获取信息时间

2 nodes configured #双节点的集群
0 resource instances configured  #目前没有配置资源

Online: [ node1-heartbeat node2-heartbeat ] #当前集群运行的主机

No resources


Daemon Status: #响应的守护程序
  corosync: active/disabled
  pacemaker: active/disabled
  pcsd: active/enabled

[root@node1 corosync]# pcs cluster status #查看集群当前状态
Cluster Status:
 Stack: corosync
 Current DC: node1-heartbeat (version 1.1.23-1.el7_9.1-9acf116022) - partition WITHOUT quorum #当前的DC
 Last updated: Fri Apr 14 09:25:00 2023
 Last change: Fri Apr 14 09:24:26 2023 by hacluster via crmd on node1-heartbeat
 2 nodes configured
 0 resource instances configured

PCSD Status: #当前集群两个节点的状态都是在线的
  node1-heartbeat: Online
  node2-heartbeat: Online
  
[root@node1 corosync]# systemctl status pacemaker.service -l #查看响应的服务状态
● pacemaker.service - Pacemaker High Availability Cluster Manager
   Loaded: loaded (/usr/lib/systemd/system/pacemaker.service; disabled; vendor preset: disabled)
   Active: active (running) since Fri 2023-04-14 09:32:57 CST; 4min 10s ago
     Docs: man:pacemakerd
           https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html-single/Pacemaker_Explained/index.html
 Main PID: 12054 (pacemakerd)
    Tasks: 7
   CGroup: /system.slice/pacemaker.service
           ├─12054 /usr/sbin/pacemakerd -f
           ├─12055 /usr/libexec/pacemaker/cib
           ├─12056 /usr/libexec/pacemaker/stonithd
           ├─12057 /usr/libexec/pacemaker/lrmd
           ├─12058 /usr/libexec/pacemaker/attrd
           ├─12059 /usr/libexec/pacemaker/pengine
           └─12060 /usr/libexec/pacemaker/crmd

Apr 14 09:32:58 node1 crmd[12060]:   notice: Quorum acquired
Apr 14 09:32:58 node1 crmd[12060]:   notice: Node node1-heartbeat state is now member
Apr 14 09:32:58 node1 crmd[12060]:   notice: Node node2-heartbeat state is now member
Apr 14 09:32:58 node1 crmd[12060]:   notice: The local CRM is operational
Apr 14 09:32:58 node1 crmd[12060]:   notice: State transition S_STARTING -&gt; S_PENDING
Apr 14 09:33:00 node1 crmd[12060]:   notice: Fencer successfully connected
Apr 14 09:33:19 node1 crmd[12060]:  warning: Input I_DC_TIMEOUT received in state S_PENDING from crm_timer_popped
Apr 14 09:33:19 node1 crmd[12060]:   notice: State transition S_ELECTION -&gt; S_PENDING
Apr 14 09:33:19 node1 crmd[12060]:   notice: State transition S_PENDING -&gt; S_NOT_DC
Apr 14 09:33:19 node1 attrd[12058]:   notice: Updating all attributes after cib_refresh_notify event

[root@node1 corosync]# systemctl status corosync -l 
● corosync.service - Corosync Cluster Engine
   Loaded: loaded (/usr/lib/systemd/system/corosync.service; disabled; vendor preset: disabled)
   Active: active (running) since Fri 2023-04-14 09:32:57 CST; 4min 39s ago
     Docs: man:corosync
           man:corosync.conf
           man:corosync_overview
  Process: 12025 ExecStart=/usr/share/corosync/corosync start (code=exited, status=0/SUCCESS)
 Main PID: 12034 (corosync)
    Tasks: 2
   CGroup: /system.slice/corosync.service
           └─12034 corosync

Apr 14 09:32:56 node1 corosync[12034]:  [QUORUM] Members[1]: 1
Apr 14 09:32:56 node1 corosync[12034]:  [MAIN  ] Completed service synchronization, ready to provide service.
Apr 14 09:32:56 node1 corosync[12034]:  [TOTEM ] A new membership (192.168.0.200:14) was formed. Members joined: 2
Apr 14 09:32:56 node1 corosync[12034]:  [CPG   ] downlist left_list: 0 received
Apr 14 09:32:56 node1 corosync[12034]:  [CPG   ] downlist left_list: 0 received
Apr 14 09:32:56 node1 corosync[12034]:  [QUORUM] This node is within the primary component and will provide service.
Apr 14 09:32:56 node1 corosync[12034]:  [QUORUM] Members[2]: 1 2
Apr 14 09:32:56 node1 corosync[12034]:  [MAIN  ] Completed service synchronization, ready to provide service.
Apr 14 09:32:57 node1 corosync[12025]: Starting Corosync Cluster Engine (corosync): [  确定  ]
Apr 14 09:32:57 node1 systemd[1]: Started Corosync Cluster Engine.

[root@node1 corosync]# systemctl status pcsd -l
● pcsd.service - PCS GUI and remote configuration interface
   Loaded: loaded (/usr/lib/systemd/system/pcsd.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-04-13 16:56:20 CST; 16h ago
     Docs: man:pcsd(8)
           man:pcs(8)
 Main PID: 6555 (pcsd)
    Tasks: 6
   CGroup: /system.slice/pcsd.service
           └─6555 /usr/bin/ruby /usr/lib/pcsd/pcsd

Apr 13 16:56:19 node1 systemd[1]: Stopped PCS GUI and remote configuration interface.
Apr 13 16:56:19 node1 systemd[1]: Starting PCS GUI and remote configuration interface...
Apr 13 16:56:20 node1 systemd[1]: Started PCS GUI and remote configuration interface.

[root@node1 corosync]# netstat -ntlp | grep 2224 #集群安装并启动后会运行一个GUI的服务，默认端口使用的是2224，使用https的方式来进行访问，用户名密码使用上述创建的，hacluster/password
tcp6       0      0 :::2224                 :::*                    LISTEN      6555/ruby
</code></pre>
<p><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/78.jpg"><br><img src="/images/KVM/Linux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/79.png"></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
        </article>

        
            
  <div class="nexmoe-post-copyright">
    <strong>Author：</strong>张博丞<br>
    
      <strong>From：</strong><a href="/%E5%8E%9F%E5%88%9B" title="原创" target="_blank" rel="noopener">原创</a><br>
    
    <strong>Link：</strong><a href="https://zhangboc.github.io/2023/04/12/KVM/4.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8BLinux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" title="https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;12&#x2F;KVM&#x2F;4.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8BLinux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;12&#x2F;KVM&#x2F;4.KVM%E8%99%9A%E6%8B%9F%E5%8C%96%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%8F%90%E9%AB%98%E8%A7%86%E9%A2%91%E8%AF%BE%E7%A8%8B%E4%B9%8BLinux%E7%BE%A4%E9%9B%86%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE&#x2F;</a><br>

    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


        

        <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/KVM/">KVM</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/KVM/" rel="tag">KVM</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Linux-HA/" rel="tag">Linux HA</a>
    
</div>

    <div class="nexmoe-post-footer">
        <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://lib.baomitu.com/valine/1.3.9/Valine.min.js'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'r5zxC0st0DDjPA9auXzMV7HY-gzGzoHsz',
        appKey: '3bqCsovpyfTPHUzTHovd3V3V'
    })
</script>
</section>
    </div>
</div>
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
            <div class="nexmoe-pd-item">
                <div class="qweather" >
    <div id="he-plugin-standard"></div>
    <div class="qweather-logo">

    </div>

</div>
<style>
    .qweather{
        position: relative;
    }
    .qweather-logo{
        position: absolute;
        right: 0;
        top: -15px;
        width: 40px;
        height: 40px;
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
</style>
<script>
  WIDGET = {
    "CONFIG": {
      "layout": "2",
      "width": "260",
      "height": "220",
      "background": "5",
      "dataColor": "e67249",
      "borderRadius": "15",
      "key": "f74d1e1690e6432d801e97fa2f05a162"
    }
  }
</script>
<script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://lib.baomitu.com/lazysizes/5.1.0/lazysizes.min.js"></script>
<script src="https://lib.baomitu.com/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://lib.baomitu.com/mdui/0.4.3/js/mdui.min.js"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://lib.baomitu.com/jquery/3.5.1/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1681647440580"></script>

<script src="https://lib.baomitu.com/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://lib.baomitu.com/clipboard.js/2.0.8/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --><script src="/live2D/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2D/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"model":{"jsonPath":"/live2D/assets/xiaomai.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/5e784416.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "5e784416"
  });
  daovoice('update');
</script>

