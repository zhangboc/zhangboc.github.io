<!DOCTYPE html>

<html lang="en">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>RBD高级功能 - Hexo</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />

  <link rel="shortcut icon" href="/images/head/head.jpg" type="image/png" />
  <meta property="og:type" content="article">
<meta property="og:title" content="RBD高级功能">
<meta property="og:url" content="https://zhangboc.github.io/2023/04/19/Ceph/10.RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/1.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/2.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/3.jpg">
<meta property="article:published_time" content="2023-04-18T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-19T07:43:53.273Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Ceph">
<meta property="article:tag" content="RBD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangboc.github.io/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/1.jpg">
  <link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/9.15.8/styles/atom-one-dark.min.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://lib.baomitu.com/justifiedGallery/3.8.1/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1682237265541">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiaomai.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/lihui.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="John Doe" class="mdui-btn mdui-btn-icon"><img src="/images/head/head.jpg" alt="John Doe"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="John Doe">
            <img src="/images/head/head.jpg" alt="John Doe" alt="John Doe">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>26 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>20<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>7<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/index.html" title="关于我">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend/index.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/download/index.html" title="下载中心">
            <i class="mdui-list-item-icon nexmoefont icon-tangguo"></i>
            <div class="mdui-list-item-content">
                下载中心
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=1605643129&Site=%E5%8C%97%E4%BA%ACSEO&Menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(64, 196, 255);background-color: rgba(64, 196, 255, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="mailto:1605643129@qq.com" target="_blank" mdui-tooltip="{content: 'mail'}" style="color: rgb(249,8,8);background-color: rgba(249,8,8,.1);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a><a class="mdui-ripple" href="https://blog.csdn.net/qq_40855827?type=blog" target="_blank" mdui-tooltip="{content: 'CSDN'}" style="color: rgb(199,29,35);background-color: rgba(199,29,35,.1);">
            <i class="nexmoefont icon-csdn"></i>
        </a><a class="mdui-ripple" href="https://home.cnblogs.com/u/1882665" target="_blank" mdui-tooltip="{content: '博客园'}" style="color: rgb(66, 214, 29);background-color: rgba(66, 214, 29, .1);">
            <i class="nexmoefont icon-bokeyuan"></i>
        </a><a class="mdui-ripple" href="https://github.com/zhangboc" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://gitee.com/with-the-wind-yue" target="_blank" mdui-tooltip="{content: 'gitee'}" style="color: rgb(255, 255, 255);background-color: rgb(199,29,35);">
            <i class="nexmoefont icon-mayun"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/">Ceph</a>
          <span class="category-list-count">19</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/KVM/">KVM</a>
          <span class="category-list-count">7</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/Kubernetes/">Kubernetes</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/OpenStack/">OpenStack</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/SDK/">SDK</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/hexo/">hexo</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Ceph/" style="font-size: 20px;">Ceph</a> <a href="/tags/CephFS/" style="font-size: 10px;">CephFS</a> <a href="/tags/Ceph%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/" style="font-size: 10px;">Ceph守护进程</a> <a href="/tags/Ceph%E7%AE%80%E4%BB%8B/" style="font-size: 10px;">Ceph简介</a> <a href="/tags/Cinder/" style="font-size: 10px;">Cinder</a> <a href="/tags/CrushMap/" style="font-size: 10px;">CrushMap</a> <a href="/tags/KVM/" style="font-size: 17.5px;">KVM</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB/" style="font-size: 10px;">KVM虚拟机迁移</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">KVM虚拟网络高级配置</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Linux-HA/" style="font-size: 15px;">Linux HA</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/OSD/" style="font-size: 10px;">OSD</a> <a href="/tags/OpenStack/" style="font-size: 12.5px;">OpenStack</a> <a href="/tags/RBD/" style="font-size: 12.5px;">RBD</a> <a href="/tags/RGW/" style="font-size: 12.5px;">RGW</a> <a href="/tags/chatjs/" style="font-size: 10px;">chatjs</a> <a href="/tags/%E5%9F%BA%E4%BA%8EiSCSI%E7%9A%84KVM%E7%BE%A4%E9%9B%86%E6%9E%84%E5%BB%BA/" style="font-size: 10px;">基于iSCSI的KVM群集构建</a> <a href="/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" style="font-size: 10px;">故障排查</a> <a href="/tags/%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">集群测试</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">26</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 John Doe
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/zhangboc/hexo.github.io/" target="_blank">ZhangboCheng</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">辽ICP备2021002341号</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
        <script>
            var now = new Date(); 
            function createtime() { 
                var grt= new Date("08/10/2018 17:38:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
                now.setTime(now.getTime()+250); 
                days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>


        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    
        <div class="nexmoe-post-cover" style="padding-bottom: 26.666666666666668%;">
            <img data-src="https://img1.baidu.com/it/u=413643897,2296924942&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" data-sizes="auto" alt="RBD高级功能" class="lazyload">
            <h1>RBD高级功能</h1>
        </div>
    

        <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年04月19日</a>
    <a><i class="nexmoefont icon-areachart"></i>4.6k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 25 分钟</a>
</div>

        <div class="nexmoe-post-right">
            
        </div>

        <article>
            <h1><span id></span></h1><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#%E4%B8%80-rbd%E5%9B%9E%E6%94%B6%E7%AB%99%E6%9C%BA%E5%88%B6">一、RBD回收站机制</a><ul>
<li><a href="#1-%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%9B%9E%E6%94%B6%E7%AB%99">1 移动到回收站</a></li>
<li><a href="#2-%E6%89%BE%E5%9B%9E%E5%88%A0%E9%99%A4%E7%9A%84%E9%95%9C%E5%83%8F">2 找回删除的镜像</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-rbd%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%BF%AB%E7%85%A7">二、RBD镜像制作快照</a></li>
<li><a href="#%E4%B8%89-rbd%E5%BF%AB%E7%85%A7%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D">三、RBD快照数据恢复</a><ul>
<li><a href="#1-%E5%BF%AB%E7%85%A7%E6%81%A2%E5%A4%8D">1、快照恢复</a></li>
<li><a href="#2-%E5%88%A0%E9%99%A4%E5%BF%AB%E7%85%A7">2、删除快照</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-rbd%E9%95%9C%E5%83%8F%E5%85%8B%E9%9A%86%E6%9C%BA%E5%88%B6">四、RBD镜像克隆机制</a></li>
<li><a href="#%E4%BA%94-rbd%E8%A7%A3%E9%99%A4%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB">五、RBD解除依赖关系</a><ul>
<li><a href="#1-%E5%AE%9E%E6%93%8D">1、实操</a></li>
<li><a href="#2-%E6%BC%94%E7%A4%BA%E6%8D%9F%E5%9D%8F%E8%BF%87%E7%A8%8B">2、演示损坏过程</a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-rbd%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">六、RBD备份与恢复</a><ul>
<li><a href="#1-%E5%A4%87%E4%BB%BD">1、备份</a></li>
<li><a href="#2-%E6%81%A2%E5%A4%8D">2、恢复</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83-rbd%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">七、RBD增量备份与恢复</a><ul>
<li><a href="#1-%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD">1、增量备份</a></li>
<li><a href="#2-%E5%A2%9E%E9%87%8F%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D">2、增量数据恢复</a></li>
</ul>
</li>
<li><a href="#%E5%85%AB-rbd%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%80%BB%E7%BB%93">八、RBD导入导出总结</a></li>
<li><a href="#%E4%B9%9D-rbd%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E4%B8%8E%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E5%AE%9E%E6%93%8D">九、RBD备份恢复与增量备份恢复实操</a><ul>
<li><a href="#1-%E5%88%9B%E5%BB%BApool">1、创建pool</a></li>
<li><a href="#2-%E5%88%9B%E5%BB%BA%E5%9D%97%E8%AE%BE%E5%A4%871">2、创建块设备1</a></li>
<li><a href="#3-%E6%98%A0%E5%B0%84%E5%9D%97%E8%AE%BE%E5%A4%87%E5%88%B0%E6%9C%AC%E5%9C%B0">3、映射块设备到本地</a></li>
<li><a href="#4-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%9D%97%E8%AE%BE%E5%A4%871">4、格式化块设备1</a></li>
<li><a href="#5-%E6%8C%82%E8%BD%BD%E5%9D%97%E8%AE%BE%E5%A4%871">5、挂载块设备1</a></li>
<li><a href="#6-%E5%86%99%E5%85%A5file1%E5%88%B0%E5%9D%97%E8%AE%BE%E5%A4%871">6、写入file1到块设备1</a></li>
<li><a href="#7-%E5%BF%AB%E7%85%A7%E5%9D%97%E8%AE%BE%E5%A4%871">7、快照块设备1</a></li>
<li><a href="#8-%E6%81%A2%E5%A4%8D%E5%9D%97%E8%AE%BE%E5%A4%871%E4%B8%BA%E5%9D%97%E8%AE%BE%E5%A4%872">8、恢复块设备1为块设备2</a></li>
<li><a href="#9-%E6%98%A0%E5%B0%84%E5%9D%97%E8%AE%BE%E5%A4%872">9、映射块设备2</a></li>
<li><a href="#10-%E6%8C%82%E8%BD%BD%E5%9D%97%E8%AE%BE%E5%A4%872">10、挂载块设备2</a></li>
<li><a href="#11-%E6%9F%A5%E7%9C%8B%E5%9D%97%E8%AE%BE%E5%A4%872%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E6%9C%89file1">11、查看块设备2的数据是否有file1</a></li>
<li><a href="#12-%E5%86%99%E5%85%A5file2%E5%88%B0%E5%9D%97%E8%AE%BE%E5%A4%871">12、写入file2到块设备1</a></li>
<li><a href="#13-%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E5%9D%97%E8%AE%BE%E5%A4%871">13、增量备份块设备1</a></li>
<li><a href="#14-%E5%A2%9E%E9%87%8F%E6%81%A2%E5%A4%8D%E5%9D%97%E8%AE%BE%E5%A4%872">14、增量恢复块设备2</a></li>
<li><a href="#15-%E6%9F%A5%E7%9C%8B%E5%9D%97%E8%AE%BE%E5%A4%872%E6%98%AF%E5%90%A6%E6%9C%89file2%E6%96%87%E4%BB%B6">15 、查看块设备2是否有file2文件</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->

<h1><span id="一-rbd回收站机制">一、RBD回收站机制</span></h1><h2><span id="1-移动到回收站">1 移动到回收站</span></h2><pre><code>[root@node-1 my-cluster]# rbd -p ceph-demo ls #查看pool
crush-demo.img
crush-map.img
rbd-demo.img
[root@node-1 my-cluster]# rbd create ceph-demo/ceph-trash.img --size 1G #在ceph-demo中创建ceph-trash.img
[root@node-1 my-cluster]# rbd info ceph-demo/ceph-trash.img #查看RBD块设备信息
rbd image &#39;ceph-trash.img&#39;:
    size 1 GiB in 256 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 659d3aed954
    block_name_prefix: rbd_data.659d3aed954
    format: 2
    features: layering, exclusive-lock, object-map, fast-diff, deep-flatten
    op_features: 
    flags: 
    create_timestamp: Wed Mar  8 18:15:57 2023
    access_timestamp: Wed Mar  8 18:15:57 2023
    modify_timestamp: Wed Mar  8 18:15:57 2023
[root@node-1 my-cluster]# rbd rm ceph-demo/ceph-trash.img #删除块设备
Removing image: 100% complete...done.
[root@node-1 my-cluster]# rbd -p ceph-demo ls #查看已经被删除
crush-demo.img
crush-map.img
rbd-demo.img
[root@node-1 my-cluster]# rbd -p ceph-demo trash ls  #回收站中也被删除了
[root@node-1 my-cluster]# rbd create ceph-demo/ceph-trash.img --size 1G #再次创建一个块设备
[root@node-1 my-cluster]# rbd help trash move  
 #查看使用帮助
usage: rbd trash move [--pool &lt;pool&gt;] [--namespace &lt;namespace&gt;] 
                      [--image &lt;image&gt;] [--expires-at &lt;expires-at&gt;] 
                      &lt;image-spec&gt; 

Move an image to the trash.

Positional arguments
  &lt;image-spec&gt;            image specification
                          (example: [&lt;pool-name&gt;/[&lt;namespace&gt;/]]&lt;image-name&gt;)

Optional arguments
  -p [ --pool ] arg       pool name
  --namespace arg         namespace name
  --image arg             image name
  --expires-at arg (=now) set the expiration time of an image so it can be
                          purged when it is stale
[root@node-1 my-cluster]# rbd trash move ceph-demo/ceph-trash.img --expires-at 20230310 #将ceph-demo pool下的ceph-trash.img 移动到回收站，设置过期日期为2023年03月10日
[root@node-1 my-cluster]# rbd -p ceph-demo ls #查看ceph-demo的pool中已经没有 ceph-trash.img
crush-demo.img
crush-map.img
rbd-demo.img

[root@node-1 my-cluster]# rbd -p ceph-demo trash ls #查看回收站
66393ad8bed4 ceph-trash.img
</code></pre>
<h2><span id="2-找回删除的镜像">2 找回删除的镜像</span></h2><pre><code>[root@node-1 my-cluster]# rbd help trash restore #查看使用帮助
usage: rbd trash restore [--pool &lt;pool&gt;] [--namespace &lt;namespace&gt;] 
                         [--image-id &lt;image-id&gt;] [--image &lt;image&gt;] 
                         &lt;image-id&gt; 

Restore an image from trash.

Positional arguments
  &lt;image-id&gt;           image id
                       (example: [&lt;pool-name&gt;/]&lt;image-id&gt;)

Optional arguments
  -p [ --pool ] arg    pool name
  --namespace arg      namespace name
  --image-id arg       image id
  --image arg          image name
[root@node-1 my-cluster]# rbd trash restore -p ceph-demo 66393ad8bed4 #将66393ad8bed4镜像恢复到ceph-demo的pool中，也可以指定到其他pool
[root@node-1 my-cluster]# rbd -p ceph-demo ls  #查看已经恢复
ceph-trash.img #这个
crush-demo.img
crush-map.img 
rbd-demo.img
</code></pre>
<h1><span id="二-rbd镜像制作快照">二、RBD镜像制作快照</span></h1><p><img src="/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/1.jpg"></p>
<pre><code>[root@node-1 my-cluster]# rbd create ceph-demo/rbd-test.img --image-feature layering --size 1G #创建一个1G可挂载的rbd块设备
[root@node-1 my-cluster]# rbd info ceph-demo/rbd-test.img 
#查看块设备信息
rbd image &#39;rbd-test.img&#39;:
    size 1 GiB in 256 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 6678a4fda5fe
    block_name_prefix: rbd_data.6678a4fda5fe
    format: 2
    features: layering #可挂载
    op_features: 
    flags: 
    create_timestamp: Thu Mar  9 09:35:08 2023
    access_timestamp: Thu Mar  9 09:35:08 2023
    modify_timestamp: Thu Mar  9 09:35:08 2023
[root@node-1 my-cluster]# rbd device map ceph-demo/rbd-test.img  #将rbd-test映射到本地硬盘
/dev/rbd1
[root@node-1 my-cluster]# mkfs.xfs /dev/rbd1 #初始化硬盘
Discarding blocks...Done.
meta-data=/dev/rbd1              isize=512    agcount=8, agsize=32768 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=262144, imaxpct=25
         =                       sunit=1024   swidth=1024 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=8 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node-1 my-cluster]# mkdir /data-snap #创建一个目录
[root@node-1 my-cluster]# mount /dev/rbd1 /data-snap #将rbd1挂载到/data-snap
[root@node-1 my-cluster]# df -HT  #查看挂载成功
Filesystem              Type      Size  Used Avail Use% Mounted on
devtmpfs                devtmpfs  942M     0  942M   0% /dev
tmpfs                   tmpfs     954M     0  954M   0% /dev/shm
tmpfs                   tmpfs     954M   36M  919M   4% /run
tmpfs                   tmpfs     954M     0  954M   0% /sys/fs/cgroup
/dev/mapper/centos-root xfs        19G  2.3G   17G  13% /
/dev/sda1               xfs       1.1G  204M  860M  20% /boot
tmpfs                   tmpfs     191M     0  191M   0% /run/user/0
tmpfs                   tmpfs     954M   54k  954M   1% /var/lib/ceph/osd/ceph-0
tmpfs                   tmpfs     954M   54k  954M   1% /var/lib/ceph/osd/ceph-1
/dev/rbd0               xfs       1.1G   34M  1.1G   4% /data
/dev/rbd1               xfs       1.1G   34M  1.1G   4% /data-snap
[root@node-1 data-snap]# cd /data-snap/ 进入到挂载目录
[root@node-1 data-snap]# sync 刷新一下盘
[root@node-1 data-snap]# echo &gt;&gt; 123 snap.txt #写入数据
[root@node-1 data-snap]# rbd snap create ceph-demo/rbd-test.img@rbd-test.img_20230309 #将ceph-demo池子下的rbd-test.img块设备做快照，定义快照名称为：rbd-test.img_20230309

[root@node-1 data-snap]# rbd snap ls ceph-demo/rbd-test.img #查看快照
SNAPID NAME                  SIZE  PROTECTED TIMESTAMP                
     4 rbd-test.img_20230309 1 GiB           Thu Mar  9 09:44:15 2023 
</code></pre>
<h1><span id="三-rbd快照数据恢复">三、RBD快照数据恢复</span></h1><h2><span id="1-快照恢复">1、快照恢复</span></h2><pre><code>[root@node-1 data-snap]# ls #查看块设备文件
123

[root@node-1 data-snap]# rm -rf 123 #删除123文件 
[root@node-1 ~]# umount /dev/rbd1 #取消挂载

[root@node-1 data-snap]# rbd snap rollback ceph-demo/rbd-test.img@rbd-test.img_20230309 #恢复快照
Rolling back to snapshot: 100% complete...done.
[root@node-1 /]# mount /dev/rbd0 /data
[root@node-1 data]# ls #文件恢复
snap.txt
</code></pre>
<h2><span id="2-删除快照">2、删除快照</span></h2><pre><code>[root@node-1 data]# rbd snap rm ceph-demo/rbd-test.img@rbd-test.img-snap-20230309 #删除快照
[root@node-1 data]# rbd snap remove ceph-demo/rbd-test.img@rbd-test.img-snap-20230309 #删除快照
[root@node-1 data]# rbd snap purge ceph-demo/rbd-test.img #删除当前所有快照
</code></pre>
<h1><span id="四-rbd镜像克隆机制">四、RBD镜像克隆机制</span></h1><p><img src="/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/2.jpg"></p>
<p>分层（copy-on-write）</p>
<pre><code>[root@node-1 data]# ceph osd pool ls #查看当前pool
.rgw.root
default.rgw.control
default.rgw.meta
default.rgw.log
rbd-snap-demo
[root@node-1 data]# rbd -p rbd-snap-demo ls #查看rbd-snap-demo下的块设备
snap.img
[root@node-1 data]# rbd snap create rbd-snap-demo/snap.img@template #创建一个template的快照
[root@node-1 data]# rbd snap ls rbd-snap-demo/snap.img #查看快照创建成功
SNAPID NAME              SIZE   PROTECTED TIMESTAMP                
     4 snap.img-20230309 10 GiB           Thu Mar  9 11:11:07 2023 
     5 template          10 GiB           Thu Mar  9 11:28:50 2023                                
[root@node-1 data]# rbd snap protect rbd-snap-demo/snap.img@template #保护快照
[root@node-1 data]# rbd snap rm rbd-snap-demo/snap.img@template #测试无法删除
Removing snap: 0% complete...failed.
rbd: snapshot &#39;template&#39; is protected from removal.
2023-03-09 11:49:40.689 7f92a1e8dc80 -1 librbd::Operations: snapshot is protected
[root@node-1 data]# rbd clone rbd-snap-demo/snap.img@template rbd-snap-demo/vm1-clone.img #克隆一个vm1-clone.img的块设备，可以跨Pool

[root@node-1 data]# rbd clone rbd-snap-demo/snap.img@template rbd-snap-demo/vm2-clone.img
[root@node-1 data]# rbd clone rbd-snap-demo/snap.img@template rbd-snap-demo/vm3-clone.img
[root@node-1 data]# rbd -p rbd-snap-demo ls #查看克隆的镜像
snap.img
vm1-clone.img
vm2-clone.img
vm3-clone.img
[root@node-1 data]# rbd -p rbd-snap-demo info vm1-clone.img  #查看克隆的镜像
rbd image &#39;vm1-clone.img&#39;:
    size 10 GiB in 2560 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 69a2a3b7c9ab
    block_name_prefix: rbd_data.69a2a3b7c9ab
    format: 2
    features: layering
    op_features: 
    flags: 
    create_timestamp: Thu Mar  9 11:51:30 2023
    access_timestamp: Thu Mar  9 11:51:30 2023
    modify_timestamp: Thu Mar  9 11:51:30 2023
    parent: rbd-snap-demo/snap.img@template #父镜像
    overlap: 10 GiB

</code></pre>
<h1><span id="五-rbd解除依赖关系">五、RBD解除依赖关系</span></h1><p>克隆的图像保留对父快照的引用。当您删除从子克隆到父快照的引用时，您通过将信息从快照复制到克隆来有效地“扁平化”图像。扁平化克隆所需的时间随着快照的大小而增加。要删除快照，您必须先展平子图像。</p>
<pre><code>rbd flatten &#123;pool-name&#125;/&#123;image-name&#125;
</code></pre>
<p>例如：</p>
<pre><code>rbd flatten rbd/new-image
</code></pre>
<blockquote>
<p>由于扁平化镜像包含快照的所有信息，扁平化镜像比分层克隆占用更多存储空间。</p>
</blockquote>
<h2><span id="1-实操">1、实操</span></h2><pre><code>[root@node-1 ~]# rbd info rbd-snap-demo/vm1-clone.img #查看克隆出来的镜像
rbd image &#39;vm1-clone.img&#39;:
    size 10 GiB in 2560 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 69a2a3b7c9ab
    block_name_prefix: rbd_data.69a2a3b7c9ab
    format: 2
    features: layering
    op_features: 
    flags: 
    create_timestamp: Thu Mar  9 11:51:30 2023
    access_timestamp: Thu Mar  9 11:51:30 2023
    modify_timestamp: Thu Mar  9 11:51:30 2023
    parent: rbd-snap-demo/snap.img@template #可以看到父级
    overlap: 10 GiB
[root@node-1 ~]# rbd children rbd-snap-demo/snap.img@template #查看这个快照克隆出来多少镜像
rbd-snap-demo/vm1-clone.img
rbd-snap-demo/vm2-clone.img
rbd-snap-demo/vm3-clone.img
[root@node-1 ~]# rbd flatten rbd-snap-demo/vm1-clone.img #取消依赖关系
Image flatten: 100% complete...done.

[root@node-1 ~]# rbd info rbd-snap-demo/vm1-clone.img #再次查看，已经取消了依赖关系
rbd image &#39;vm1-clone.img&#39;:
    size 10 GiB in 2560 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 69a2a3b7c9ab
    block_name_prefix: rbd_data.69a2a3b7c9ab
    format: 2
    features: layering
    op_features: 
    flags: 
    create_timestamp: Thu Mar  9 11:51:30 2023
    access_timestamp: Thu Mar  9 11:51:30 2023
    modify_timestamp: Thu Mar  9 11:51:30 2023
[root@node-1 ~]# rbd children rbd-snap-demo/snap.img@template #可以看到vm1的已经取消了
rbd-snap-demo/vm2-clone.img
rbd-snap-demo/vm3-clone.img
</code></pre>
<h2><span id="2-演示损坏过程">2、演示损坏过程</span></h2><pre><code>[root@node-1 ~]# rbd children rbd-snap-demo/snap.img@template #查看需要损坏的镜像
rbd-snap-demo/vm2-clone.img
rbd-snap-demo/vm3-clone.img
[root@node-1 ~]#  rbd flatten rbd-snap-demo/vm2-clone.img #取消依赖关系
Image flatten: 100% complete...done.
[root@node-1 ~]#  rbd flatten rbd-snap-demo/vm3-clone.img #取消依赖关系
Image flatten: 100% complete...done.
[root@node-1 ~]# rbd snap unprotect rbd-snap-demo/snap.img@template #取消标志位，达到破坏镜像的目的
[root@node-1 ~]# rbd snap rm rbd-snap-demo/snap.img@template #删除快照
Removing snap: 100% complete...done.

[root@node-1 ~]# rbd device ls  #可以看到依旧时可以使用的，已经没有任何关系了。
id pool          namespace image         snap device    
0  rbd-snap-demo           snap.img      -    /dev/rbd0 
1  rbd-snap-demo           vm3-clone.img -    /dev/rbd1
</code></pre>
<h1><span id="六-rbd备份与恢复">六、RBD备份与恢复</span></h1><h2><span id="1-备份">1、备份</span></h2><pre><code>[root@node-1 ~]# rbd help export 
usage: rbd export [--pool &lt;pool&gt;] [--namespace &lt;namespace&gt;] [--image &lt;image&gt;] 
                  [--snap &lt;snap&gt;] [--path &lt;path&gt;] [--no-progress] 
                  [--export-format &lt;export-format&gt;] 
                  &lt;source-image-or-snap-spec&gt; &lt;path-name&gt; 

Export image to file.

Positional arguments
  &lt;source-image-or-snap-spec&gt;  source image or snapshot specification
                               (example:
                               [&lt;pool-name&gt;/[&lt;namespace&gt;/]]&lt;image-name&gt;[@&lt;snap-n
                               ame&gt;])
  &lt;path-name&gt;                  export file (or &#39;-&#39; for stdout)

Optional arguments
  -p [ --pool ] arg            source pool name
  --namespace arg              source namespace name
  --image arg                  source image name
  --snap arg                   source snapshot name
  --path arg                   export file (or &#39;-&#39; for stdout)
  --no-progress                disable progress output
  --export-format arg          format of image file
  
[root@node-1 ~]# ceph osd lspools #查看当前pool
4 .rgw.root
5 default.rgw.control
6 default.rgw.meta
7 default.rgw.log
8 rbd-snap-demo
[root@node-1 ~]# rbd -p rbd-snap-demo ls #查看rbd-snap-demo的块
snap.img
vm1-clone.img
vm2-clone.img
vm3-clone.img
[root@node-1 ~]# rbd snap create rbd-snap-demo/snap.img@snap-demo #创建快照
[root@node-1 ~]# rbd snap ls rbd-snap-demo/snap.img
 #查看快照
SNAPID NAME              SIZE   PROTECTED TIMESTAMP                
     4 snap.img-20230309 10 GiB           Thu Mar  9 11:11:07 2023 
     7 snap-demo         10 GiB           Thu Mar  9 15:08:50 2023
[root@node-1 ~]# rbd export rbd-snap-demo/snap.img@snap-demo /root/rbd-test.img #导出镜像
Exporting image: 100% complete...done.

</code></pre>
<h2><span id="2-恢复">2、恢复</span></h2><pre><code>[root@node-1 ~]# rbd help import 
usage: rbd import [--path &lt;path&gt;] [--dest-pool &lt;dest-pool&gt;] 
                  [--dest-namespace &lt;dest-namespace&gt;] [--dest &lt;dest&gt;] 
                  [--image-format &lt;image-format&gt;] [--new-format] 
                  [--order &lt;order&gt;] [--object-size &lt;object-size&gt;] 
                  [--image-feature &lt;image-feature&gt;] [--image-shared] 
                  [--stripe-unit &lt;stripe-unit&gt;] 
                  [--stripe-count &lt;stripe-count&gt;] [--data-pool &lt;data-pool&gt;] 
                  [--journal-splay-width &lt;journal-splay-width&gt;] 
                  [--journal-object-size &lt;journal-object-size&gt;] 
                  [--journal-pool &lt;journal-pool&gt;] 
                  [--sparse-size &lt;sparse-size&gt;] [--no-progress] 
                  [--export-format &lt;export-format&gt;] [--pool &lt;pool&gt;] 
                  [--image &lt;image&gt;] 
                  &lt;path-name&gt; &lt;dest-image-spec&gt; 

Import image from file.

Positional arguments
  &lt;path-name&gt;               import file (or &#39;-&#39; for stdin)
  &lt;dest-image-spec&gt;         destination image specification
                            (example: [&lt;pool-name&gt;/[&lt;namespace&gt;/]]&lt;image-name&gt;)

Optional arguments
  --path arg                import file (or &#39;-&#39; for stdin)
  --dest-pool arg           destination pool name
  --dest-namespace arg      destination namespace name
  --dest arg                destination image name
  --image-format arg        image format [1 (deprecated) or 2]
  --new-format              use image format 2
                            (deprecated)
  --order arg               object order [12 &lt;= order &lt;= 25]
  --object-size arg         object size in B/K/M [4K &lt;= object size &lt;= 32M]
  --image-feature arg       image features
                            [layering(+), exclusive-lock(+*), object-map(+*),
                            deep-flatten(+-), journaling(*)]
  --image-shared            shared image
  --stripe-unit arg         stripe unit in B/K/M
  --stripe-count arg        stripe count
  --data-pool arg           data pool
  --journal-splay-width arg number of active journal objects
  --journal-object-size arg size of journal objects [4K &lt;= size &lt;= 64M]
  --journal-pool arg        pool for journal objects
  --sparse-size arg         sparse size in B/K/M [default: 4K]
  --no-progress             disable progress output
  --export-format arg       format of image file
  -p [ --pool ] arg         pool name (deprecated)
  --image arg               image name (deprecated)

Image Features:
  (*) supports enabling/disabling on existing images
  (-) supports disabling-only on existing images
  (+) enabled by default for new images if features not specified
  
[root@node-1 ~]# rbd import rbd-test.img rbd-snap-demo/snap-new.img #导入rbd-test.img的备份，恢复并重命名为snap-new.img，恢复到rbd-snap-demo的pool中
Importing image: 100% complete...done.
[root@node-1 ~]# rbd -p rbd-snap-demo ls  #查看已经成功导入
snap-new.img
snap.img
vm1-clone.img
vm2-clone.img
vm3-clone.img
</code></pre>
<h1><span id="七-rbd增量备份与恢复">七、RBD增量备份与恢复</span></h1><h2><span id="1-增量备份">1、增量备份</span></h2><pre><code>usage: rbd export-diff [--pool &lt;pool&gt;] [--namespace &lt;namespace&gt;] 
                       [--image &lt;image&gt;] [--snap &lt;snap&gt;] [--path &lt;path&gt;] 
                       [--from-snap &lt;from-snap&gt;] [--whole-object] 
                       [--no-progress] 
                       &lt;source-image-or-snap-spec&gt; &lt;path-name&gt; 

Export incremental diff to file.

Positional arguments
  &lt;source-image-or-snap-spec&gt;  source image or snapshot specification
                               (example:
                               [&lt;pool-name&gt;/[&lt;namespace&gt;/]]&lt;image-name&gt;[@&lt;snap-n
                               ame&gt;])
  &lt;path-name&gt;                  export file (or &#39;-&#39; for stdout)

Optional arguments
  -p [ --pool ] arg            source pool name
  --namespace arg              source namespace name
  --image arg                  source image name
  --snap arg                   source snapshot name
  --path arg                   export file (or &#39;-&#39; for stdout)
  --from-snap arg              snapshot starting point
  --whole-object               compare whole object
  --no-progress                disable progress output

[root@node-1 ~]# rbd device ls #查看映射的块设备
id pool          namespace image         snap device
0  rbd-snap-demo           snap.img      -    /dev/rbd0
1  rbd-snap-demo           vm3-clone.img -    /dev/rbd1
[root@node-1 ~]# df -HT  #rbd0映射到了/data
Filesystem              Type      Size  Used Avail Use% Mounted on
devtmpfs                devtmpfs  942M     0  942M   0% /dev
tmpfs                   tmpfs     954M     0  954M   0% /dev/shm
tmpfs                   tmpfs     954M   44M  911M   5% /run
tmpfs                   tmpfs     954M     0  954M   0% /sys/fs/cgroup
/dev/mapper/centos-root xfs        19G  2.4G   16G  13% /
/dev/sda1               xfs       1.1G  204M  860M  20% /boot
tmpfs                   tmpfs     954M   54k  954M   1% /var/lib/ceph/osd/ceph-0
tmpfs                   tmpfs     954M   54k  954M   1% /var/lib/ceph/osd/ceph-1
/dev/rbd0               xfs        11G   35M   11G   1% /data
tmpfs                   tmpfs     191M     0  191M   0% /run/user/0
[root@node-1 ~]# cd /data
[root@node-1 data]# ls
snap.txt

[root@node-1 data]# echo &quot;增量备份测试&quot; &gt; test.txt
[root@node-1 data]# rbd snap create rbd-snap-demo/snap.img@v1 #再次创建快照
[root@node-1 data]# rbd snap ls rbd-snap-demo/snap.img #查看快照
SNAPID NAME              SIZE   PROTECTED TIMESTAMP                
     4 snap.img-20230309 10 GiB           Thu Mar  9 11:11:07 2023 
     7 snap-demo         10 GiB           Thu Mar  9 15:08:50 2023 
     8 v1                10 GiB           Thu Mar  9 15:42:52 2023
[root@node-1 data]# rbd export-diff rbd-snap-demo/snap.img@v1 rbd-test.img@v1
 #增量导出
Exporting image: 100% complete...done.
[root@node-1 ~]# ls -lha #查看大小相差很多

-rw-r--r--   1 root root   10G Mar  9 15:12 rbd-test.img
-rw-r--r--   1 root root  4.4M Mar  9 15:46 rbd-test.img@v1

</code></pre>
<h2><span id="2-增量数据恢复">2、增量数据恢复</span></h2><pre><code>[root@node-1 ~]# rbd help import-diff
usage: rbd import-diff [--path &lt;path&gt;] [--pool &lt;pool&gt;] 
                       [--namespace &lt;namespace&gt;] [--image &lt;image&gt;] 
                       [--sparse-size &lt;sparse-size&gt;] [--no-progress] 
                       &lt;path-name&gt; &lt;image-spec&gt; 

Import an incremental diff.

Positional arguments
  &lt;path-name&gt;          import file (or &#39;-&#39; for stdin)
  &lt;image-spec&gt;         image specification
                       (example: [&lt;pool-name&gt;/[&lt;namespace&gt;/]]&lt;image-name&gt;)

Optional arguments
  --path arg           import file (or &#39;-&#39; for stdin)
  -p [ --pool ] arg    pool name
  --namespace arg      namespace name
  --image arg          image name
  --sparse-size arg    sparse size in B/K/M [default: 4K]
  --no-progress        disable progress outpu
</code></pre>
<blockquote>
<p>如果有多个增量备份，一定要按照顺序去导入，比如v1 v2 v3 v4 这样的顺序去恢复</p>
</blockquote>
<pre><code>[root@node-1 ~]# rbd -p rbd-snap-demo ls  #确认导入的pool
snap-new.img
snap.img
vm1-clone.img
vm2-clone.img
vm3-clone.img
[root@node-1 ~]# rbd import-diff rbd-test.img@v1 rbd-snap-demo/snap-new.img #将rbd-test.img@v1的增量备份恢复到rbd-snap-demo池下的snap-new.img块设备
Importing image diff: 100% complete...done.
[root@node-1 ~]# rbd snap ls rbd-snap-demo/snap-new.img  #查看导入成功
SNAPID NAME SIZE   PROTECTED TIMESTAMP                
     9 v1   10 GiB           Thu Mar  9 15:52:14 2023
</code></pre>
<h1><span id="八-rbd导入导出总结">八、RBD导入导出总结</span></h1><p><img src="/images/Ceph/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/3.jpg"></p>
<h1><span id="九-rbd备份恢复与增量备份恢复实操">九、RBD备份恢复与增量备份恢复实操</span></h1><blockquote>
<p>xfs重新挂载时有可能会出现UUID重复的情况，导致无法挂载，可以使用mount -o nouuid &#x2F;dev&#x2F;rbd1 &#x2F;data-diff&#x2F; 解决</p>
</blockquote>
<h2><span id="1-创建pool">1、创建pool</span></h2><pre><code>[root@node-1 /]# ceph osd pool create ceph-demo 16 16 
pool &#39;ceph-demo&#39; created
</code></pre>
<h2><span id="2-创建块设备1">2、创建块设备1</span></h2><pre><code>rbd create ceph-demo/rbd.img --image-feature layering --size 1G
</code></pre>
<h2><span id="3-映射块设备到本地">3、映射块设备到本地</span></h2><pre><code>[root@node-1 /]# rbd device map ceph-demo/rbd.img
/dev/rbd0
</code></pre>
<h2><span id="4-格式化块设备1">4、格式化块设备1</span></h2><pre><code>[root@node-1 /]# mkfs.xfs /dev/rbd0 
Discarding blocks...Done.
meta-data=/dev/rbd0              isize=512    agcount=8, agsize=32768 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=262144, imaxpct=25
         =                       sunit=1024   swidth=1024 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=8 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
</code></pre>
<h2><span id="5-挂载块设备1">5、挂载块设备1</span></h2><pre><code>[root@node-1 /]# mount /dev/rbd0 /data
[root@node-1 /]# mount -o nouuid /dev/rbd1 /data-diff/
</code></pre>
<h2><span id="6-写入file1到块设备1">6、写入file1到块设备1</span></h2><pre><code>[root@node-1 /]# cd /data
[root@node-1 data]# ls
[root@node-1 data]# echo &quot;数据&quot; &gt; file1.txt
[root@node-1 data]# cat file1.txt 
数据
</code></pre>
<h2><span id="7-快照块设备1">7、快照块设备1</span></h2><pre><code>[root@node-1 /]# rbd snap create ceph-demo/rbd.img@rbd-bakup.img
[root@node-1 /]# rbd snap ls ceph-demo/rbd.img
SNAPID NAME          SIZE  PROTECTED TIMESTAMP                
     4 rbd-bakup.img 1 GiB           Thu Mar  9 17:09:06 2023
</code></pre>
<h2><span id="8-恢复块设备1为块设备2">8、恢复块设备1为块设备2</span></h2><pre><code>[root@node-1 ~]# rbd export ceph-demo/rbd.img@rbd-bakup.img rbd-bakup.img
Exporting image: 100% complete...done.
[root@node-1 ~]# rbd import rbd-bakup.img ceph-demo/rbd-bakup.img
Importing image: 100% complete...done.
</code></pre>
<h2><span id="9-映射块设备2">9、映射块设备2</span></h2><pre><code>[root@node-1 ~]# rbd device map ceph-demo/rbd-bakup.img
/dev/rbd1
</code></pre>
<h2><span id="10-挂载块设备2">10、挂载块设备2</span></h2><pre><code>[root@node-1 ~]# mount /dev/rbd1 /data-diff/
</code></pre>
<h2><span id="11-查看块设备2的数据是否有file1">11、查看块设备2的数据是否有file1</span></h2><pre><code>[root@node-1 ~]# cd /data-diff/
[root@node-1 data-diff]# ls
file1.txt  lost+found
</code></pre>
<h2><span id="12-写入file2到块设备1">12、写入file2到块设备1</span></h2><pre><code>[root@node-1 data]# echo &quot;增量数据&quot; &gt; file2.txt
[root@node-1 data]# cat file2.txt 
增量数据
</code></pre>
<h2><span id="13-增量备份块设备1">13、增量备份块设备1</span></h2><pre><code>[root@node-1 /]# rbd snap create ceph-demo/rbd.img@rbd-bakup-diff.img
[root@node-1 /]# rbd export-diff ceph-demo/rbd.img@rbd-bakup-diff.img rbd-bakup-diff.img
Exporting image: 100% complete...done.
</code></pre>
<h2><span id="14-增量恢复块设备2">14、增量恢复块设备2</span></h2><pre><code>[root@node-1 /]# rbd import-diff rbd-bakup-diff.img ceph-demo/rbd-bakup.img
Importing image diff: 100% complete...done.
</code></pre>
<h2><span id="15-查看块设备2是否有file2文件">15 、查看块设备2是否有file2文件</span></h2><pre><code>[root@node-1 /]# mount /dev/rbd1 /data-diff/
[root@node-1 /]# ls
bin  boot  data  data-diff  dev  etc  home  lib  lib64  media  mnt  opt  proc  rbd-bakup-diff.img  root  run  sbin  srv  sys  tmp  usr  var
[root@node-1 /]# cd /data-diff/
[root@node-1 data-diff]# ls
file1.txt  file2.txt  lost+found
[root@node-1 data-diff]# cat file2.txt
增量数据
</code></pre>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
        </article>

        
            
  <div class="nexmoe-post-copyright">
    <strong>Author：</strong>张博丞<br>
    
      <strong>From：</strong><a href="/%E5%8E%9F%E5%88%9B" title="原创" target="_blank" rel="noopener">原创</a><br>
    
    <strong>Link：</strong><a href="https://zhangboc.github.io/2023/04/19/Ceph/10.RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD/" title="https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;19&#x2F;Ceph&#x2F;10.RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD&#x2F;RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;19&#x2F;Ceph&#x2F;10.RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD&#x2F;RBD%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD&#x2F;</a><br>

    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


        

        <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Ceph/">Ceph</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Ceph/" rel="tag">Ceph</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/RBD/" rel="tag">RBD</a>
    
</div>

    <div class="nexmoe-post-footer">
        <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://lib.baomitu.com/valine/1.3.9/Valine.min.js'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'r5zxC0st0DDjPA9auXzMV7HY-gzGzoHsz',
        appKey: '3bqCsovpyfTPHUzTHovd3V3V'
    })
</script>
</section>
    </div>
</div>
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
            <div class="nexmoe-pd-item">
                <div class="qweather" >
    <div id="he-plugin-standard"></div>
    <div class="qweather-logo">

    </div>

</div>
<style>
    .qweather{
        position: relative;
    }
    .qweather-logo{
        position: absolute;
        right: 0;
        top: -15px;
        width: 40px;
        height: 40px;
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
</style>
<script>
  WIDGET = {
    "CONFIG": {
      "layout": "2",
      "width": "260",
      "height": "220",
      "background": "5",
      "dataColor": "e67249",
      "borderRadius": "15",
      "key": "f74d1e1690e6432d801e97fa2f05a162"
    }
  }
</script>
<script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://lib.baomitu.com/lazysizes/5.1.0/lazysizes.min.js"></script>
<script src="https://lib.baomitu.com/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://lib.baomitu.com/mdui/0.4.3/js/mdui.min.js"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://lib.baomitu.com/jquery/3.5.1/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1682237265546"></script>

<script src="https://lib.baomitu.com/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://lib.baomitu.com/clipboard.js/2.0.8/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --><script src="/live2D/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2D/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"model":{"jsonPath":"/live2D/assets/xiaomai.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/5e784416.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "5e784416"
  });
  daovoice('update');
</script>

