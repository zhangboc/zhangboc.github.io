<!DOCTYPE html>

<html lang="en">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>Ceph-SDK开发与排障 - Hexo</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />

  <link rel="shortcut icon" href="/images/head/head.jpg" type="image/png" />
  <meta property="og:type" content="article">
<meta property="og:title" content="Ceph-SDK开发与排障">
<meta property="og:url" content="https://zhangboc.github.io/2023/04/23/Ceph/17.SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/1.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/2.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/3.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/4.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/5.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/6.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/7.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/8.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/9.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/10.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/11.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/12.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/13.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/14.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/15.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/16.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/17.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/18.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/19.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/20.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/21.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/22.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/23.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/24.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/25.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/26.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/27.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/28.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/29.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/30.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/31.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/32.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/33.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/34.jpg">
<meta property="og:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/35.jpg">
<meta property="article:published_time" content="2023-04-22T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-23T08:05:41.940Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Ceph">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangboc.github.io/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/1.jpg">
  <link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/9.15.8/styles/atom-one-dark.min.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://lib.baomitu.com/justifiedGallery/3.8.1/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1682237265501">
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiaomai.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/lihui.png)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="John Doe" class="mdui-btn mdui-btn-icon"><img src="/images/head/head.jpg" alt="John Doe"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="John Doe">
            <img src="/images/head/head.jpg" alt="John Doe" alt="John Doe">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>26 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>20<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>7<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/index.html" title="关于我">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend/index.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/download/index.html" title="下载中心">
            <i class="mdui-list-item-icon nexmoefont icon-tangguo"></i>
            <div class="mdui-list-item-content">
                下载中心
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=1605643129&Site=%E5%8C%97%E4%BA%ACSEO&Menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(64, 196, 255);background-color: rgba(64, 196, 255, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="mailto:1605643129@qq.com" target="_blank" mdui-tooltip="{content: 'mail'}" style="color: rgb(249,8,8);background-color: rgba(249,8,8,.1);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a><a class="mdui-ripple" href="https://blog.csdn.net/qq_40855827?type=blog" target="_blank" mdui-tooltip="{content: 'CSDN'}" style="color: rgb(199,29,35);background-color: rgba(199,29,35,.1);">
            <i class="nexmoefont icon-csdn"></i>
        </a><a class="mdui-ripple" href="https://home.cnblogs.com/u/1882665" target="_blank" mdui-tooltip="{content: '博客园'}" style="color: rgb(66, 214, 29);background-color: rgba(66, 214, 29, .1);">
            <i class="nexmoefont icon-bokeyuan"></i>
        </a><a class="mdui-ripple" href="https://github.com/zhangboc" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://gitee.com/with-the-wind-yue" target="_blank" mdui-tooltip="{content: 'gitee'}" style="color: rgb(255, 255, 255);background-color: rgb(199,29,35);">
            <i class="nexmoefont icon-mayun"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/">Ceph</a>
          <span class="category-list-count">19</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/KVM/">KVM</a>
          <span class="category-list-count">7</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/Kubernetes/">Kubernetes</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/OpenStack/">OpenStack</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ceph/SDK/">SDK</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/hexo/">hexo</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Ceph/" style="font-size: 20px;">Ceph</a> <a href="/tags/CephFS/" style="font-size: 10px;">CephFS</a> <a href="/tags/Ceph%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/" style="font-size: 10px;">Ceph守护进程</a> <a href="/tags/Ceph%E7%AE%80%E4%BB%8B/" style="font-size: 10px;">Ceph简介</a> <a href="/tags/Cinder/" style="font-size: 10px;">Cinder</a> <a href="/tags/CrushMap/" style="font-size: 10px;">CrushMap</a> <a href="/tags/KVM/" style="font-size: 17.5px;">KVM</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB/" style="font-size: 10px;">KVM虚拟机迁移</a> <a href="/tags/KVM%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">KVM虚拟网络高级配置</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Linux-HA/" style="font-size: 15px;">Linux HA</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/OSD/" style="font-size: 10px;">OSD</a> <a href="/tags/OpenStack/" style="font-size: 12.5px;">OpenStack</a> <a href="/tags/RBD/" style="font-size: 12.5px;">RBD</a> <a href="/tags/RGW/" style="font-size: 12.5px;">RGW</a> <a href="/tags/chatjs/" style="font-size: 10px;">chatjs</a> <a href="/tags/%E5%9F%BA%E4%BA%8EiSCSI%E7%9A%84KVM%E7%BE%A4%E9%9B%86%E6%9E%84%E5%BB%BA/" style="font-size: 10px;">基于iSCSI的KVM群集构建</a> <a href="/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" style="font-size: 10px;">故障排查</a> <a href="/tags/%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">集群测试</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">26</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 John Doe
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/zhangboc/hexo.github.io/" target="_blank">ZhangboCheng</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">辽ICP备2021002341号</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
        <script>
            var now = new Date(); 
            function createtime() { 
                var grt= new Date("08/10/2018 17:38:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
                now.setTime(now.getTime()+250); 
                days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>


        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    
        <div class="nexmoe-post-cover" style="padding-bottom: 26.666666666666668%;">
            <img data-src="https://img1.baidu.com/it/u=413643897,2296924942&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500" data-sizes="auto" alt="Ceph-SDK开发与排障" class="lazyload">
            <h1>Ceph-SDK开发与排障</h1>
        </div>
    

        <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年04月23日</a>
    <a><i class="nexmoefont icon-areachart"></i>10.2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 52 分钟</a>
</div>

        <div class="nexmoe-post-right">
            
        </div>

        <article>
            <h1><span id></span></h1><span id="more"></span>

<!-- toc -->

<ul>
<li><a href="#%E4%B8%80-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3">一、官方文档</a><ul>
<li><a href="#1-ceph-rest-%E9%A3%8E%E6%A0%BC%E7%9A%84-api">1、CEPH REST 风格的 API:</a></li>
<li><a href="#ceph-%E5%AD%98%E5%82%A8%E9%9B%86%E7%BE%A4-api">CEPH 存储集群 API :</a></li>
<li><a href="#ceph-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-api">CEPH 文件系统 API:</a></li>
<li><a href="#ceph-%E5%9D%97%E8%AE%BE%E5%A4%87-api">CEPH 块设备 API :</a></li>
<li><a href="#eph-rados-%E7%BD%91%E5%85%B3-api">EPH RADOS 网关 API:</a></li>
<li><a href="#ceph-%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8-api">CEPH 对象存储 API:</a><ul>
<li><a href="#1-%E5%8F%82%E8%A7%81s3-%E5%85%BC%E5%AE%B9-apihttpsdocscephcomenpacificradosgws3">1、参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/radosgw/s3/">S3 兼容 API</a></a></li>
<li><a href="#2-%E5%8F%82%E8%A7%81%E4%B8%8E-swift-%E5%85%BC%E5%AE%B9%E7%9A%84-apihttpsdocscephcomenpacificradosgwswift">2、参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/radosgw/swift/">与 Swift 兼容的 API</a>。</a></li>
<li><a href="#3-%E5%8F%82%E8%A7%81%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C-apihttpsdocscephcomenpacificradosgwadminops">3、参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/radosgw/adminops">管理操作 API</a></a></li>
</ul>
</li>
<li><a href="#ceph-mon-%E5%91%BD%E4%BB%A4-api">CEPH MON 命令 API</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-ceph-storage-cluster-api">二、Ceph Storage Cluster API</a><ul>
<li><a href="#%E7%AC%AC-1-%E6%AD%A5%E8%8E%B7%E5%8F%96-librados">第 1 步：获取 LIBRADOS</a><ul>
<li><a href="#1-%E4%B8%BA-cc-%E8%8E%B7%E5%8F%96-librados">1、为 C&#x2F;C++ 获取 LIBRADOS</a></li>
<li><a href="#2-%E4%B8%BA-python-%E8%8E%B7%E5%8F%96-librados">2、为 PYTHON 获取 LIBRADOS</a></li>
<li><a href="#3-%E4%B8%BA-java-%E8%8E%B7%E5%8F%96-librados">3、为 JAVA 获取 LIBRADOS</a></li>
<li><a href="#4-%E4%B8%BA-php-%E8%8E%B7%E5%8F%96-librados">4、为 PHP 获取 LIBRADOS</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC-2-%E6%AD%A5%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4%E5%8F%A5%E6%9F%84">第 2 步：配置集群句柄</a><ul>
<li><a href="#1-c-%E7%A4%BA%E4%BE%8B">1、C 示例</a></li>
<li><a href="#2-c-%E7%A4%BA%E4%BE%8B">2、C++ 示例</a></li>
<li><a href="#3-python-%E7%A4%BA%E4%BE%8B">3、PYTHON 示例</a></li>
<li><a href="#4-java-%E7%A4%BA%E4%BE%8B">4、JAVA 示例</a></li>
<li><a href="#5-php-%E7%A4%BA%E4%BE%8B">5、PHP 示例</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC-3-%E6%AD%A5%E5%88%9B%E5%BB%BA-io-%E4%B8%8A%E4%B8%8B%E6%96%87">第 3 步：创建 I&#x2F;O 上下文</a><ul>
<li><a href="#1-c-%E7%A4%BA%E4%BE%8B-1">1、C 示例</a></li>
<li><a href="#2-c-%E7%A4%BA%E4%BE%8B-1">2、C++ 示例</a></li>
<li><a href="#3-python-%E7%A4%BA%E4%BE%8B-1">3、PYTHON 示例</a></li>
<li><a href="#4-java-%E7%A4%BA%E4%BE%8B-1">4、JAVA 示例</a></li>
<li><a href="#5-php-%E7%A4%BA%E4%BE%8B-1">5、PHP 示例</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC-4-%E6%AD%A5%E7%BB%93%E6%9D%9F%E9%93%BE%E6%8E%A5">第 4 步：结束链接</a><ul>
<li><a href="#1-c-%E7%A4%BA%E4%BE%8B-2">1、C 示例</a></li>
<li><a href="#2-c-%E7%A4%BA%E4%BE%8B-2">2、C++ 示例</a></li>
<li><a href="#3-java-%E7%A4%BA%E4%BE%8B">3、JAVA 示例</a></li>
<li><a href="#4-python-%E7%A4%BA%E4%BE%8B">4、PYTHON 示例</a></li>
<li><a href="#4-php-%E7%A4%BA%E4%BE%8B">4、PHP 示例</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC5%E6%AD%A5python%E6%B5%8B%E8%AF%95">第5步：Python测试</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-ceph-%E5%9D%97%E8%AE%BE%E5%A4%87-api">三、CEPH 块设备 API</a><ul>
<li><a href="#rados%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AFapi">RADOS的客户端API</a></li>
<li><a href="#1-librbd-librados%E4%BB%8B%E7%BB%8D">1. librbd  &amp;  librados介绍</a></li>
<li><a href="#11-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0">1.1 架构概述</a></li>
<li><a href="#12-%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84">1.2 源码结构</a><ul>
<li><a href="#121-librbd">1.2.1 librbd</a></li>
<li><a href="#122-librados">1.2.2 librados</a></li>
</ul>
</li>
<li><a href="#2-librados-librbd-api%E4%BB%8B%E7%BB%8D">2、librados &amp; librbd API介绍</a><ul>
<li><a href="#21-%E6%BA%90%E7%A0%81%E6%A6%82%E8%A7%88">2.1 源码概览</a></li>
<li><a href="#22-%E4%B8%BB%E8%A6%81%E6%93%8D%E4%BD%9C%E4%BB%8B%E7%BB%8D">2.2 主要操作介绍</a></li>
<li><a href="#23-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">2.3 参考资料</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E8%B7%B5">实践</a></li>
<li><a href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3">官方文档：</a><ul>
<li><a href="#%E7%A4%BA%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%92%8C%E5%86%99%E5%85%A5%E5%9B%BE%E5%83%8F">示例：创建和写入图像</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ragw-api">RAGW API</a><ul>
<li><a href="#%E4%B8%80-s3-compatible-api">一、S3-compatible API</a><ul>
<li><a href="#1-api">1、API</a></li>
<li><a href="#2-%E5%8A%9F%E8%83%BD%E6%94%AF%E6%8C%81">2、功能支持</a></li>
<li><a href="#3-%E4%B8%8D%E6%94%AF%E6%8C%81%E7%9A%84%E6%A0%87%E9%A2%98%E5%AD%97%E6%AE%B5">3、不支持的标题字段</a></li>
<li><a href="#4-%E6%B5%8B%E8%AF%95">4、测试：</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-swift-compatible-api">二、Swift-compatible API</a><ul>
<li><a href="#1-api-1">1、API</a></li>
<li><a href="#2-%E5%8A%9F%E8%83%BD%E6%94%AF%E6%8C%81-1">2、功能支持</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5">三、创建连接</a><ul>
<li><a href="#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8">1、创建一个容器</a></li>
<li><a href="#2-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1">2、创建一个对象</a></li>
<li><a href="#3-%E5%88%97%E5%87%BA%E6%8B%A5%E6%9C%89%E7%9A%84%E5%AE%B9%E5%99%A8">3、列出拥有的容器</a></li>
<li><a href="#4-%E5%88%97%E5%87%BA%E4%B8%80%E4%B8%AA%E5%AE%B9%E5%99%A8%E7%9A%84%E5%86%85%E5%AE%B9">4、列出一个容器的内容</a></li>
<li><a href="#5-%E6%A3%80%E7%B4%A2%E5%AF%B9%E8%B1%A1">5、检索对象</a></li>
<li><a href="#6-%E5%88%A0%E9%99%A4%E5%AF%B9%E8%B1%A1">6、删除对象</a></li>
<li><a href="#7-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8">7、删除容器</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ceph-mon%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3%E6%8E%92%E9%9A%9C">Ceph MON空间不足排障</a><ul>
<li><a href="#1-%E6%9F%A5%E7%9C%8B%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF">1、查看告警信息</a></li>
<li><a href="#2-%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E4%BF%A1%E6%81%AF">2、查看具体信息</a></li>
<li><a href="#3-%E6%9F%A5%E7%9C%8B%E7%A1%AC%E7%9B%98%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4">3、查看硬盘占用空间</a></li>
<li><a href="#4-%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE30%E5%91%8A%E8%AD%A6">4、参数设置30%告警</a></li>
<li><a href="#5-%E6%89%A9%E5%AE%B9">5、扩容</a></li>
<li><a href="#6-%E6%9F%A5%E7%9C%8Bnode-1%E5%91%8A%E8%AD%A6%E6%B6%88%E5%A4%B1">6、查看Node-1告警消失</a></li>
</ul>
</li>
<li><a href="#ceph%E9%9B%86%E7%BE%A4%E9%98%BB%E5%A1%9E%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5">Ceph集群阻塞故障排查</a><ul>
<li><a href="#%E4%B8%80-%E6%95%85%E9%9A%9C%E7%8E%B0%E8%B1%A1">一、故障现象</a></li>
<li><a href="#%E4%BA%8C-%E6%9F%A5%E7%9C%8Bnode-1mon%E6%97%A5%E5%BF%97">二、查看Node-1Mon日志</a></li>
<li><a href="#%E4%B8%89-%E6%9F%A5%E7%9C%8Bnode-2mon%E6%97%A5%E5%BF%97">三、查看Node-2Mon日志</a></li>
<li><a href="#%E5%9B%9B-%E6%9F%A5%E7%9C%8Bnode-2%E7%9A%84%E7%A1%AC%E7%9B%98%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5">四、查看Node-2的硬盘使用情况</a></li>
<li><a href="#%E4%BA%94-%E6%9F%A5%E7%9C%8Bnode-2%E7%9A%84mon%E6%9C%8D%E5%8A%A1">五、查看Node-2的Mon服务</a></li>
<li><a href="#%E5%85%AD-%E8%BF%87%E6%BB%A4%E5%A4%A7%E4%BA%8E50m%E7%9A%84%E6%96%87%E4%BB%B6">六、过滤大于50M的文件</a></li>
<li><a href="#%E4%B8%83-%E5%BE%97%E5%88%B0%E6%96%87%E4%BB%B6%E5%9F%BA%E6%9C%AC%E9%83%BD%E6%98%AF%E8%A2%ABceph%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE%E5%8D%A0%E7%94%A8%E4%BA%86%E8%BF%99%E4%B8%AA%E4%B8%8D%E8%83%BD%E5%88%A0%E9%99%A4">七、得到文件基本都是被Ceph的元数据占用了，这个不能删除</a></li>
<li><a href="#%E5%85%AB-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95">八、解决方法</a></li>
</ul>
</li>
<li><a href="#%E6%9C%8D%E5%8A%A1carsh%E5%BD%92%E6%A1%A3%E6%8E%92%E6%9F%A5">服务carsh归档排查</a><ul>
<li><a href="#%E4%B8%80-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81">一、查看集群状态</a></li>
<li><a href="#%E4%BA%8C-%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF">二、查看详细信息</a></li>
<li><a href="#%E4%B8%89-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97">三、查看日志</a></li>
<li><a href="#%E5%9B%9B-%E6%8F%90%E7%A4%BA80%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%8D%A0%E7%94%A8">四、提示80端口被占用</a></li>
<li><a href="#%E4%BA%94-%E6%9F%A5%E7%9C%8B%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF">五、查看告警信息</a></li>
<li><a href="#%E5%85%AD-%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF">六、查看详细信息</a></li>
<li><a href="#%E4%B8%83-%E5%BD%92%E6%A1%A3%E4%B8%80%E4%B8%AA%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF">七、归档一个告警信息</a></li>
<li><a href="#%E5%85%AB-%E5%BD%92%E6%A1%A3%E6%89%80%E6%9C%89%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF">八、归档所有告警信息</a></li>
</ul>
</li>
<li><a href="#%E6%97%B6%E9%92%9F%E5%81%8F%E7%A7%BB%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5">时钟偏移故障排查</a></li>
</ul>
<!-- tocstop -->

<h1><span id="一-官方文档">一、官方文档</span></h1><h2><span id="1-ceph-rest-风格的-api">1、CEPH REST 风格的 API:</span></h2><p>请参阅<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/mgr/ceph_api/">Ceph REST API</a></p>
<h2><span id="ceph-存储集群-api">CEPH 存储集群 API :</span></h2><p>请参阅<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/rados/api/">Ceph 存储集群 API</a></p>
<h2><span id="ceph-文件系统-api">CEPH 文件系统 API:</span></h2><p>参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/cephfs/api">libcephfs</a></p>
<h2><span id="ceph-块设备-api">CEPH 块设备 API :</span></h2><p>参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/rbd/api/librbdpy">librbdpy</a></p>
<h2><span id="eph-rados-网关-api">EPH RADOS 网关 API:</span></h2><p>参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/radosgw/api">librgw-py</a></p>
<h2><span id="ceph-对象存储-api">CEPH 对象存储 API:</span></h2><h3><span id="1-参见s3-兼容-api">1、参见</span></h3><h3><span id="2-参见与-swift-兼容的-api">2、参见。</span></h3><h3><span id="3-参见管理操作-api">3、参见</span></h3><h2><span id="ceph-mon-命令-api">CEPH MON 命令 API</span></h2><p>参见<a target="_blank" rel="noopener" href="https://docs.ceph.com/en/pacific/api/mon_command_api">Mon 命令 API</a></p>
<h1><span id="二-ceph-storage-cluster-api">二、Ceph Storage Cluster API</span></h1><p>Ceph存储集群有一个消息层协议，使客户端能够与Ceph Monitor和Ceph OSD Daemon交互。 以库的形式向Ceph Clientlibrados提供此功能。所有 Ceph 客户端都使用或封装了相同的功能来与对象存储交互。例如， 利用此功能。您可以 直接与 Ceph 交互（例如，与 Ceph 对话的应用程序、您自己的 Ceph 接口等）。</p>
<p>Ceph 存储集群提供基本的存储服务，使 Ceph能够在一个统一的系统中以独特的方式提供对象、块和文件存储。但是，您不限于使用 RESTful、块或 POSIX 接口。该 API基于RADOS，librados使您能够创建自己的 Ceph 存储集群接口。<br>APIlibrados使您能够与 Ceph 存储集群中的两种类型的守护进程进行交互：</p>
<p>Ceph Monitor，维护集群映射的主副本。<br>Ceph OSD 守护进程</p>
<p>( OSD)，它将数据作为对象存储在存储节点上。</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/1.jpg"></p>
<p>本指南对使用librados. 有关 Ceph 存储集群的更多详细信息，请参阅体系结构。要使用 API，您需要一个正在运行的 Ceph 存储集群。有关详细信息，请参阅安装（快速）。</p>
<h2><span id="第-1-步获取-librados">第 1 步：获取 LIBRADOS</span></h2><p>您的客户端应用程序必须绑定librados以连接到 Ceph 存储集群。您必须安装librados任何必需的包才能编写使用librados. APIlibrados是用 C++ 编写的，具有针对 C、Python、Java 和 PHP 的附加绑定。</p>
<h3><span id="1-为-cx2fc-获取-librados">1、为 C&#x2F;C++ 获取 LIBRADOS</span></h3><p>要在 Debian&#x2F;Ubuntu 发行版上安装libradosC&#x2F;C++ 的开发支持文件，请执行以下命令：</p>
<pre><code>sudo apt-get install librados-dev
</code></pre>
<p>要在 RHEL&#x2F;CentOS 发行版上安装libradosC&#x2F;C++ 的开发支持文件，请执行以下命令：</p>
<pre><code>sudo yum install librados2-devel
</code></pre>
<p>为开发人员安装后librados，您可以在以下位置找到 C&#x2F;C++ 所需的标头&#x2F;usr&#x2F;include&#x2F;rados：</p>
<pre><code>ls /usr/include/rados
</code></pre>
<h3><span id="2-为-python-获取-librados">2、为 PYTHON 获取 LIBRADOS</span></h3><p>该模块为 Python 应用程序rados提供支持。Debian&#x2F;Ubuntu 的软件包和libradosRHEL &#x2F;CentOS 的软件包将为 您安装软件包。你 也可以直接安装。librados-devlibrados2-develpython-radospython-rados</p>
<p>要librados在 Debian&#x2F;Ubuntu 发行版上安装 Python 的开发支持文件，请执行以下命令：</p>
<pre><code>sudo apt-get install python3-rados
</code></pre>
<p>要在 RHEL&#x2F;CentOS 发行版上安装libradosPython 的开发支持文件，请执行以下命令：</p>
<pre><code>sudo yum install python-rados
</code></pre>
<p>要在 SLE&#x2F;openSUSE 发行版上安装libradosPython 的开发支持文件，请执行以下命令：</p>
<pre><code>sudo zypper install python3-rados
</code></pre>
<p>&#x2F;usr&#x2F;share&#x2F;pyshared您可以在 Debian 系统下或 CentOS&#x2F;RHEL 系统下找到该模块&#x2F;usr&#x2F;lib&#x2F;python*&#x2F;site-packages。</p>
<h3><span id="3-为-java-获取-librados">3、为 JAVA 获取 LIBRADOS</span></h3><p>要为 Java 安装librados，您需要执行以下过程：<br>安装<br>jna.jar。对于 Debian&#x2F;Ubuntu，执行：</p>
<pre><code>sudo apt-get install libjna-java
</code></pre>
<p>对于 CentOS&#x2F;RHEL，执行：</p>
<pre><code>sudo yum install jna
</code></pre>
<p>JAR 文件位于&#x2F;usr&#x2F;share&#x2F;java.<br>克隆<br>rados-java存储库：</p>
<pre><code>git clone --recursive https://github.com/ceph/rados-java.git
</code></pre>
<p>构建<br>rados-java存储库：</p>
<pre><code>cd rados-java
ant
</code></pre>
<p>JAR 文件位于rados-java&#x2F;target.<br>将 RADOS 的 JAR 复制到一个公共位置（例如，<br>&#x2F;usr&#x2F;share&#x2F;java）并确保它和 JNA JAR 在您的 JVM 类路径中。例如：</p>
<pre><code>sudo cp target/rados-0.1.3.jar /usr/share/java/rados-0.1.3.jar
sudo ln -s /usr/share/java/jna-3.2.7.jar /usr/lib/jvm/default-java/jre/lib/ext/jna-3.2.7.jar
sudo ln -s /usr/share/java/rados-0.1.3.jar  /usr/lib/jvm/default-java/jre/lib/ext/rados-0.1.3.jar
</code></pre>
<p>要构建文档，请执行以下命令：</p>
<pre><code>ant docs
</code></pre>
<h3><span id="4-为-php-获取-librados">4、为 PHP 获取 LIBRADOS</span></h3><p>要安装libradosPHP 扩展，您需要执行以下过程：<br>安装 php-dev。<br>对于 Debian&#x2F;Ubuntu，执行：</p>
<pre><code>sudo apt-get install php5-dev build-essential
</code></pre>
<p>对于 CentOS&#x2F;RHEL，执行：</p>
<pre><code>sudo yum install php-devel
</code></pre>
<p>克隆<br>phprados存储库：</p>
<pre><code>git clone https://github.com/ceph/phprados.git
</code></pre>
<p>构建<br>phprados：</p>
<pre><code>cd phprados
phpize
./configure
make
sudo make install
</code></pre>
<p>phprados<br>通过将以下行添加到启用php.ini：</p>
<pre><code>extension=rados.so
</code></pre>
<h2><span id="第-2-步配置集群句柄">第 2 步：配置集群句柄</span></h2><p>Ceph 客户端通过直接librados与 OSD 交互以存储和检索数据。要与 OSD 交互，客户端应用程序必须调用 librados 并连接到 Ceph Monitor。连接后，从 Ceph Monitorlibrados 检索 Cluster Map 。当客户端应用程序想要读取或写入数据时，它会创建一个 I&#x2F;O 上下文并绑定到一个 Pool。该池有一个关联的CRUSH 规则，该规则定义它将如何将数据放置在存储集群中。通过 I&#x2F;O 上下文，客户端将对象名称提供给librados，它获取对象名称和集群映射（即集群的拓扑结构）并计算归置组和OSD 用于定位数据。然后客户端应用程序可以读取或写入数据。客户端应用程序不需要直接了解集群的拓扑结构。</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/2.jpg"></p>
<p>因此，从您的应用程序使用集群的第一步是 1) 创建一个集群句柄，您的应用程序将使用该句柄连接到存储集群，然后 2) 使用该句柄进行连接。要连接到集群，应用程序必须提供监视器地址、用户名和身份验证密钥（默认情况下启用 cephx）。</p>
<p>与不同的 Ceph 存储集群通信——或与不同用户的同一个集群通信——需要不同的集群句柄。<br>RADOS 提供了多种方法供您设置所需的值。对于监视器和加密密钥设置，一种简单的处理方法是确保您的 Ceph 配置文件包含keyring密钥环文件的路径和至少一个监视器地址（例如，）。例如：mon host</p>
<pre><code>[global]
mon host = 192.168.1.1
keyring = /etc/ceph/ceph.client.admin.keyring
</code></pre>
<p>创建句柄后，您可以读取 Ceph 配置文件来配置句柄。您还可以将参数传递给您的应用程序，并使用用于解析命令行参数的函数（例如，rados_conf_parse_argv()）或解析 Ceph 环境变量（例如，rados_conf_parse_env()）来解析它们。一些包装器可能不实现便利方法，因此您可能需要实现这些功能。下图提供了初始连接的高级流程</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/3.jpg"></p>
<p>连接后，您的应用程序可以仅使用集群句柄调用影响整个集群的函数。例如，一旦你有了一个集群句柄，你就可以：<br>获取集群统计信息<br>使用池操作（存在、创建、列出、删除）<br>获取和设置配置</p>
<p>Ceph 的强大功能之一是能够绑定到不同的池。每个池可能有不同数量的归置组、对象副本和复制策略。例如，可以将池设置为使用 SSD 存储常用对象的“热”池或使用纠删码的“冷”池。<br>各种librados绑定的主要区别在于 C 与 C++、Java 和 Python 的面向对象绑定之间。面向对象的绑定使用对象来表示集群句柄、IO 上下文、迭代器、异常等。</p>
<h3><span id="1-c-示例">1、C 示例</span></h3><p>对于 C，使用用户创建一个简单的集群句柄admin，配置它并连接到集群可能看起来像这样：</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;rados/librados.h&gt;

int main (int argc, const char **argv)
&#123;

        /* Declare the cluster handle and required arguments. */
        rados_t cluster;
        char cluster_name[] = &quot;ceph&quot;;
        char user_name[] = &quot;client.admin&quot;;
        uint64_t flags = 0;

        /* Initialize the cluster handle with the &quot;ceph&quot; cluster name and the &quot;client.admin&quot; user */
        int err;
        err = rados_create2(&amp;cluster, cluster_name, user_name, flags);

        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Couldn&#39;t create the cluster handle! %s\n&quot;, argv[0], strerror(-err));
                exit(EXIT_FAILURE);
        &#125; else &#123;
                printf(&quot;\nCreated a cluster handle.\n&quot;);
        &#125;


        /* Read a Ceph configuration file to configure the cluster handle. */
        err = rados_conf_read_file(cluster, &quot;/etc/ceph/ceph.conf&quot;);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: cannot read config file: %s\n&quot;, argv[0], strerror(-err));
                exit(EXIT_FAILURE);
        &#125; else &#123;
                printf(&quot;\nRead the config file.\n&quot;);
        &#125;

        /* Read command line arguments */
        err = rados_conf_parse_argv(cluster, argc, argv);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: cannot parse command line arguments: %s\n&quot;, argv[0], strerror(-err));
                exit(EXIT_FAILURE);
        &#125; else &#123;
                printf(&quot;\nRead the command line arguments.\n&quot;);
        &#125;

        /* Connect to the cluster */
        err = rados_connect(cluster);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: cannot connect to cluster: %s\n&quot;, argv[0], strerror(-err));
                exit(EXIT_FAILURE);
        &#125; else &#123;
                printf(&quot;\nConnected to the cluster.\n&quot;);
        &#125;

&#125;
</code></pre>
<p>编译您的客户端并链接到librados使用-lrados. 例如：</p>
<pre><code>gcc ceph-client.c -lrados -o ceph-client
</code></pre>
<h3><span id="2-c-示例">2、C++ 示例</span></h3><p>Ceph 项目在ceph&#x2F;examples&#x2F;librados 目录中提供了一个 C++ 示例。对于 C++，使用用户的简单簇句柄admin需要您初始化librados::Rados簇句柄对象：</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;rados/librados.hpp&gt;

int main(int argc, const char **argv)
&#123;

        int ret = 0;

        /* Declare the cluster handle and required variables. */
        librados::Rados cluster;
        char cluster_name[] = &quot;ceph&quot;;
        char user_name[] = &quot;client.admin&quot;;
        uint64_t flags = 0;

        /* Initialize the cluster handle with the &quot;ceph&quot; cluster name and &quot;client.admin&quot; user */
        &#123;
                ret = cluster.init2(user_name, cluster_name, flags);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t initialize the cluster handle! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        return EXIT_FAILURE;
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Created a cluster handle.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;

        /* Read a Ceph configuration file to configure the cluster handle. */
        &#123;
                ret = cluster.conf_read_file(&quot;/etc/ceph/ceph.conf&quot;);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t read the Ceph configuration file! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        return EXIT_FAILURE;
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Read the Ceph configuration file.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;

        /* Read command line arguments */
        &#123;
                ret = cluster.conf_parse_argv(argc, argv);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t parse command line options! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        return EXIT_FAILURE;
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Parsed command line options.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;

        /* Connect to the cluster */
        &#123;
                ret = cluster.connect();
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t connect to cluster! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        return EXIT_FAILURE;
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Connected to the cluster.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;

        return 0;
&#125;
</code></pre>
<p>编译源码；然后，链接librados使用-lrados。例如：</p>
<pre><code>g++ -g -c ceph-client.cc -o ceph-client.o
g++ -g ceph-client.o -lrados -o ceph-client
</code></pre>
<h3><span id="3-python-示例">3、PYTHON 示例</span></h3><p>Python默认使用adminid和集群名，如果conffile参数设置为空字符串，会读取标准文件。Python 绑定将 C++ 错误转换为异常。</p>
<pre><code>import rados

try:
        cluster = rados.Rados(conffile=&#39;&#39;)
except TypeError as e:
        print &#39;Argument validation error: &#39;, e
        raise e

print &quot;Created cluster handle.&quot;

try:
        cluster.connect()
except Exception as e:
        print &quot;connection error: &quot;, e
        raise e
finally:
        print &quot;Connected to the cluster.&quot;
</code></pre>
<p>执行示例以验证它是否连接到您的集群：</p>
<pre><code>python ceph-client.py
</code></pre>
<h3><span id="4-java-示例">4、JAVA 示例</span></h3><p>Java 要求您指定用户 ID ( admin) 或用户名 ( client.admin)，并ceph默认使用集群名称。Java 绑定将基于 C++ 的错误转换为异常</p>
<pre><code>import com.ceph.rados.Rados;
import com.ceph.rados.RadosException;

import java.io.File;

public class CephClient &#123;
        public static void main (String args[])&#123;

                try &#123;
                        Rados cluster = new Rados(&quot;admin&quot;);
                        System.out.println(&quot;Created cluster handle.&quot;);

                        File f = new File(&quot;/etc/ceph/ceph.conf&quot;);
                        cluster.confReadFile(f);
                        System.out.println(&quot;Read the configuration file.&quot;);

                        cluster.connect();
                        System.out.println(&quot;Connected to the cluster.&quot;);

                &#125; catch (RadosException e) &#123;
                        System.out.println(e.getMessage() + &quot;: &quot; + e.getReturnValue());
                &#125;
        &#125;
&#125;
</code></pre>
<p>编译源码；然后，运行它。如果您已将 JAR 复制到 &#x2F;usr&#x2F;share&#x2F;java您的目录并从中链接了 sym ext，则无需指定类路径。例如：</p>
<pre><code>javac CephClient.java
java CephClient
</code></pre>
<h3><span id="5-php-示例">5、PHP 示例</span></h3><p>在 PHP 中启用 RADOS 扩展后，您可以非常轻松地开始创建新的集群句柄：</p>
<pre><code>&lt;?php

$r = rados_create();
rados_conf_read_file($r, &#39;/etc/ceph/ceph.conf&#39;);
if (!rados_connect($r)) &#123;
        echo &quot;Failed to connect to Ceph cluster&quot;;
&#125; else &#123;
        echo &quot;Successfully connected to Ceph cluster&quot;;
&#125;
</code></pre>
<p>将其保存为 rados.php 并运行代码：</p>
<pre><code>php rados.php
</code></pre>
<h2><span id="第-3-步创建-ix2fo-上下文">第 3 步：创建 I&#x2F;O 上下文</span></h2><p>一旦你的应用程序有了一个集群句柄并连接到 Ceph 存储集群，你就可以创建一个 I&#x2F;O 上下文并开始读写数据。I&#x2F;O 上下文将连接绑定到特定池。用户必须具有适当的 CAPS权限才能访问指定的池。例如，具有读取权限但没有写入权限的用户将只能读取数据。I&#x2F;O 上下文功能包括：</p>
<ul>
<li>写入&#x2F;读取数据和扩展属性</li>
<li>列出并迭代对象和扩展属性</li>
<li>快照池、列表快照等。</li>
</ul>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/4.jpg"></p>
<p>RADOS 使您能够同步和异步交互。一旦您的应用程序拥有 I&#x2F;O 上下文，读&#x2F;写操作只需要您知道对象&#x2F;xattr 名称。封装的 CRUSH 算法librados使用 cluster map 来识别合适的 OSD。OSD 守护进程处理复制，如Smart Daemons Enable Hyperscale中所述。该librados库还将对象映射到归置组，如 计算 PG ID中所述。</p>
<p>以下示例使用默认data池。但是，您也可以使用 API 列出池，确保它们存在，或者创建和删除池。对于写操作，示例说明了如何使用同步模式。对于读取操作，示例说明了如何使用异步模式。</p>
<blockquote>
<p>使用此 API 删除池时要小心。如果删除一个池，该池和池中的所有数据都将丢失。</p>
</blockquote>
<h3><span id="1-c-示例">1、C 示例</span></h3><pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;rados/librados.h&gt;

int main (int argc, const char **argv)
&#123;
        /*
         * Continued from previous C example, where cluster handle and
         * connection are established. First declare an I/O Context.
         */

        rados_ioctx_t io;
        char *poolname = &quot;data&quot;;

        err = rados_ioctx_create(cluster, poolname, &amp;io);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: cannot open rados pool %s: %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_shutdown(cluster);
                exit(EXIT_FAILURE);
        &#125; else &#123;
                printf(&quot;\nCreated I/O context.\n&quot;);
        &#125;

        /* Write data to the cluster synchronously. */
        err = rados_write(io, &quot;hw&quot;, &quot;Hello World!&quot;, 12, 0);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot write object \&quot;hw\&quot; to pool %s: %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nWrote \&quot;Hello World\&quot; to object \&quot;hw\&quot;.\n&quot;);
        &#125;

        char xattr[] = &quot;en_US&quot;;
        err = rados_setxattr(io, &quot;hw&quot;, &quot;lang&quot;, xattr, 5);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot write xattr to pool %s: %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nWrote \&quot;en_US\&quot; to xattr \&quot;lang\&quot; for object \&quot;hw\&quot;.\n&quot;);
        &#125;

        /*
         * Read data from the cluster asynchronously.
         * First, set up asynchronous I/O completion.
         */
        rados_completion_t comp;
        err = rados_aio_create_completion(NULL, NULL, NULL, &amp;comp);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Could not create aio completion: %s\n&quot;, argv[0], strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nCreated AIO completion.\n&quot;);
        &#125;

        /* Next, read data using rados_aio_read. */
        char read_res[100];
        err = rados_aio_read(io, &quot;hw&quot;, comp, read_res, 12, 0);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot read object. %s %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nRead object \&quot;hw\&quot;. The contents are:\n %s \n&quot;, read_res);
        &#125;

        /* Wait for the operation to complete */
        rados_aio_wait_for_complete(comp);

        /* Release the asynchronous I/O complete handle to avoid memory leaks. */
        rados_aio_release(comp);


        char xattr_res[100];
        err = rados_getxattr(io, &quot;hw&quot;, &quot;lang&quot;, xattr_res, 5);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot read xattr. %s %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nRead xattr \&quot;lang\&quot; for object \&quot;hw\&quot;. The contents are:\n %s \n&quot;, xattr_res);
        &#125;

        err = rados_rmxattr(io, &quot;hw&quot;, &quot;lang&quot;);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot remove xattr. %s %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nRemoved xattr \&quot;lang\&quot; for object \&quot;hw\&quot;.\n&quot;);
        &#125;

        err = rados_remove(io, &quot;hw&quot;);
        if (err &lt; 0) &#123;
                fprintf(stderr, &quot;%s: Cannot remove object. %s %s\n&quot;, argv[0], poolname, strerror(-err));
                rados_ioctx_destroy(io);
                rados_shutdown(cluster);
                exit(1);
        &#125; else &#123;
                printf(&quot;\nRemoved object \&quot;hw\&quot;.\n&quot;);
        &#125;

&#125;
</code></pre>
<h3><span id="2-c-示例">2、C++ 示例</span></h3><pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;rados/librados.hpp&gt;

int main(int argc, const char **argv)
&#123;

        /* Continued from previous C++ example, where cluster handle and
         * connection are established. First declare an I/O Context.
         */

        librados::IoCtx io_ctx;
        const char *pool_name = &quot;data&quot;;

        &#123;
                ret = cluster.ioctx_create(pool_name, io_ctx);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t set up ioctx! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Created an ioctx for the pool.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;


        /* Write an object synchronously. */
        &#123;
                librados::bufferlist bl;
                bl.append(&quot;Hello World!&quot;);
                ret = io_ctx.write_full(&quot;hw&quot;, bl);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t write object! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Wrote new object &#39;hw&#39; &quot; &lt;&lt; std::endl;
                &#125;
        &#125;


        /*
         * Add an xattr to the object.
         */
        &#123;
                librados::bufferlist lang_bl;
                lang_bl.append(&quot;en_US&quot;);
                ret = io_ctx.setxattr(&quot;hw&quot;, &quot;lang&quot;, lang_bl);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;failed to set xattr version entry! error &quot;
                        &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Set the xattr &#39;lang&#39; on our object!&quot; &lt;&lt; std::endl;
                &#125;
        &#125;


        /*
         * Read the object back asynchronously.
         */
        &#123;
                librados::bufferlist read_buf;
                int read_len = 4194304;

                //Create I/O Completion.
                librados::AioCompletion *read_completion = librados::Rados::aio_create_completion();

                //Send read request.
                ret = io_ctx.aio_read(&quot;hw&quot;, read_completion, &amp;read_buf, read_len, 0);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t start read object! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125;

                // Wait for the request to complete, and check that it succeeded.
                read_completion-&gt;wait_for_complete();
                ret = read_completion-&gt;get_return_value();
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t read object! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Read object hw asynchronously with contents.\n&quot;
                        &lt;&lt; read_buf.c_str() &lt;&lt; std::endl;
                &#125;
        &#125;


        /*
         * Read the xattr.
         */
        &#123;
                librados::bufferlist lang_res;
                ret = io_ctx.getxattr(&quot;hw&quot;, &quot;lang&quot;, lang_res);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;failed to get xattr version entry! error &quot;
                        &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Got the xattr &#39;lang&#39; from object hw!&quot;
                        &lt;&lt; lang_res.c_str() &lt;&lt; std::endl;
                &#125;
        &#125;


        /*
         * Remove the xattr.
         */
        &#123;
                ret = io_ctx.rmxattr(&quot;hw&quot;, &quot;lang&quot;);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Failed to remove xattr! error &quot;
                        &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Removed the xattr &#39;lang&#39; from our object!&quot; &lt;&lt; std::endl;
                &#125;
        &#125;

        /*
         * Remove the object.
         */
        &#123;
                ret = io_ctx.remove(&quot;hw&quot;);
                if (ret &lt; 0) &#123;
                        std::cerr &lt;&lt; &quot;Couldn&#39;t remove object! error &quot; &lt;&lt; ret &lt;&lt; std::endl;
                        exit(EXIT_FAILURE);
                &#125; else &#123;
                        std::cout &lt;&lt; &quot;Removed object &#39;hw&#39;.&quot; &lt;&lt; std::endl;
                &#125;
        &#125;
&#125;
</code></pre>
<h3><span id="3-python-示例">3、PYTHON 示例</span></h3><pre><code>print &quot;\n\nI/O Context and Object Operations&quot;
print &quot;=================================&quot;

print &quot;\nCreating a context for the &#39;data&#39; pool&quot;
if not cluster.pool_exists(&#39;data&#39;):
        raise RuntimeError(&#39;No data pool exists&#39;)
ioctx = cluster.open_ioctx(&#39;data&#39;)

print &quot;\nWriting object &#39;hw&#39; with contents &#39;Hello World!&#39; to pool &#39;data&#39;.&quot;
ioctx.write(&quot;hw&quot;, &quot;Hello World!&quot;)
print &quot;Writing XATTR &#39;lang&#39; with value &#39;en_US&#39; to object &#39;hw&#39;&quot;
ioctx.set_xattr(&quot;hw&quot;, &quot;lang&quot;, &quot;en_US&quot;)


print &quot;\nWriting object &#39;bm&#39; with contents &#39;Bonjour tout le monde!&#39; to pool &#39;data&#39;.&quot;
ioctx.write(&quot;bm&quot;, &quot;Bonjour tout le monde!&quot;)
print &quot;Writing XATTR &#39;lang&#39; with value &#39;fr_FR&#39; to object &#39;bm&#39;&quot;
ioctx.set_xattr(&quot;bm&quot;, &quot;lang&quot;, &quot;fr_FR&quot;)

print &quot;\nContents of object &#39;hw&#39;\n------------------------&quot;
print ioctx.read(&quot;hw&quot;)

print &quot;\n\nGetting XATTR &#39;lang&#39; from object &#39;hw&#39;&quot;
print ioctx.get_xattr(&quot;hw&quot;, &quot;lang&quot;)

print &quot;\nContents of object &#39;bm&#39;\n------------------------&quot;
print ioctx.read(&quot;bm&quot;)

print &quot;Getting XATTR &#39;lang&#39; from object &#39;bm&#39;&quot;
print ioctx.get_xattr(&quot;bm&quot;, &quot;lang&quot;)


print &quot;\nRemoving object &#39;hw&#39;&quot;
ioctx.remove_object(&quot;hw&quot;)

print &quot;Removing object &#39;bm&#39;&quot;
ioctx.remove_object(&quot;bm&quot;)
</code></pre>
<h3><span id="4-java-示例">4、JAVA 示例</span></h3><pre><code>import com.ceph.rados.Rados;
import com.ceph.rados.RadosException;

import java.io.File;
import com.ceph.rados.IoCTX;

public class CephClient &#123;
        public static void main (String args[])&#123;

                try &#123;
                        Rados cluster = new Rados(&quot;admin&quot;);
                        System.out.println(&quot;Created cluster handle.&quot;);

                        File f = new File(&quot;/etc/ceph/ceph.conf&quot;);
                        cluster.confReadFile(f);
                        System.out.println(&quot;Read the configuration file.&quot;);

                        cluster.connect();
                        System.out.println(&quot;Connected to the cluster.&quot;);

                        IoCTX io = cluster.ioCtxCreate(&quot;data&quot;);

                        String oidone = &quot;hw&quot;;
                        String contentone = &quot;Hello World!&quot;;
                        io.write(oidone, contentone);

                        String oidtwo = &quot;bm&quot;;
                        String contenttwo = &quot;Bonjour tout le monde!&quot;;
                        io.write(oidtwo, contenttwo);

                        String[] objects = io.listObjects();
                        for (String object: objects)
                                System.out.println(object);

                        io.remove(oidone);
                        io.remove(oidtwo);

                        cluster.ioCtxDestroy(io);

                &#125; catch (RadosException e) &#123;
                        System.out.println(e.getMessage() + &quot;: &quot; + e.getReturnValue());
                &#125;
        &#125;
&#125;
</code></pre>
<h3><span id="5-php-示例">5、PHP 示例</span></h3><pre><code>&lt;?php

$io = rados_ioctx_create($r, &quot;mypool&quot;);
rados_write_full($io, &quot;oidOne&quot;, &quot;mycontents&quot;);
rados_remove(&quot;oidOne&quot;);
rados_ioctx_destroy($io);
</code></pre>
<h2><span id="第-4-步结束链接">第 4 步：结束链接</span></h2><p>一旦你的应用程序完成了 I&#x2F;O 上下文和集群句柄，应用程序应该关闭连接并关闭句柄。对于异步 I&#x2F;O，应用程序还应确保挂起的异步操作已完成。</p>
<h3><span id="1-c-示例">1、C 示例</span></h3><pre><code>rados_ioctx_destroy(io);
rados_shutdown(cluster);
</code></pre>
<h3><span id="2-c-示例">2、C++ 示例</span></h3><pre><code>io_ctx.close();
cluster.shutdown();
</code></pre>
<h3><span id="3-java-示例">3、JAVA 示例</span></h3><pre><code>cluster.ioCtxDestroy(io);
cluster.shutDown();
</code></pre>
<h3><span id="4-python-示例">4、PYTHON 示例</span></h3><pre><code>print &quot;\nClosing the connection.&quot;
ioctx.close()

print &quot;Shutting down the handle.&quot;
cluster.shutdown()
</code></pre>
<h3><span id="4-php-示例">4、PHP 示例</span></h3><pre><code>rados_shutdown($r);
</code></pre>
<h2><span id="第5步python测试">第5步：Python测试</span></h2><pre><code>[root@node-1 python]# ceph osd pool create data 8 8 
pool &#39;data&#39; created
[root@node-1 python]# cat ceph.py 
#!/usr/bin/python
# -*- coding: utf-8 -*-
import rados

try:
        cluster = rados.Rados(conffile=&#39;/etc/ceph/ceph.conf&#39;)
except TypeError as e:
        print &#39;Argument validation error: &#39;, e
        raise e

print &quot;Created cluster handle.&quot;

try:
        cluster.connect()
except Exception as e:
        print &quot;connection error: &quot;, e
        raise e
finally:
        print &quot;Connected to the cluster.&quot;

print &quot;\n\nI/O Context and Object Operations&quot;
print &quot;=================================&quot;

print &quot;\nCreating a context for the &#39;data&#39; pool&quot;
if not cluster.pool_exists(&#39;data&#39;):
        raise RuntimeError(&#39;No data pool exists&#39;)
ioctx = cluster.open_ioctx(&#39;data&#39;)

print &quot;\nWriting object &#39;hw&#39; with contents &#39;Hello World!&#39; to pool &#39;data&#39;.&quot;
ioctx.write(&quot;hw&quot;, &quot;Hello World!&quot;)
print &quot;Writing XATTR &#39;lang&#39; with value &#39;en_US&#39; to object &#39;hw&#39;&quot;
ioctx.set_xattr(&quot;hw&quot;, &quot;lang&quot;, &quot;en_US&quot;)


print &quot;\nWriting object &#39;bm&#39; with contents &#39;Bonjour tout le monde!&#39; to pool &#39;data&#39;.&quot;
ioctx.write(&quot;bm&quot;, &quot;Bonjour tout le monde!&quot;)
print &quot;Writing XATTR &#39;lang&#39; with value &#39;fr_FR&#39; to object &#39;bm&#39;&quot;
ioctx.set_xattr(&quot;bm&quot;, &quot;lang&quot;, &quot;fr_FR&quot;)

print &quot;\nContents of object &#39;hw&#39;\n------------------------&quot;
print ioctx.read(&quot;hw&quot;)

print &quot;\n\nGetting XATTR &#39;lang&#39; from object &#39;hw&#39;&quot;
print ioctx.get_xattr(&quot;hw&quot;, &quot;lang&quot;)

print &quot;\nContents of object &#39;bm&#39;\n------------------------&quot;
print ioctx.read(&quot;bm&quot;)

print &quot;Getting XATTR &#39;lang&#39; from object &#39;bm&#39;&quot;
print ioctx.get_xattr(&quot;bm&quot;, &quot;lang&quot;)


print &quot;\nRemoving object &#39;hw&#39;&quot;
ioctx.remove_object(&quot;hw&quot;)

print &quot;Removing object &#39;bm&#39;&quot;
ioctx.remove_object(&quot;bm&quot;)

print &quot;\nClosing the connection.&quot;
ioctx.close()

print &quot;Shutting down the handle.&quot;
cluster.shutdown()
[root@node-1 python]# python ceph.py 
Created cluster handle.
Connected to the cluster.


I/O Context and Object Operations
=================================

Creating a context for the &#39;data&#39; pool

Writing object &#39;hw&#39; with contents &#39;Hello World!&#39; to pool &#39;data&#39;.
Writing XATTR &#39;lang&#39; with value &#39;en_US&#39; to object &#39;hw&#39;

Writing object &#39;bm&#39; with contents &#39;Bonjour tout le monde!&#39; to pool &#39;data&#39;.
Writing XATTR &#39;lang&#39; with value &#39;fr_FR&#39; to object &#39;bm&#39;

Contents of object &#39;hw&#39;
------------------------
Hello World!


Getting XATTR &#39;lang&#39; from object &#39;hw&#39;
en_US

Contents of object &#39;bm&#39;
------------------------
Bonjour tout le monde!
Getting XATTR &#39;lang&#39; from object &#39;bm&#39;
fr_FR

Removing object &#39;hw&#39;
Removing object &#39;bm&#39;

Closing the connection.
Shutting down the handle.
</code></pre>
<h1><span id="三-ceph-块设备-api">三、CEPH 块设备 API</span></h1><p>Ceph的客户端是系统对外提供的功能接口，上层应用通过它访问ceph存储系统。</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/5.jpg"><br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/6.jpg"></p>
<h2><span id="rados的客户端api">RADOS的客户端API</span></h2><p>上述接口几乎包括了对Ceph集群和其中数据的所有访问功能。其中所谓集群的整体访问包括连接集群、创建存储池、删除存储池和获取集群状态等等。所谓对象访问是之对存储池中对象的访问，包括创建删除对象、向对象写数据或者追加数据和读对象数据等接口。上述功能通过Rados和IoCtx两个类实现，两个类的主要函数如图2所示（这里仅是示例，实际接口数量要多很多，具体参考源代码）。</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/7.jpg"><br>图2 访问接口类图<br><a target="_blank" rel="noopener" href="https://www.freesion.com/article/9714523649/">https://www.freesion.com/article/9714523649/</a><br>Librados 架构图</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/8.jpg"></p>
<h2><span id="1-librbd-amp-librados介绍">1. librbd  &amp;  librados介绍</span></h2><p>Librbd模块实现了RBD接口，其基于Librados实现了对RBD的基本操作。</p>
<h2><span id="11-架构概述">1.1 架构概述</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/9.jpg"><br> 上层应用层访问RBD块设备有两种途径：librbd和krbd。其中librbd是一个属于librados的用户态接口库，而krbd是继承在GNU&#x2F;Linux内核中的一个内核模块，通过用户态的rbd命令行工具，可以将RBD块设备映射为本地的一个块设备文件。</p>
<p>从RBD的架构图中可以看到，RBD块设备由于元数据信息少且访问不频繁，故RBD在Ceph集群中不需要daemon守护进程将元数据加载到内存进行元数据访问加速，所有的元数据和数据操作直接与集群中的MON服务和OSD服务交互。其架构图如下：</p>
<p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/10.jpg"><br> 最上层是librbd层，模块cls_rbd是一个Cls扩展模块，实现了RBD的元数据相关的操作。RBD的数访问直接通过librados来访问。在最底层是OSDC层完成数据的发送。</p>
<h2><span id="12-源码结构">1.2 源码结构</span></h2><h3><span id="121-librbd">1.2.1 librbd</span></h3><p>在src&#x2F;librbd下为librbd的源码，其中分为.cc文件和.h文件和子目录，文件的大致内容为：</p>
<ol>
<li>.cc和.h 文件：对应组件的源码；<br>2.子目录： 子目录中文件为针对每个模块的请求，如针对librbd&#x2F;operation.cc组件，存在路径为operation，路径中文件为：<br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/11.jpg"></li>
</ol>
<p>可见相应目录中为对应组件的请求的实现，这些请求发送到rados，进而实现对osd的操作。</p>
<h3><span id="122-librados">1.2.2 librados</span></h3><p> src&#x2F;librados中为librados的源码，内容如下：<br> <img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/12.jpg"></p>
<p> 与librbd目录下源码相比，librados中的源码内容相对较少，librados.cc中负责接口的封装，具体的实现细节在IoCtxImpl.cc中。</p>
<h2><span id="2-librados-amp-librbd-api介绍">2、librados &amp; librbd API介绍</span></h2><h3><span id="21-源码概览">2.1 源码概览</span></h3><p>ceph封装的接口源码位于src&#x2F;pybind路径下，其中子目录下的.pyx文件为api接口源码，文件结构如图：<br> <img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/13.jpg"></p>
<h3><span id="22-主要操作介绍">2.2 主要操作介绍</span></h3><p> 对于librbd和librados提供的python api接口，本文重点关注以下操作：</p>
<pre><code>1 1.  pool的创建和删除；
2 2.  image的创建和删除；
3 3.  snapshot的创建、利用snapshot进行clone操作、snapshot的删除；
4 4.  image flatten操作。
</code></pre>
<p> 下文将按照{create pool} -&gt; {create image} -&gt; {create snapshot} -&gt; {image clone} -&gt; {image flatten} -&gt; {delete snapshot} -&gt; {delete image} -&gt; {delete pool}的顺序来依次介绍上述操作的api接口调用。</p>
<h4><span id="221-准备工作创建链接">2.2.1 准备工作：创建链接</span></h4><p>在所有操作之前，首先需要创建对集群的连接，才能进行进一步的操作：</p>
<pre><code>1 import rados
2 import rbd
3 # connect to cluster
4 cluster = rados.Rados(conffile=&#39;/etc/ceph/ceph.conf&#39;)
5 cluster.connect()
</code></pre>
<h4><span id="222-创建存储池并获取ioctx">2.2.2 创建存储池，并获取ioctx</span></h4><p>创建了对集群的connection之后，就可以创建存储池，并获取ioctx。</p>
<pre><code> 1 #list pool
 2 before_create = cluster.list_pools()
 3 print(&quot;before create pools:&#123;0&#125;.format(before_create))
 4 
 5 #create pool
 6 cluster.create_pool(POOL)
 7 
 8 #list pool
 9 after_create = cluster.list_pools()
10 print(&quot;after create pools:&#123;0&#125;.format(after_create))
11 
12 #get_ioctx
13 ioctx = cluster.open_ioctx(POOL)
</code></pre>
<blockquote>
<p>这里create_pool()接口的输入不包括pg和pgp，因为pgp和pg的数量在api中是根据ceph.conf中参数设置。</p>
</blockquote>
<pre><code>1 # /etc/ceph/ceph.conf
2 osd_pool_default_pg_num = &#123;int&#125;
3 osd_pool_default_pgp_num = &#123;int&#125;
</code></pre>
<h4><span id="223-创建image">2.2.3 创建image</span></h4><p>创建存储池并获取ioctx，就可以开始创建rbd image了</p>
<pre><code>1 rbd_inst = rbd.RBD()
2 size = 4* 1024 * 3
3 
4 rbd_inst.create(ioctx, &quot;myimage&quot;, size)
5 img_list = rbd_inst.list( ioctx)
6 print(&quot;after create images &#123;0&#125;&quot;.format(img_list))
</code></pre>
<blockquote>
<p>1.在哪个pool中创建image，ioctx就从哪个pool中获取；<br>2.image创建必须显示指定大小，size计算值为bytes。</p>
</blockquote>
<h4><span id="224-创建snapshot">2.2.4 创建snapshot</span></h4><p>rbd image创建之后，就可以根据image创建snapshot了。</p>
<pre><code>1 # create snapshot
2 print(&quot;start to create snapshot&quot;)
3 rbd_img = rbd.Image(ioctx, name=IMG)
4 rbd_img.create_snap(SNP)
5 # list snapshot
6 print(&quot;list snapshot&quot;)
7 snap_list = rbd_img.list_snaps()
8 for item in snap_list:
9     print(item[&#39;name&#39;])
</code></pre>
<blockquote>
<p>1.使用的是img.Image()类，与2.2.2区分；<br>2.snap_list的类型为rbd.SnapIterator(Image image），使用for循环迭代的元素为dict，其中有三个key： id（int：numeric identifier of the snapshot), size(int, size of the image at the time of snapshot (in bytes)); name ( str: name of the snapshot).</p>
</blockquote>
<h4><span id="225-使用snapshot-clone-rbd-image">2.2.5 使用snapshot clone rbd image</span></h4><p>如果需要使用snapshot克隆image，需要首先对snapshot进行保护，之后才能进行clone操作。</p>
<pre><code>1 # protect snapshot
2 rbd_img.protect_snap(SNP)
3 is_protect = rbd_img.is_protected_snap(SNP)
4 print(&quot;&#123;0&#125; protected status:&#123;1&#125;&quot;.format(SNP, is_protect))
5 # image clone
6 print(&quot;clone image&quot;)
7 # parent_ioctx, parent_image_name,parent_snap_name, child_ioctx, child_image_name
8 rbd_inst.clone(ioctx, “myimage”,“mysnapshot”, ioctx, “clnimg”)
9 img_list = rbd_inst.list(ioctx)
</code></pre>
<blockquote>
<p>1.rbd_image() 需要与保护的snapshot一致（即在初始化时需要提供该snapshot隶属的pool的ioctx和image的name）：<br>2.clone() 函数必须传入的五个变量</p>
</blockquote>
<blockquote>
<blockquote>
<p>(1) parent_ioctx: snapshot 父类的ioctx;(2) parent_image_name: 父image的名称;(3) parent_snap_name: 父snapshot的名称;(4) child_ioctx: 子image的ioctx;(5) child_image_name: 子image名称;</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>如果clone之后的image和原来的image位于同一个pool，则两者的ioctx相同，反之需要从子image所属的pool获取子ioctx。</p>
</blockquote>
</blockquote>
</blockquote>
<h4><span id="226-image-flatten">2.2.6 image flatten</span></h4><p>image flatten操作使clone生成的rbd image摆脱对snapshot的依赖</p>
<pre><code>1 # image flatten
2 print(&quot;flatten image&quot;)
3 clone_img = rbd.Image(ioctx, name=”clnimg”)
4 clone_img.flatten()
</code></pre>
<blockquote>
<p>因为需要访问的是clone生成的薪image，故需要新初始化一个rbd.Image（）访问。</p>
</blockquote>
<h4><span id="227-删除-snapshot-x2f-image-x2f-pool">2.2.7 删除 snapshot &#x2F; image &#x2F; pool</span></h4><pre><code> 1 # unprotect image
 2 print(&quot;unprotect snapshot&quot;)
 3 rbd_img.unprotect_snap(SNP)
 4 is_protect = rbd_img.is_protected_snap(SNP)
 5 print(&quot;&#123;0&#125; protected status:&#123;1&#125;&quot;.format(SNP, is_protect))
 6  
 7 # purge snapshot
 8 print(&quot;remove snapshot&quot;)
 9 rbd_img.remove_snap(SNP)
10  
11 # close image connection
12 rbd_img.clone()
13 clone_img.close()
14  
15 # remove rbd image
16 print(&quot;remove rbd image&quot;)
17 rbd_inst.remove(ioctx, IMG)
18 rbd_inst.remove(ioctx, CLN)
</code></pre>
<blockquote>
<p>1.只有在snapshot下的所有image都进行flatten操作之后，才能够unprotect该snapshot；<br>2.需要先关闭rbd.Image()对image的访问之后，才能移除rbd image。</p>
</blockquote>
<h4><span id="228-关闭链接终止对集群的访问">2.2.8 关闭链接，终止对集群的访问</span></h4><pre><code> 1 # close ioctx
 2 print(&quot;close ioctx&quot;)
 3 ioctx.close()
 4  
 5 # delete pool
 6 print(&quot;delete pool&quot;)
 7 cluster.delete_pool(POOL)
 8 after_delete = cluster.list_pools()
 9 print(&quot;after delete pools:  &#123;0&#125;&quot;.format(after_delete))
10  
11 # close connection
12 print(&quot;close connection&quot;)
13 cluster.shutdown()
</code></pre>
<blockquote>
<p>顺序：<br>{关闭ioctx} -&gt; {删除pool}-&gt; {关闭cluster链接}</p>
</blockquote>
<h3><span id="23-参考资料">2.3 参考资料</span></h3><ol>
<li>librbd(python)<br><a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rbd/api/librbdpy/">http://docs.ceph.com/docs/master/rbd/api/librbdpy/</a></li>
<li>librados(python)<br><a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/api/python/">http://docs.ceph.com/docs/master/rados/api/python/</a></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yi-mu-xi/p/10368990.html">https://www.cnblogs.com/yi-mu-xi/p/10368990.html</a></p>
<h2><span id="实践">实践</span></h2><pre><code>[root@node-1 python]# cat ceph-rbd.py 
#!/usr/bin/python
# -*- coding: utf-8 -*-
import rados
import rbd
cluster = rados.Rados(conffile=&#39;/etc/ceph/ceph.conf&#39;)
try:
    cluster.connect()
    ioctx = cluster.open_ioctx(&#39;data&#39;)
    try:
        rbd_inst = rbd.RBD()
        size = 4 * 1024**3  # 4 GiB
        rbd_inst.create(ioctx, &#39;myimage&#39;, size)
        image = rbd.Image(ioctx, &#39;myimage&#39;)
        try:
            data = &#39;foo&#39; * 200
            image.write(data, 0)
        finally:
            image.close()
    finally:
        ioctx.close()
finally:
    cluster.shutdown()
[root@node-1 python]# python ceph-rbd.py^C
[root@node-1 python]# rbd ls data
myimage
[root@node-1 python]# rbd info data/myimage
rbd image &#39;myimage&#39;:
    size 4 GiB in 1024 objects
    order 22 (4 MiB objects)
    snapshot_count: 0
    id: 652ecdcdc583b
    block_name_prefix: rbd_data.652ecdcdc583b
    format: 2
    features: layering, exclusive-lock, object-map, fast-diff, deep-flatten
    op_features: 
    flags: 
    create_timestamp: Sun Mar 19 19:39:38 2023
    access_timestamp: Sun Mar 19 19:39:38 2023
    modify_timestamp: Sun Mar 19 19:39:38 2023
</code></pre>
<h2><span id="官方文档">官方文档：</span></h2><p>rbd python模块提供对 RBD 图像的类文件访问。</p>
<h3><span id="示例创建和写入图像">示例：创建和写入图像</span></h3><p>要使用rbd，您必须首先连接到 RADOS 并打开一个 IO 上下文：</p>
<pre><code>cluster = rados.Rados(conffile=&#39;my_ceph.conf&#39;)
cluster.connect()
ioctx = cluster.open_ioctx(&#39;mypool&#39;)
</code></pre>
<p>然后你实例化一个 :class:rbd.RBD 对象，你用它来创建图像：</p>
<pre><code>rbd_inst = rbd.RBD()
size = 4 * 1024**3  # 4 GiB
rbd_inst.create(ioctx, &#39;myimage&#39;, size)
</code></pre>
<p>要对图像执行 I&#x2F;O，您需要实例化一个 :class:rbd.Image 对象：</p>
<pre><code>image = rbd.Image(ioctx, &#39;myimage&#39;)
data = &#39;foo&#39; * 200
image.write(data, 0)
</code></pre>
<p>这会将“foo”写入图像的前 600 个字节。请注意，数据不能是 :type:unicode - Librbd不知道如何处理比 :c:type:char 宽的字符。<br>最后，您需要关闭图像、IO 上下文和与 RADOS 的连接：</p>
<pre><code>image.close()
ioctx.close()
cluster.shutdown()
</code></pre>
<p>为了安全起见，这些调用中的每一个都需要在一个单独的 :finally 块中：</p>
<pre><code>cluster = rados.Rados(conffile=&#39;my_ceph_conf&#39;)
try:
    cluster.connect()
    ioctx = cluster.open_ioctx(&#39;my_pool&#39;)
    try:
        rbd_inst = rbd.RBD()
        size = 4 * 1024**3  # 4 GiB
        rbd_inst.create(ioctx, &#39;myimage&#39;, size)
        image = rbd.Image(ioctx, &#39;myimage&#39;)
        try:
            data = &#39;foo&#39; * 200
            image.write(data, 0)
        finally:
            image.close()
    finally:
        ioctx.close()
finally:
    cluster.shutdown()
</code></pre>
<p>这可能很麻烦，因此Rados、Ioctx和 Image类可以用作自动关闭&#x2F;关闭的上下文管理器（<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0343">请参阅</a>）。使用它们作为上下文管理器，上面的例子变成：</p>
<pre><code>with rados.Rados(conffile=&#39;my_ceph.conf&#39;) as cluster:
    with cluster.open_ioctx(&#39;mypool&#39;) as ioctx:
        rbd_inst = rbd.RBD()
        size = 4 * 1024**3  # 4 GiB
        rbd_inst.create(ioctx, &#39;myimage&#39;, size)
        with rbd.Image(ioctx, &#39;myimage&#39;) as image:
            data = &#39;foo&#39; * 200
            image.write(data, 0)
</code></pre>
<h1><span id="ragw-api">RAGW API</span></h1><p>Ceph 支持与Amazon S3 API的基本数据访问模型兼容的 RESTful API 。</p>
<h2><span id="一-s3-compatible-api">一、S3-compatible API</span></h2><h3><span id="1-api">1、API</span></h3><ul>
<li>Common</li>
<li>Authentication</li>
<li>Service Ops</li>
<li>Bucket Ops</li>
<li>Object Ops</li>
<li>C++</li>
<li>C#</li>
<li>Java</li>
<li>Perl</li>
<li>PHP</li>
<li>Python</li>
<li>Ruby AWS::SDK Examples (aws-sdk gem ~&gt;2)</li>
<li>Ruby AWS::S3 Examples (aws-s3 gem)</li>
</ul>
<h3><span id="2-功能支持">2、功能支持</span></h3><p>下表描述了当前 Amazon S3 功能特性的支持状态：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>列出桶</td>
<td>支持的</td>
</tr>
<tr>
<td>删除桶</td>
<td>支持的</td>
</tr>
<tr>
<td>创建桶</td>
<td>支持的</td>
</tr>
<tr>
<td>桶生命周期</td>
<td>支持的</td>
</tr>
<tr>
<td>桶复制</td>
<td>支持的</td>
</tr>
<tr>
<td>策略（桶、对象）</td>
<td>支持的</td>
</tr>
<tr>
<td>桶网站</td>
<td>支持的</td>
</tr>
<tr>
<td>存储桶 ACL（获取、放置）</td>
<td>支持的</td>
</tr>
<tr>
<td>桶位置</td>
<td>支持的</td>
</tr>
<tr>
<td>桶通知</td>
<td>支持的</td>
</tr>
<tr>
<td>桶对象版本</td>
<td>支持的</td>
</tr>
<tr>
<td>获取桶信息 (HEAD)</td>
<td>支持的</td>
</tr>
<tr>
<td>桶请求付款</td>
<td>支持的</td>
</tr>
<tr>
<td>放置对象</td>
<td>支持的</td>
</tr>
<tr>
<td>删除对象</td>
<td>支持的</td>
</tr>
<tr>
<td>获取对象</td>
<td>支持的</td>
</tr>
<tr>
<td>对象 ACL（获取、放置）</td>
<td>支持的</td>
</tr>
<tr>
<td>获取对象信息 (HEAD)</td>
<td>支持的</td>
</tr>
<tr>
<td>POST 对象</td>
<td>支持的</td>
</tr>
<tr>
<td>复制对象</td>
<td>支持的</td>
</tr>
<tr>
<td>分段上传</td>
<td>支持的</td>
</tr>
<tr>
<td>对象标记</td>
<td>支持的</td>
</tr>
<tr>
<td>桶标记</td>
<td>支持的</td>
</tr>
<tr>
<td>存储类</td>
<td>支持的</td>
</tr>
</tbody></table>
<h3><span id="3-不支持的标题字段">3、不支持的标题字段</span></h3><p>不支持以下常见请求头字段：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>服务器</td>
<td>回复</td>
</tr>
<tr>
<td>x-amz-删除标记</td>
<td>回复</td>
</tr>
<tr>
<td>x-amz-id-2</td>
<td>回复</td>
</tr>
<tr>
<td>x-amz 版本 ID</td>
<td>回复</td>
</tr>
</tbody></table>
<h3><span id="4-测试">4、测试：</span></h3><pre><code>[root@node-1 python]# vim s3client.py #创建一个叫做s3-sdk-demo的bucket
#!/usr/bin/python
# -*- coding: utf-8 -*-

import boto
import boto.s3.connection

access_key = &quot;OCK1875BBTEIYZ40P0BD&quot;
secret_key = &quot;CAubxcn0GBQUk650D1Kx3syDKZB4zWDAjDBwxFLQ&quot;

conn = boto.connect_s3(
        aws_access_key_id = access_key,
        aws_secret_access_key = secret_key,
        host=&#39;node-1&#39;,
        port=80,
        is_secure=False,                 
        calling_format = boto.s3.connection.OrdinaryCallingFormat(),
        )

conn.create_bucket(&#39;s3-sdk-demo&#39;)
for bucket in conn.get_all_buckets():
        print &quot;&#123;name&#125;\t&#123;created&#125;&quot;.format(
                name = bucket.name,
                created = bucket.creation_date,
        )
~                                                                                                                                          
~                                                                                                                                          
~                                                                                                                                          
~                                                                                                                                          
~                                                                                                                                          
~                                                                                                                                          
&quot;s3client.py&quot; 24L, 651C 已写入
您在 /var/spool/mail/root 中有新邮件
[root@node-1 python]# python s3client.py  #创建成功
ceph-s3-bucket    2023-03-09T10:33:21.666Z
s3-sdk-demo    2023-03-19T13:44:25.673Z
s3cmd-demo    2023-03-09T10:36:26.010Z
swift-demo    2023-03-09T10:39:31.869Z
[root@node-1 python]# cat s3client.py  #往桶里创建文件默认会放在最后一个桶，有时间可进行修改脚本
#!/usr/bin/python
# -*- coding: utf-8 -*-

import boto
import boto.s3.connection

access_key = &quot;OCK1875BBTEIYZ40P0BD&quot;
secret_key = &quot;CAubxcn0GBQUk650D1Kx3syDKZB4zWDAjDBwxFLQ&quot;

conn = boto.connect_s3(
        aws_access_key_id = access_key,
        aws_secret_access_key = secret_key,
        host=&#39;node-1&#39;,
        port=80,
        is_secure=False,               
        calling_format = boto.s3.connection.OrdinaryCallingFormat(),
        )
bucket=conn.get_bucket(&#39;s3-sdk-demo&#39;)
for bucket in conn.get_all_buckets():
        print &quot;&#123;name&#125;\t&#123;created&#125;&quot;.format(
                name = bucket.name,
                created = bucket.creation_date,
        )

for key in bucket.list():
        print &quot;&#123;name&#125;\t&#123;size&#125;\t&#123;modified&#125;&quot;.format(
                name = key.name,
                size = key.size,
                modified = key.last_modified,
                )
key = bucket.new_key(&#39;zhangy2.txt&#39;)
key.set_contents_from_string(&#39;Hello ZhangY!&#39;)
</code></pre>
<h2><span id="二-swift-compatible-api">二、Swift-compatible API</span></h2><h3><span id="1-api">1、API</span></h3><ul>
<li>Authentication</li>
<li>Service Ops</li>
<li>Container Ops</li>
<li>Object Ops</li>
<li>Temp URL Ops</li>
<li>Tutorial</li>
<li>Java</li>
<li>Python</li>
<li>Ruby</li>
</ul>
<h3><span id="2-功能支持">2、功能支持</span></h3><p>下表描述了当前 Swift 功能特性的支持状态：</p>
<table>
<thead>
<tr>
<th>特征</th>
<th>是否支持</th>
</tr>
</thead>
<tbody><tr>
<td>验证</td>
<td>支持</td>
</tr>
<tr>
<td>获取帐户元数据</td>
<td>支持</td>
</tr>
<tr>
<td>Swift ACL</td>
<td>支持</td>
</tr>
<tr>
<td>列出容器</td>
<td>支持</td>
</tr>
<tr>
<td>删除容器</td>
<td>支持</td>
</tr>
<tr>
<td>创建容器</td>
<td>支持</td>
</tr>
<tr>
<td>获取容器元数据</td>
<td>支持</td>
</tr>
<tr>
<td>更新容器元数据</td>
<td>支持</td>
</tr>
<tr>
<td>删除容器元数据</td>
<td>支持</td>
</tr>
<tr>
<td>列出对象</td>
<td>支持</td>
</tr>
<tr>
<td>静态网站</td>
<td>支持</td>
</tr>
<tr>
<td>创建对象</td>
<td>支持</td>
</tr>
<tr>
<td>创建大对象</td>
<td>支持</td>
</tr>
<tr>
<td>删除对象</td>
<td>支持</td>
</tr>
<tr>
<td>获取对象</td>
<td>支持</td>
</tr>
<tr>
<td>复制对象</td>
<td>支持</td>
</tr>
<tr>
<td>获取对象元数据</td>
<td>支持</td>
</tr>
<tr>
<td>更新对象元数据</td>
<td>支持</td>
</tr>
<tr>
<td>过期对象</td>
<td>支持</td>
</tr>
<tr>
<td>临时网址</td>
<td>支持</td>
</tr>
<tr>
<td>对象版本控制</td>
<td>支持</td>
</tr>
<tr>
<td>CORS</td>
<td>支持</td>
</tr>
</tbody></table>
<h2><span id="三-创建连接">三、创建连接</span></h2><p>这将创建一个连接，以便您可以与服务器交互：</p>
<pre><code>import swiftclient
user = &#39;account_name:username&#39;
key = &#39;your_api_key&#39;

conn = swiftclient.Connection(
        user=user,
        key=key,
        authurl=&#39;https://objects.dreamhost.com/auth&#39;,
)
</code></pre>
<h3><span id="1-创建一个容器">1、创建一个容器</span></h3><p>这将创建一个名为的新容器my-new-container：</p>
<pre><code>container_name = &#39;my-new-container&#39;
conn.put_container(container_name)
</code></pre>
<h3><span id="2-创建一个对象">2、创建一个对象</span></h3><p>这将从hello.txt名为的文件创建一个文件my_hello.txt：</p>
<pre><code>with open(&#39;hello.txt&#39;, &#39;r&#39;) as hello_file:
        conn.put_object(container_name, &#39;hello.txt&#39;,
                                        contents= hello_file.read(),
                                        content_type=&#39;text/plain&#39;)
</code></pre>
<h3><span id="3-列出拥有的容器">3、列出拥有的容器</span></h3><p>这将获取您拥有的容器列表，并打印出容器名称：</p>
<pre><code>for container in conn.get_account()[1]:
        print container[&#39;name&#39;]
</code></pre>
<p>输出看起来像这样：</p>
<pre><code>mahbuckat1
mahbuckat2
mahbuckat3
</code></pre>
<h3><span id="4-列出一个容器的内容">4、列出一个容器的内容</span></h3><p>这将获取容器中的对象列表，并打印出每个对象的名称、文件大小和最后修改日期：</p>
<pre><code>for data in conn.get_container(container_name)[1]:
        print &#39;&#123;0&#125;\t&#123;1&#125;\t&#123;2&#125;&#39;.format(data[&#39;name&#39;], data[&#39;bytes&#39;], data[&#39;last_modified&#39;])
</code></pre>
<p>输出看起来像这样：</p>
<pre><code>myphoto1.jpg 251262  2011-08-08T21:35:48.000Z
myphoto2.jpg 262518  2011-08-08T21:38:01.000Z
</code></pre>
<h3><span id="5-检索对象">5、检索对象</span></h3><p>这将下载对象hello.txt并将其保存在 .&#x2F;my_hello.txt：</p>
<pre><code>obj_tuple = conn.get_object(container_name, &#39;hello.txt&#39;)
with open(&#39;my_hello.txt&#39;, &#39;w&#39;) as my_hello:
        my_hello.write(obj_tuple[1])
</code></pre>
<h3><span id="6-删除对象">6、删除对象</span></h3><p>这将删除对象hello.txt：</p>
<pre><code>conn.delete_object(container_name, &#39;hello.txt&#39;)
</code></pre>
<h3><span id="7-删除容器">7、删除容器</span></h3><blockquote>
<p>容器必须是空的！否则请求将无效！</p>
</blockquote>
<pre><code>conn.delete_container(container_name)
</code></pre>
<h1><span id="ceph-mon空间不足排障">Ceph MON空间不足排障</span></h1><h2><span id="1-查看告警信息">1、查看告警信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/14.jpg"></p>
<h2><span id="2-查看具体信息">2、查看具体信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/15.jpg"></p>
<h2><span id="3-查看硬盘占用空间">3、查看硬盘占用空间</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/16.jpg"></p>
<h2><span id="4-参数设置30告警">4、参数设置30%告警</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/17.jpg"></p>
<h2><span id="5-扩容">5、扩容</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/18.jpg"></p>
<h2><span id="6-查看node-1告警消失">6、查看Node-1告警消失</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/19.jpg"></p>
<h1><span id="ceph集群阻塞故障排查">Ceph集群阻塞故障排查</span></h1><h2><span id="一-故障现象">一、故障现象</span></h2><p>查看集群状态也无法显示，夯住了<br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/20.jpg"></p>
<h2><span id="二-查看node-1mon日志">二、查看Node-1Mon日志</span></h2><p>根据报错信息得出没办法分配一个global_id和没办法得到一个健康的状态，并没有有效信息<br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/21.jpg"></p>
<h2><span id="三-查看node-2mon日志">三、查看Node-2Mon日志</span></h2><p>查看报错信息得到Node-2的存储空间已经没有了，所以报了一个错误<br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/22.jpg"></p>
<h2><span id="四-查看node-2的硬盘使用情况">四、查看Node-2的硬盘使用情况</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/23.jpg"></p>
<h2><span id="五-查看node-2的mon服务">五、查看Node-2的Mon服务</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/24.jpg"></p>
<h2><span id="六-过滤大于50m的文件">六、过滤大于50M的文件</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/25.jpg"><br><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/26.jpg"></p>
<h2><span id="七-得到文件基本都是被ceph的元数据占用了这个不能删除">七、得到文件基本都是被Ceph的元数据占用了，这个不能删除</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/27.jpg"></p>
<h2><span id="八-解决方法">八、解决方法</span></h2><p>扩容硬盘</p>
<h1><span id="服务carsh归档排查">服务carsh归档排查</span></h1><h2><span id="一-查看集群状态">一、查看集群状态</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/28.jpg"></p>
<h2><span id="二-查看详细信息">二、查看详细信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/29.jpg"></p>
<h2><span id="三-查看日志">三、查看日志</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/30.jpg"></p>
<h2><span id="四-提示80端口被占用">四、提示80端口被占用</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/31.jpg"></p>
<h2><span id="五-查看告警信息">五、查看告警信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/32.jpg"></p>
<h2><span id="六-查看详细信息">六、查看详细信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/33.jpg"></p>
<h2><span id="七-归档一个告警信息">七、归档一个告警信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/34.jpg"></p>
<h2><span id="八-归档所有告警信息">八、归档所有告警信息</span></h2><p><img src="/images/Ceph/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/35.jpg"></p>
<h1><span id="时钟偏移故障排查">时钟偏移故障排查</span></h1><pre><code>[root@node-1 python]# ceph -s #查看状态
  cluster:
    id:     b8e58b30-4568-4032-a9f4-837ed3fa9529
    health: HEALTH_WARN
            clock skew detected on mon.node-2 #看到node-2节点时钟偏移
 
  services:
    mon: 3 daemons, quorum node-1,node-2,node-3 (age 24s)
    mgr: node-1(active, since 4h), standbys: node-2, node-3
    mds: cephfs-demo:1 &#123;0=node-2=up:active(laggy or crashed)&#125; 2 up:standby
    osd: 6 osds: 6 up (since 5h), 6 in (since 8h)
    rgw: 2 daemons active (node-1, node-2)
 
  task status:
 
  data:
    pools:   12 pools, 272 pgs
    objects: 1.07k objects, 2.5 GiB
    usage:   14 GiB used, 46 GiB / 60 GiB avail
    pgs:     272 active+clean
[root@node-1 python]# ceph health detail  #查看已经偏移了194秒
HEALTH_WARN 26 slow ops, oldest one blocked for 59 sec, mon.node-2 has slow ops; clock skew detected on mon.node-2
SLOW_OPS 26 slow ops, oldest one blocked for 59 sec, mon.node-2 has slow ops
MON_CLOCK_SKEW clock skew detected on mon.node-2
    mon.node-2 clock skew 194.296s &gt; max 0.05s (latency 0.00344935s) #默认最大不超过0.05秒
[root@node-1 python]# ceph --admin-daemon /var/run/ceph/ceph-mon.node-1.asok config show |grep 0.05  #查看相关配置
    &quot;bluestore_cache_trim_interval&quot;: &quot;0.050000&quot;,
    &quot;mds_cache_reservation&quot;: &quot;0.050000&quot;,
    &quot;mon_clock_drift_allowed&quot;: &quot;0.050000&quot;,
    &quot;mon_reweight_max_change&quot;: &quot;0.050000&quot;,
    &quot;mon_warn_on_slow_ping_ratio&quot;: &quot;0.050000&quot;,
    &quot;osd_pool_default_hit_set_bloom_fpp&quot;: &quot;0.050000&quot;,
    &quot;paxos_min_wait&quot;: &quot;0.050000&quot;,
    &quot;target_max_misplaced_ratio&quot;: &quot;0.050000&quot;,
</code></pre>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
        </article>

        
            
  <div class="nexmoe-post-copyright">
    <strong>Author：</strong>张博丞<br>
    
      <strong>From：</strong><a href="/%E5%8E%9F%E5%88%9B" title="原创" target="_blank" rel="noopener">原创</a><br>
    
    <strong>Link：</strong><a href="https://zhangboc.github.io/2023/04/23/Ceph/17.SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C/" title="https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;23&#x2F;Ceph&#x2F;17.SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C&#x2F;SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;zhangboc.github.io&#x2F;2023&#x2F;04&#x2F;23&#x2F;Ceph&#x2F;17.SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C&#x2F;SDK%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8E%92%E9%9A%9C&#x2F;</a><br>

    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


        

        <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/Ceph/">Ceph</a><a class="nexmoefont icon-appstore-fill -link" href="/categories/Ceph/SDK/">SDK</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Ceph/" rel="tag">Ceph</a>
    
</div>

    <div class="nexmoe-post-footer">
        <section class="nexmoe-comment">
    <div class="valine"></div>
<script src='https://lib.baomitu.com/valine/1.3.9/Valine.min.js'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'r5zxC0st0DDjPA9auXzMV7HY-gzGzoHsz',
        appKey: '3bqCsovpyfTPHUzTHovd3V3V'
    })
</script>
</section>
    </div>
</div>
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
            <div class="nexmoe-pd-item">
                <div class="qweather" >
    <div id="he-plugin-standard"></div>
    <div class="qweather-logo">

    </div>

</div>
<style>
    .qweather{
        position: relative;
    }
    .qweather-logo{
        position: absolute;
        right: 0;
        top: -15px;
        width: 40px;
        height: 40px;
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
</style>
<script>
  WIDGET = {
    "CONFIG": {
      "layout": "2",
      "width": "260",
      "height": "220",
      "background": "5",
      "dataColor": "e67249",
      "borderRadius": "15",
      "key": "f74d1e1690e6432d801e97fa2f05a162"
    }
  }
</script>
<script src="https://widget.qweather.net/standard/static/js/he-standard-common.js?v=2.0"></script>

            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://lib.baomitu.com/lazysizes/5.1.0/lazysizes.min.js"></script>
<script src="https://lib.baomitu.com/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://lib.baomitu.com/mdui/0.4.3/js/mdui.min.js"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://lib.baomitu.com/jquery/3.5.1/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1682237265507"></script>

<script src="https://lib.baomitu.com/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://lib.baomitu.com/clipboard.js/2.0.8/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --><script src="/live2D/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2D/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"model":{"jsonPath":"/live2D/assets/xiaomai.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/5e784416.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "5e784416"
  });
  daovoice('update');
</script>

